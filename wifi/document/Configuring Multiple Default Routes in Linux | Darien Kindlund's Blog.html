<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if IE 8]>
<html id="ie8" lang="en">
<![endif]-->
<!--[if !(IE 8)]><!-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><!--<![endif]--><head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Configuring Multiple Default Routes in Linux | Darien Kindlund's Blog</title>
<link rel="pingback" href="https://kindlund.wordpress.com/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="Darien Kindlund's Blog » Feed" href="https://kindlund.wordpress.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Darien Kindlund's Blog » Comments Feed" href="https://kindlund.wordpress.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Darien Kindlund's Blog » Configuring Multiple Default Routes in&nbsp;Linux Comments Feed" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/feed/">
	<script src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/beacon.js" async=""></script><script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
	<link rel="stylesheet" id="all-css-0" href="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a.css" type="text/css" media="all">
<script type="text/javascript">
/* <![CDATA[ */
var LoggedOutFollow = {"invalid_email":"Your subscription did not succeed, please try again with a valid email address."};
/* ]]> */
</script>
<script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a"></script>
<link rel="stylesheet" id="all-css-0" href="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/style.css" type="text/css" media="all">
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s1.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' type='text/css' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://kindlund.wordpress.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Welcome!" href="https://kindlund.wordpress.com/2007/11/18/welcome/">
<link rel="next" title="ESXi + Laptop =&nbsp;Possible?" href="https://kindlund.wordpress.com/2008/07/29/esxi-laptop-possible/">
<meta name="generator" content="WordPress.com">
<link rel="canonical" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/">
<link rel="shortlink" href="http://wp.me/p8Vmk-4">
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=json&amp;url=https%3A%2F%2Fkindlund.wordpress.com%2F2007%2F11%2F19%2Fconfiguring-multiple-default-routes-in-linux%2F&amp;for=wpcom-auto-discovery"><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/1.0/?format=xml&amp;url=https%3A%2F%2Fkindlund.wordpress.com%2F2007%2F11%2F19%2Fconfiguring-multiple-default-routes-in-linux%2F&amp;for=wpcom-auto-discovery">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article">
<meta property="og:title" content="Configuring Multiple Default Routes in Linux">
<meta property="og:url" content="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/">
<meta property="og:description" content="Assume you have a Linux system with more than one network interface card (NIC) — say eth0 and eth1. By default, administrators can define a single, default route (on eth0). However, if you re…">
<meta property="article:published_time" content="2007-11-19T04:14:30+00:00">
<meta property="article:modified_time" content="2011-09-28T10:12:08+00:00">
<meta property="og:site_name" content="Darien Kindlund's Blog">
<meta property="og:image" content="https://s0.wp.com/i/blank.jpg">
<meta property="og:locale" content="en_US">
<meta name="twitter:site" content="@wordpressdotcom">
<meta name="twitter:card" content="summary">
<meta property="fb:app_id" content="249643311490">
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom">
<link rel="shortcut icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48">
<link rel="icon" type="image/x-icon" href="https://s2.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48">
<link rel="apple-touch-icon-precomposed" href="https://s0.wp.com/i/webclip.png">
<link rel="openid.server" href="https://kindlund.wordpress.com/?openidserver=1">
<link rel="openid.delegate" href="https://kindlund.wordpress.com/">
<link rel="search" type="application/opensearchdescription+xml" href="https://kindlund.wordpress.com/osd.xml" title="Darien Kindlund's Blog">
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com">
		<style id="wpcom-hotfix-masterbar-style">
			@media screen and (min-width: 783px) {
				#wpadminbar .quicklinks li#wp-admin-bar-my-account.with-avatar > a img {
					margin-top: 5px;
				}
			}
		</style>
		<meta name="application-name" content="Darien Kindlund's Blog"><meta name="msapplication-window" content="width=device-width;height=device-height"><meta name="msapplication-tooltip" content="security, virtualization, and more"><meta name="msapplication-task" content="name=Subscribe;action-uri=https://kindlund.wordpress.com/feed/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s2.wp.com/i/favicon.ico"><meta name="title" content="Configuring Multiple Default Routes in&nbsp;Linux | Darien Kindlund's Blog on WordPress.com">
<meta name="description" content="Assume you have a Linux system with more than one network interface card (NIC) -- say eth0 and eth1. By default, administrators can define a single, default route (on eth0). However, if you receive traffic (i.e., ICMP pings) on eth1, the return traffic will go out eth0 by default. This can be a bit of…">
		<script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/amzn_ads.js"></script>
		<script type="text/javascript">
		try { amznads.getAds("3033"); } catch(e) { /* ignore */ }
		</script>
		<script type="text/javascript">
		try {
			var a9_p = amznads.getKeys(),
			_ipw_custom = {
				wordAds: '0',
				adSafe: '1',
				domain: 'kindlund.wordpress.com',
				pageURL: 'https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/'
			};
			if("undefined"!=typeof a9_p&&""!=a9_p&&null!==a9_p&&"[object Array]"===Object.prototype.toString.call(a9_p)){var a="",b=0,c=a9_p.length;a9_p.sort();for(var d=0;d<c;d++){a9_p[d-b]=a9_p[d-b].replace(/a1x6p/,"a160x600p");var e=a9_p[d-b].split("p");e[0]==a&&(a9_p.splice(d-b,1),b++);a=e[0]}_ipw_custom.amznPay=a9_p};document.close();
		} catch(e) {}
		</script>		<!-- IPONWEB header script -->
		<script type="text/javascript">
			window.__ATA = {
				scriptSrc: '//s.pubmine.com/showad.js',
				slotPrefix: 'automattic-id-',
				initAd: function(o) {
					var o = o || {},
						g = window,
						d = g.document,
						wr = d.write,
						id = g.__ATA.id();
					wr.call(d, '<div id="' + id + '" data-section="' + (o.sectionId || 0) + '"' + (o.type ? ('data-type="' + o.type + '"') : '') + ' ' + (o.forcedUrl ? ('data-forcedurl="' + o.forcedUrl + '"') : '') + ' style="width:' + (o.width || 0) + 'px; height:' + (o.height || 0) + 'px;">');
					g.__ATA.displayAd(id);
					wr.call(d, '</div>');
				},
				displayAd: function(id) {
					window.__ATA.ids = window.__ATA.ids || {};
					window.__ATA.ids[id] = 1;
				},
				customParams: _ipw_custom,
				id: function() {
					return window.__ATA.slotPrefix + (parseInt(Math.random() * 10000, 10) + 1 + (new Date()).getMilliseconds());
				}
			};
			(function(d, ata) {
				var pr = "https:" === d.location.protocol ? "https:" : "http:",
					src = pr + ata.scriptSrc,
					st = "text/javascript";
				d.write('<scr' + 'ipt type="' + st + '" src="' + src + '"><\/scr' + 'ipt>');
			})(window.document, window.__ATA);
		</script><script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/showad.js"></script>
		<script type="text/javascript">
		jQuery(window).ready(function () {
			jQuery("a.wpa-about").text("About these ads");
		});
		</script><link rel="amphtml" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/amp/"><style type="text/css" id="syntaxhighlighteranchor"></style>
<script type="text/javascript">
	window.google_analytics_uacct = "UA-52447-2";
</script>

<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-52447-2']);
	_gaq.push(['_setDomainName', 'wordpress.com']);
	_gaq.push(['_initData']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script><script src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/ga.js" async="" type="text/javascript"></script>
<script src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a.js" async="" type="text/javascript"></script><script src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a_002.js" async="" type="text/javascript"></script></head>

<body class="single single-post postid-4 single-format-standard mp6 customizer-styles-applied highlander-enabled highlander-dark">

<div id="wrapper">

	<div id="header">
		<div id="innerheader">
			<h1 id="blog-title"><a href="https://kindlund.wordpress.com/" title="Darien Kindlund's Blog">Darien Kindlund's Blog</a></h1>
			<div id="blog-description">security, virtualization, and more</div>

			<div id="header-image">
				<a href="https://kindlund.wordpress.com/">
								</a>
			</div>

		</div>
	</div><!--  #header -->

	<p class="access"><a href="#content" title="Skip navigation to the content">Skip navigation</a></p>
	<div id="globalnav">
	<ul id="menu">
		<li class="page_item page-item-2"><a href="https://kindlund.wordpress.com/about/">About</a></li>
	</ul>
</div>

	<div id="container">
		<div id="content" class="hfeed">

			
				<div id="post-4" class="post-4 post type-post status-publish format-standard hentry category-linux tag-linux tag-multiple-routes tag-routing">
					<div class="entry-meta">
						<h2 class="entry-title">Configuring Multiple Default Routes in&nbsp;Linux</h2>
						<ul>
							<li class="entry-date">November 19, 2007 – 4:14 am</li>
							<li class="entry-category">Posted in <a href="https://kindlund.wordpress.com/category/linux/" rel="category tag">Linux</a></li>
							<li class="entry-tags">Tagged <a href="https://kindlund.wordpress.com/tag/linux/" rel="tag">Linux</a>, <a href="https://kindlund.wordpress.com/tag/multiple-routes/" rel="tag">multiple routes</a>, <a href="https://kindlund.wordpress.com/tag/routing/" rel="tag">routing</a></li>													</ul>
					</div>
					<div class="entry-content">
						<p>Assume you have a Linux system with more than one network interface card (NIC) — say <code>eth0</code> and <code>eth1</code>. By default, administrators can define a single, default route (on <code>eth0</code>). However, if you receive traffic (i.e., ICMP pings) on <code>eth1</code>, the <strong>return</strong> traffic will go out <code>eth0</code> by default.<br>
<span id="more-4"></span><br>
This can be a bit of a problem — especially when the two NICs share the 
same parent network and you’re trying to preserve sane traffic flows. In
 a nutshell, this post will explain how you can ensure traffic going 
into <code>eth0</code> goes out <strong>only</strong> on <code>eth0</code>, as well as enforce all traffic going into <code>eth1</code> goes out <strong>only</strong> on <code>eth1</code>.</p>
<p>You’ve found the one post that actually explains this issue; your 
googling has paid off. You wouldn’t believe how many advanced Linux 
routing websites out there explain how to route everything including 
your kitchen sink — yet fail to clearly explain something as simple as 
this.</p>
<p>As always, we’ll explain by example. Assume the following:</p>
<blockquote>
<ul>
<li><code>eth0 - 10.10.70.38 netmask 255.255.255.0</code></li>
<li><code>eth0's gateway is: 10.10.70.254</code></li>
<li><code>eth1 - 192.168.7.126 netmask 255.255.255.0</code></li>
<li><code>eth1's gateway is: 192.168.7.1</code></li>
</ul>
</blockquote>
<p>First, you’ll need to make sure your Linux kernel has support for “policy routing” enabled. (As a reference, I’m using a <code>v2.6.13-gentoo-r5</code> kernel.)</p>
<p>During the kernel compilation process, you’ll want to:</p>
<blockquote><p><code>cd /usr/src/linux<br>
make menuconfig<br>
Select "Networking ---&gt;"<br>
Select "Networking options ---&gt;"<br>
[*] TCP/IP networking<br>
[*] IP: advanced router<br>
Choose IP: FIB lookup algorithm (FIB_HASH)<br>
[*] IP: policy routing<br>
[*] IP: use netfilter MARK value as routing key</code></p></blockquote>
<p>Next, you’ll want to download, compile, and install the <a href="http://www.policyrouting.org/"><strong><code>iproute2</code></strong> [1]</a> utilities. (Most Linux distributions have binary packages for this utility.) Once installed, typing <strong><code>ip route show</code></strong> should bring up your system’s routing table. Type <strong><code>man ip</code></strong> for more information about this utility, in general.</p>
<p>Speaking of which, assume the system’s initial route configuration looks like this:</p>
<blockquote><p><code># netstat -anr<br>
Kernel IP routing table<br>
Destination Gateway Genmask Flags MSS Window irtt Iface<br>
192.168.7.0 0.0.0.0 255.255.255.0 U 0 0 0 eth1<br>
10.10.70.0 0.0.0.0 255.255.255.0 U 0 0 0 eth0<br>
0.0.0.0 192.168.7.1 0.0.0.0 UG 0 0 0 eth1</code></p></blockquote>
<p>So, basically, the system is using <code>eth1</code> as the default route. If anyone pings <code>192.168.7.126</code>, then the response packets will properly go out <code>eth1</code> to the upstream gateway of <code>192.168.7.1</code>. But what about pinging <strong><code>10.10.70.38</code></strong>? Sure, the incoming ICMP packets will properly arrive on <code>eth0</code>, <strong>but the outgoing response packets will be sent out via <code>eth1</code>!</strong> That’s bad.</p>
<p>Here’s how to fix this issue. Borrowing the method from a <a href="http://www.linuxhorizon.ro/iproute2.html">really sketchy website [2]</a>, you’ll first need to create a new policy routing table entry within the <code>/etc/iproute2/rt_tables</code>. Let’s call it table #1, named “admin” (for routing administrative traffic onto <code>eth0</code>).</p>
<blockquote><p><code># echo "1 admin" &gt;&gt; /etc/iproute2/rt_tables</code></p></blockquote>
<p>Next, we’re going to set a couple of new entries within this “admin” table. Specifically, we’ll provide information about <code>eth0</code>‘s local /24 subnet, along with <code>eth0</code>‘s default gateway.</p>
<blockquote><p><code>ip route add 10.10.70.0/24 dev eth0 src 10.10.70.38 table admin<br>
ip route add default via 10.10.70.254 dev eth0 table admin</code></p></blockquote>
<p>At this point, you’ve created a new, isolated routing table named 
“admin” that really isn’t used by the OS just yet. Why? Because we still
 need to create a <strong>rule</strong> referencing <strong>how</strong> the OS should use this table. For starters, type <strong><code>ip rule show</code></strong> to see your current policy routing ruleset. Here’s what an empty ruleset looks like:</p>
<blockquote><p><code>0: from all lookup local<br>
32766: from all lookup main<br>
32767: from all lookup default</code></p></blockquote>
<p>Without going into all the boring details, each rule entry is evaluated in ascending order. The main gist is that your normal <strong>main</strong> routing table appears as entry 32766 in this list. (This would be the normal route table you’d see when you type <strong><code>netstat -anr</code></strong>.)</p>
<p>We’re now going to create two new rule entries, that will be evaluated <strong>before</strong> the main rule entry.</p>
<blockquote><p><code>ip rule add from 10.10.70.38/32 table admin<br>
ip rule add to 10.10.70.38/32 table admin</code></p></blockquote>
<p>Typing <strong><code>ip rule show</code></strong> now shows the following policy routing rulesets:</p>
<blockquote><p><code>0: from all lookup local<br>
32764: from all to 10.10.70.38 lookup admin<br>
32765: from 10.10.70.38 lookup admin<br>
32766: from all lookup main<br>
32767: from all lookup default</code></p></blockquote>
<p>Rule 32764 specifies that for all traffic going to <code>eth0</code>‘s
 IP, make sure to use the “admin” routing table, instead of the “main” 
one. Likewise, rule 32765 indicates that for all traffic originating 
from <code>eth0</code>‘s IP, make sure to use the “admin” routing table 
as well. For all other packets, use the “main” routing table. In order 
to commit these changes, it’s a good idea to type <strong><code>ip route flush cache</code></strong>.</p>
<p>Congratulations! You’re system should now properly route traffic to 
these two different default gateways. For more than 2 NICs, repeat the 
table/rule creation process as necessary.</p>
<p>Please provide comments, if you find any errors or have corrections 
to this post. I don’t claim that this method will work for everyone; 
this information is designed primarily to preserve my sanity, when 
configuring routing on future multi-NIC Linux systems.</p>
<p>References:<br>
[1] <a href="http://www.policyrouting.org/">http://www.policyrouting.org</a><br>
[2] <a href="http://www.linuxhorizon.ro/iproute2.html">http://www.linuxhorizon.ro/iproute2.html</a></p>
<p><strong>Update</strong>: Here are some additional resources, that I have found useful.<br>
<a href="http://lartc.org/howto/lartc.rpdb.multiple-links.html">http://lartc.org/howto/lartc.rpdb.multiple-links.html</a><br>
<a href="http://linux-ip.net/html/routing-tables.html">http://linux-ip.net/html/routing-tables.html</a></p>
<p><strong>Update</strong>: Apparently, OpenBSD also now supports multiple default routes through a new feature called the Virtual Routing Table:<br>
<a href="http://www.packetmischief.ca/2011/09/20/virtualizing-the-openbsd-routing-table/">http://www.packetmischief.ca/2011/09/20/virtualizing-the-openbsd-routing-table/</a></p>
		<div class="wpcnt">
			<div class="wpa wpmrec">
				<a class="wpa-about" href="https://wordpress.com/about-these-ads/" rel="nofollow">About these ads</a>
				<div class="u">
					<script type="text/javascript">
					(function(g){g.__ATA.initAd({sectionId:26942, width:300, height:250});})(window);
					</script><div id="automattic-id-5993" data-section="26942" style="width:300px; height:250px;"></div>
				</div>
			</div>
		</div><div id="jp-post-flair" class="sharedaddy sharedaddy-dark sd-like-enabled"><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-loaded" id="like-post-wrapper-2127116-4-57629cc031d51" data-src="//widgets.wp.com/likes/#blog_id=2127116&amp;post_id=4&amp;origin=kindlund.wordpress.com&amp;obj_id=2127116-4-57629cc031d51" data-name="like-post-frame-2127116-4-57629cc031d51"><h3 class="sd-title">Like this:</h3><div class="likes-widget-placeholder post-likes-widget-placeholder" style="height: 55px; display: none;"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></div><iframe class="post-likes-widget jetpack-likes-widget" name="like-post-frame-2127116-4-57629cc031d51" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a.html" frameborder="0" height="55px" width="100%"></iframe><span class="sd-text-color"></span><a class="sd-link-color"></a></div></div>											</div>
				</div><!-- .post -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous">« <a href="https://kindlund.wordpress.com/2007/11/18/welcome/" rel="prev">Welcome!</a></div>
					<div class="nav-next"><a href="https://kindlund.wordpress.com/2008/07/29/esxi-laptop-possible/" rel="next">ESXi + Laptop =&nbsp;Possible?</a> »</div>
				</div>

				
<div class="comments">
	
	<h3 class="comment-header" id="numcomments">334 Comments</h3>

	<ol id="comments" class="commentlist">
		<li id="comment-3" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-3">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted November 29, 2007 at 2:10 pm</li> <li><a href="#comment-3" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=3#respond" onclick='return addComment.moveForm( "div-comment-3", "3", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>What a fantastic article,  you’ve saved my butt,  I had my 2 nic 
system configured ok, but every reboot would change it, and voila my 
listening servers would nose dive.  this works perfectly</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-8" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-8">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 5, 2008 at 4:42 am</li> <li><a href="#comment-8" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=8#respond" onclick='return addComment.moveForm( "div-comment-8", "8", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This is just exactly what I have been looking for, and you are 
right googling has paid off.  I was looking for something that solved 
this issue, and went straight to the point.  Many articles written out 
there tends to touch on the issue but never really explains what’s 
happening or maybe it seems to them so simplistic, they overlook the 
point all together.  I don’t know if they ever think about the novices 
reading their articles….  This one sure did it for me, thank you very 
much.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-9" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-9">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 7, 2008 at 12:43 am</li> <li><a href="#comment-9" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=9#respond" onclick='return addComment.moveForm( "div-comment-9", "9", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article indeed…  but I’m in a situation where I need to be 
able to fail over to a different “default” gateway in case of the 
primary default gateway is unreachable.  Lets say I have three upstream 
routers 10.0.0.1, 10.0.0.2, 10.0.0.3/24.  Is there a way for me to 
inject all 3 IPs into a routing table as my “default” routes on a Linux 
host?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-10" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-10">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 7, 2008 at 12:16 pm</li> <li><a href="#comment-10" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=10#respond" onclick='return addComment.moveForm( "div-comment-10", "10", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>RE: Failover Default Routes</p>
<p>Here are some articles that describe what you’re looking for:</p>
<p><a href="http://www.uwsg.iu.edu/hypermail/linux/net/0009.1/0027.html" rel="nofollow">http://www.uwsg.iu.edu/hypermail/linux/net/0009.1/0027.html</a><br>
<a href="http://www.linux.com/articles/113988" rel="nofollow">http://www.linux.com/articles/113988</a><br>
<a href="http://mailman.ds9a.nl/pipermail/lartc/2002q1/002667.html" rel="nofollow">http://mailman.ds9a.nl/pipermail/lartc/2002q1/002667.html</a></p>
<p>OpenBSD also has a daemon called “hoststated” that provides this type of capability:<br>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hoststated&amp;apropos=0&amp;sektion=0&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html" rel="nofollow">http://www.openbsd.org/cgi-bin/man.cgi?query=hoststated&amp;apropos=0&amp;sektion=0&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-11" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-11">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 7, 2008 at 8:17 pm</li> <li><a href="#comment-11" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=11#respond" onclick='return addComment.moveForm( "div-comment-11", "11", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you very much for the links…</p>
<p>gc_timeout did the trick for me as the default is 5 min which is too long for a route to fail over.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-12" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-12">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 7, 2008 at 11:16 pm</li> <li><a href="#comment-12" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=12#respond" onclick='return addComment.moveForm( "div-comment-12", "12", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>just wondering if there is a kernel value to control how long a “” arp entry may stay in the arp cache…</p>
<p>#arp -a<br>
hosta (100.100.100.1) at  on eth0</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-13" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-13">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 7, 2008 at 11:17 pm</li> <li><a href="#comment-13" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=13#respond" onclick='return addComment.moveForm( "div-comment-13", "13", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>not sure why the word “incomplete” did not show up in my previous post…</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-14" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-14">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 9, 2008 at 2:17 pm</li> <li><a href="#comment-14" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=14#respond" onclick='return addComment.moveForm( "div-comment-14", "14", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>RE: ARP Cache Timeout</p>
<p>Try this link, for information about how to control how long entries stay in the ARP cache:</p>
<p><a href="http://www.ussg.indiana.edu/hypermail/linux/net/0012.2/0035.html" rel="nofollow">http://www.ussg.indiana.edu/hypermail/linux/net/0012.2/0035.html</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-15" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-15">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dinesh</span></li>
		<li>Posted April 23, 2008 at 12:52 pm</li> <li><a href="#comment-15" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=15#respond" onclick='return addComment.moveForm( "div-comment-15", "15", "respond", "4" )' aria-label="Reply to dinesh">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>great article<br>
thanks to all who rights this article</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-16" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-16">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dinesh</span></li>
		<li>Posted July 23, 2008 at 9:48 am</li> <li><a href="#comment-16" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=16#respond" onclick='return addComment.moveForm( "div-comment-16", "16", "respond", "4" )' aria-label="Reply to dinesh">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article<br>
Thanks to all who Wright this article</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-25" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-25">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Caeten</span></li>
		<li>Posted September 25, 2008 at 11:40 pm</li> <li><a href="#comment-25" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=25#respond" onclick='return addComment.moveForm( "div-comment-25", "25", "respond", "4" )' aria-label="Reply to Caeten">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for this article. It helped me get past a roadblock in a project.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-27" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-27">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Paul</span></li>
		<li>Posted September 26, 2008 at 6:45 pm</li> <li><a href="#comment-27" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=27#respond" onclick='return addComment.moveForm( "div-comment-27", "27", "respond", "4" )' aria-label="Reply to Paul">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>i’m actually kind of curious – the most common, default situation
 is where eth0 is the interface that packets are routed through — heck, 
that’s noted in the first sentence — so i’m wondering why you 
constructed your example with the reverse configuration – with eth1 as 
the default? i found it kind of confusing, in an otherwise most 
excellent article….</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-28" class="comment byuser comment-author-kindlund bypostauthor even thread-even depth-1 highlander-comment">
	<div id="div-comment-28">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted September 27, 2008 at 5:20 am</li> <li><a href="#comment-28" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=28#respond" onclick='return addComment.moveForm( "div-comment-28", "28", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Sorry about the confusion; in my example, the Linux distribution I
 used in my example (Gentoo) seemed to always specify eth1 as the 
default route — when both eth0 and eth1 were present and active (and 
when automatic configurations were used).</p>
<p>Let me ask you this, in your Linux distribution, when you have both 
an eth0 and an eth1 on the system with active links for both — does your
 distribution automatically select eth0 as the default route?  I’m 
guessing it’s pretty much random, as the standard defaults are to use 
DHCP for both eth0 and eth1, in which case, whichever interface gets the
 DHCP lease (first? or last?) will ultimately decide which default route
 actually gets used by the system.</p>
<p>I hope this explains where I was coming from.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-31" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-31">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Paul</span></li>
		<li>Posted September 28, 2008 at 5:40 am</li> <li><a href="#comment-31" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=31#respond" onclick='return addComment.moveForm( "div-comment-31", "31", "respond", "4" )' aria-label="Reply to Paul">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>oh, okay, that makes sense. i’m always running servers with fixed IP’s, so DHCP never enters into the picture.</p>
<p>for what i’m attempting, i actually found that going with bonded 
interfaces worked best – using a bond0 device and making both interfaces
 capable of “believing” that they’re the server’s IP, and the only path 
out. thus if one interface goes offline, traffic can still pass.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-32" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-32">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Amit Agarwal</span></li>
		<li>Posted October 2, 2008 at 6:42 am</li> <li><a href="#comment-32" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=32#respond" onclick='return addComment.moveForm( "div-comment-32", "32", "respond", "4" )' aria-label="Reply to Amit Agarwal">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I have a slightly different requirement.<br>
I have internet access both over WLAN and over DSL. I use the DSL for 
VoIP setup and WLAN for internet. But sometimes the WLAN or the DSL goes
 out of service. In this caseI want to use both the services – Internet 
and my VoIP setup over the either WLAN or DSL whichever is active.<br>
How could I do this?</p>
<p>Thanks,<br>
Amit<br>
<a href="mailto:kahnoie@gmail.com">kahnoie@gmail.com</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-33" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-33">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted October 2, 2008 at 12:50 pm</li> <li><a href="#comment-33" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=33#respond" onclick='return addComment.moveForm( "div-comment-33", "33", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Amit,</p>
<p>See my earlier comment about “Failover Default Routes”:</p>
<p><a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-10" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-10</a></p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-40" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-40">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Bras</span></li>
		<li>Posted November 22, 2008 at 2:48 pm</li> <li><a href="#comment-40" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=40#respond" onclick='return addComment.moveForm( "div-comment-40", "40", "respond", "4" )' aria-label="Reply to Bras">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,</p>
<p>Thank you for this helpfull article.<br>
Your exemples are related to 2 NICs : eth0 and eth1. But, what if 
instead of physical eth0 and eth1, we have a bonding logical one’s like 
this :<br>
bond0 : eth0 + eth1<br>
bond1 : eth3 + eth4.<br>
That is we have 4 NICS or a quad card in a server.</p>
<p>In that case, what will be the configation.</p>
<p>Tahnks,<br>
Bras</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-41" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-41">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 22, 2008 at 4:47 pm</li> <li><a href="#comment-41" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=41#respond" onclick='return addComment.moveForm( "div-comment-41", "41", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Bras,</p>
<p>Actually the configuration would be almost identical with the example, but just replace eth0 with ‘bond0’ and eth1 with ‘bond1’.</p>
<p>Linux treats ‘bond0’ and ‘bond1’ as physical NICs, so the rest of the
 networking subsystem will simply think that these are physical devices.</p>
<p>Hope that helps,<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-42" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-42">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Jojo enriquez</span></li>
		<li>Posted November 24, 2008 at 2:45 pm</li> <li><a href="#comment-42" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=42#respond" onclick='return addComment.moveForm( "div-comment-42", "42", "respond", "4" )' aria-label="Reply to Jojo enriquez">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,</p>
<p>Many thanks for this wonderful Info !!!<br>
how can I make this permanent, so that<br>
when my server reboots, I will have the same ruling.</p>
<p>Where can table admin  and IP ruling<br>
mods be placed …</p>
<p>Thanks in advance…</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-43" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-43">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 24, 2008 at 3:55 pm</li> <li><a href="#comment-43" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=43#respond" onclick='return addComment.moveForm( "div-comment-43", "43", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Each Linux distribution is slightly different.  Some 
distributions offer a way to save these configurations within a 
configuration file under /etc to be used upon reboot.</p>
<p>Other distributions require you to add the “echo” and “ip rule” 
commands into a script file that gets called as one of the last commands
 when the system boots up.</p>
<p>For example, on Ubuntu Linux, there is a script file called “/etc/<span class="skimlinks-unlinked">rc.local</span>” that you can add all the “echo” and “ip rule” commands into, that will apply these configurations upon complete server bootup.</p>
<p>However, please be aware that if you have other network services that
 require the multiple default routes to be set up BEFORE those services 
can successfully load (e.g., an automatic VPN/IPSec tunnel), then you’ll
 have to create an rc.d init script, similar to those found in the 
“/etc/init.d” directory.</p>
<p>The short answer:<br>
– Try adding the commands to “/etc/<span class="skimlinks-unlinked">rc.local</span>”.<br>
– If other services fail, then make a copy of a simple script in 
“/etc/init.d”; then edit that script to reflect the commands needed to 
be run at boot time; then register that script to be started upon bootup
 (“man update-rc.d”, for Ubuntu/Debian Linux).</p>
<p>Hope this helps,<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-44" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-44">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Lasy</span></li>
		<li>Posted November 25, 2008 at 9:28 pm</li> <li><a href="#comment-44" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=44#respond" onclick='return addComment.moveForm( "div-comment-44", "44", "respond", "4" )' aria-label="Reply to Lasy">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hello,<br>
This is a good article, but when you say : “However, if you receive 
traffic (i.e., ICMP pings) on eth1, the return traffic will go out eth0 
by default.”, car you please explain or give examples where we will or 
can receive traffic on eth1 if we have eth0 as a gateway. </p>
<p>Thanks<br>
Lasy</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-45" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-45">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 26, 2008 at 4:25 pm</li> <li><a href="#comment-45" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=45#respond" onclick='return addComment.moveForm( "div-comment-45", "45", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Sure,</p>
<p>Lasy, when you set a single default route, then that route is relevant for *all traffic outside your local subnet*.</p>
<p>Let’s say you have a public class-C subnet of 
128.253.1.0/255.255.255.0 and eth0 is 128.253.1.1 while eth1 is 
128.253.1.2 and your default route is through eth0.</p>
<p>Then, let’s say someone from a completely different subnet (from 
128.5.1.1, for example) pings your ETH1 IP address (128.253.1.2).  The 
ICMP request packets will arrive on eth1; however, when your system 
sends out the ICMP response packets, *because the destination is outside
 your local subnet*, these packets will go out on eth0, since that is 
your default route.</p>
<p>The point of the article is that if you have two or more network 
interfaces and have only one default *route* set on the OS, then *for 
all non-local-subnet traffic*, all outgoing packets will go out on the 
interface marked as the default route — unless you follow the steps 
listed in this article.</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-49" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-49">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Chris Jones</span></li>
		<li>Posted January 29, 2009 at 12:07 am</li> <li><a href="#comment-49" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=49#respond" onclick='return addComment.moveForm( "div-comment-49", "49", "respond", "4" )' aria-label="Reply to Chris Jones">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I have a backup server that has 2 NIC’s. One NIC is on my Server 
VLAN 10.1.0.0/16 and the other is on my storage VLAN 10.240.1.0/24.  
What I would like to do is force the backup traffic coming in on the 
10.1.0.0/16 NIC to then be routed out to the backup NAS on the 
10.240.1.0/24 NIC.  How cna this be done?</p>
<p>Thanks</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-50" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-50">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">LamePLAYA</span></li>
		<li>Posted February 24, 2009 at 8:49 pm</li> <li><a href="#comment-50" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=50#respond" onclick='return addComment.moveForm( "div-comment-50", "50", "respond", "4" )' aria-label="Reply to LamePLAYA">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanx 4 that! Everything now seems to work… NICE DONE!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-51" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-51">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Freemind</span></li>
		<li>Posted February 28, 2009 at 11:58 am</li> <li><a href="#comment-51" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=51#respond" onclick='return addComment.moveForm( "div-comment-51", "51", "respond", "4" )' aria-label="Reply to Freemind">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article! Thank you very much for writing :o)</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-52" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-52">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted March 4, 2009 at 5:57 pm</li> <li><a href="#comment-52" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=52#respond" onclick='return addComment.moveForm( "div-comment-52", "52", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>At last! Thanks for writing this. While it didn’t save a me a lot
 of time I *already* wasted, it was the solution to my networking 
conundrum. You rock.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-54" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-54">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">F Peeters</span></li>
		<li>Posted March 20, 2009 at 12:43 pm</li> <li><a href="#comment-54" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=54#respond" onclick='return addComment.moveForm( "div-comment-54", "54", "respond", "4" )' aria-label="Reply to F Peeters">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for this writeup! It saved me a lot of time!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-55" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-55">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Ghostbuster</span></li>
		<li>Posted March 21, 2009 at 9:45 am</li> <li><a href="#comment-55" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=55#respond" onclick='return addComment.moveForm( "div-comment-55", "55", "respond", "4" )' aria-label="Reply to Ghostbuster">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>That’s a very handy piece of writing, Darien ! Thanks for posting it.</p>
<p>I can’t find IP_ROUTE_FWMARK in the new kernel for marking the packets (I’m using 2.6.27) or by googling. Has it been removed ?</p>
<p>Any pointers would be great.</p>
<p>GB</p>
	</div>
	</div>
<ul class="children">
<li id="comment-56" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-56">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted March 27, 2009 at 9:29 pm</li> <li><a href="#comment-56" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=56#respond" onclick='return addComment.moveForm( "div-comment-56", "56", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Ghostbuster,</p>
<p>Yes, IP_ROUTE_FWMARK was removed from linux v2.6.20 and later releases.  See this link for details:<br>
<a href="http://cateee.net/lkddb/web-lkddb/IP_ROUTE_FWMARK.html" rel="nofollow">http://cateee.net/lkddb/web-lkddb/IP_ROUTE_FWMARK.html</a></p>
<p>Presumably, the feature still exists, but it’s probably named something else (or perhaps merged with some other feature).</p>
<p>Hope this helps,<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-57" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-57">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Ghostbuster</span></li>
		<li>Posted March 28, 2009 at 6:46 am</li> <li><a href="#comment-57" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=57#respond" onclick='return addComment.moveForm( "div-comment-57", "57", "respond", "4" )' aria-label="Reply to Ghostbuster">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>Thanks for that pointer.</p>
<p>I’m thinking it’s the MARK command in Netfilter these days. </p>
<p><a href="http://www.linuxtopia.org/Linux_Firewall_iptables/x4368.html" rel="nofollow">http://www.linuxtopia.org/Linux_Firewall_iptables/x4368.html</a></p>
<p>I’ve done some qdisc stuff so hopefully it won’t be too alien.</p>
<p>GB</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-58" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-58">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Ghostbuster</span></li>
		<li>Posted March 28, 2009 at 6:58 am</li> <li><a href="#comment-58" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=58#respond" onclick='return addComment.moveForm( "div-comment-58", "58", "respond", "4" )' aria-label="Reply to Ghostbuster">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, scrap that last comment<img scale="0" class="wp-smiley emoji" draggable="false" alt=":-)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
<p>I’ll try this instead hoping the support is all handled by iproute2 these days:</p>
<p><a href="http://www.physics.umd.edu/pnce/pcs-docs/Glue/linux-route-hack.html" rel="nofollow">http://www.physics.umd.edu/pnce/pcs-docs/Glue/linux-route-hack.html</a></p>
<p>GB</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-62" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-62">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">BeFreeLinux</span></li>
		<li>Posted April 21, 2009 at 12:18 am</li> <li><a href="#comment-62" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=62#respond" onclick='return addComment.moveForm( "div-comment-62", "62", "respond", "4" )' aria-label="Reply to BeFreeLinux">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Kick-ass !  This fixed a problem I was having with an FTP server 
with two NICS.  I could only get it to work with one default gateway at a
 time.  Using what I found here, I created two additional entries, one 
for each NIC.  Works perfectly now.  I had to use a slight variation on 
the ip route statement (using CentOS) –  it was:  “ip route add 
10.1.250.0/24 via 10.1.250.1 dev eth0 table inside” instead of dev eth0 
src .  Great article – thanks so much !!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-70" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-70">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Howard</span></li>
		<li>Posted May 1, 2009 at 1:02 pm</li> <li><a href="#comment-70" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=70#respond" onclick='return addComment.moveForm( "div-comment-70", "70", "respond", "4" )' aria-label="Reply to Howard">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This is a really good article that gets me 90% of where I need to
 go, I really appreciate it. I was wondering if you also know how to 
configure a system with 10 nics with addresses on the same subnet to 
send packets directly to the same gateway instead of passing them 
indirectly through the dfault route on the machine. So, for example, 
10.0.0.2-&gt;10.0.0.1 and 10.0.0.3-&gt;10.0.0.1 instead of<br>
10.0.0.2-&gt;10.0.0.1 and 10.0.0.3-&gt;10.0.0.2-&gt;10.0.0.1. (where 
10.0.0.1 is the gateway for that subnet, and 10.0.0.2 is the address of 
the interface with the default local route.)<br>
I see how your example works for addresses on different subnets, but not for my situation. I would appreciate any ideas!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-71" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-71">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 2, 2009 at 8:21 am</li> <li><a href="#comment-71" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=71#respond" onclick='return addComment.moveForm( "div-comment-71", "71", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Howard,<br>
Yes, I’m familiar with that problem.  To be honest, this problem is 
solved at a different layer than routing.  What you’re looking for is 
“Link Aggregation” (aka. making multiple NICs in your server act as one 
large NIC).  There is an entire page dedicated to the concept, available
 here:<br>
<a href="http://en.wikipedia.org/wiki/802.3ad" rel="nofollow">http://en.wikipedia.org/wiki/802.3ad</a></p>
<p>In order to get it to work, though, you’ll need to make sure your 
upstream switch/router supports the 802.3ad protocol (most recent 
managed switches do support it; however, if you have an unmanaged 
switch, probably not).</p>
<p>Hope this helps,<br>
Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-91" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-91">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anderson Lawrenco</span></li>
		<li>Posted May 29, 2009 at 8:43 am</li> <li><a href="#comment-91" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=91#respond" onclick='return addComment.moveForm( "div-comment-91", "91", "respond", "4" )' aria-label="Reply to Anderson Lawrenco">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, </p>
<p>Am a little lost. On which file do you put all those commands? 
Secondly, after you have done all the configurations as shown in your 
solution, what will be the output when you do netstat -rn. Your 
assistance is highly appreciated.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-92" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-92">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 29, 2009 at 4:48 pm</li> <li><a href="#comment-92" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=92#respond" onclick='return addComment.moveForm( "div-comment-92", "92", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Anderson,</p>
<p>There is no specific file, as all the commands I’ve listed are 
performed from the command line.  If you’re looking to run these 
commands every time your OS boots, then you can put them all in /etc/<span class="skimlinks-unlinked">rc.local</span> (for Ubuntu Linux).</p>
<p>Second, ‘netstat -rn’ can’t show you “policy routes” properly.  So 
even after you run the policy routing commands, it’s likely ‘netstat 
-rn’ will still show you the same thing before and after the policy 
routes are in place.</p>
<p>If you’re looking to verify that policy routes are working properly, 
run the “ip rule show” before and after setting up policy routes.  If 
you want more detailed information, see the man pages for the “ip” 
command, by typing “man ip”.</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-93" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-93">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anderson Lawrenco</span></li>
		<li>Posted May 30, 2009 at 8:04 am</li> <li><a href="#comment-93" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=93#respond" onclick='return addComment.moveForm( "div-comment-93", "93", "respond", "4" )' aria-label="Reply to Anderson Lawrenco">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>Thanks so much for your response. One more question. Should I include
 the respective gateways in each interface configuration files for my 
case ifcfcg-eth0 and ifcfcg-eth1? My OS is RedHat El5. My default 
gateway for eth0 I have defined it in /etc/sysconfig/network file. Where
 should I define the default gateway for eth1?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-95" class="comment byuser comment-author-kindlund bypostauthor odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-95">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 30, 2009 at 11:20 pm</li> <li><a href="#comment-95" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=95#respond" onclick='return addComment.moveForm( "div-comment-95", "95", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Anderson,<br>
You can define your eth1 gateway in the set of commands you enter into /etc/<span class="skimlinks-unlinked">rc.local</span></p>
<p>The “ip rule” commands Listed in the article will properly configure 
your eth1 gateway, so you won’t need to define it within 
/etc/sysconfig/network</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-97" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-97">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">nobodyfamous</span></li>
		<li>Posted June 17, 2009 at 6:46 am</li> <li><a href="#comment-97" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=97#respond" onclick='return addComment.moveForm( "div-comment-97", "97", "respond", "4" )' aria-label="Reply to nobodyfamous">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>What do you change if both NICs are on the same network segment, 
using the same gateway IP? I tried following the steps above but I was 
left with all traffic going out eth0 while some went in eth1.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-98" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-98">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted June 17, 2009 at 2:11 pm</li> <li><a href="#comment-98" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=98#respond" onclick='return addComment.moveForm( "div-comment-98", "98", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi nobodyfamous,<br>
If both NICs are on the same network segment, the policy routing isn’t 
going to help you.  The problem has to do with Linux kernel’s TCP/IP 
stack employing short-circuit routing.</p>
<p>Specifically, this problem is solved at a different layer than 
routing. What you’re looking for is “Link Aggregation” (aka. making 
multiple NICs in your server act as one large NIC). There is an entire 
page dedicated to the concept, available here:<br>
<a href="http://en.wikipedia.org/wiki/802.3ad" rel="nofollow">http://en.wikipedia.org/wiki/802.3ad</a></p>
<p>In order to get it to work, though, you’ll need to make sure your 
upstream switch/router supports the 802.3ad protocol (most recent 
managed switches do support it; however, if you have an unmanaged 
switch, probably not).</p>
<p>— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-102" class="comment even depth-3 highlander-comment">
	<div id="div-comment-102">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted June 18, 2009 at 4:27 pm</li> <li><a href="#comment-102" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=102#respond" onclick='return addComment.moveForm( "div-comment-102", "102", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Yeah, bonding was the initial goal, but we don’t have access to 
the switches in this case, so it had to be solved at the host level.</p>
<p>We were able to make it work following a modified form of your instructions, FWIW:</p>
<p>In this example, the gateway is 192.168.0.1 and the server’s IPs are 
192.168.0.211 and 192.168.0.212 on eth0 and eth1 respectively:</p>
<p>    printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
    printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>    ip route add 192.168.0.211/32 dev eth0 src 192.168.0.211 table uplink0<br>
    ip route add default via 192.168.0.1 dev eth0 table uplink0<br>
    ip rule add from 192.168.0.211/32 table uplink0<br>
    ip rule add to 192.168.0.211/32 table uplink0</p>
<p>    ip route add 192.168.0.212/32 dev eth1 src 192.168.0.212 table uplink1<br>
    ip route add default via 192.168.0.1 dev eth1 table uplink1<br>
    ip rule add from 192.168.0.212/32 table uplink1<br>
    ip rule add to 192.168.0.212/32 table uplink1</p>
<p>By the way, in the second paragraph you say that the solution is 
applicable to cases where the two NICs are on the same network, that’s 
why I followed your lead on this.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-109" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-109">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Tekknogenius</span></li>
		<li>Posted July 2, 2009 at 12:01 am</li> <li><a href="#comment-109" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=109#respond" onclick='return addComment.moveForm( "div-comment-109", "109", "respond", "4" )' aria-label="Reply to Tekknogenius">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This is extremely helpful. Thank you.</p>
<p>One question about routing in general, is there a way to have subnets share a common default gateway?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-110" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-110">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 2, 2009 at 12:34 am</li> <li><a href="#comment-110" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=110#respond" onclick='return addComment.moveForm( "div-comment-110", "110", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Tekknogenius,<br>
If we’re talking about two subnets sharing a common, physical gateway 
(such as a router), then yes, but that common gateway must have a valid 
IP address on each subnet.  For example, assume you have two subnets:</p>
<p>192.168.0.0/24<br>
192.168.1.0/24</p>
<p>You can then configure your router to have the IPs of:<br>
192.168.0.254 and 192.168.1.254 for use by members of their respective subnets.</p>
<p>Bottom line is that the gateway must have an address in each subnet; 
otherwise, you would have to figure out some other way to reach the 
gateway’s IP address (e.g. static ARP entry if on the local LAN)</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-113" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-113">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">JohnnyKnoxville</span></li>
		<li>Posted July 7, 2009 at 1:46 pm</li> <li><a href="#comment-113" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=113#respond" onclick='return addComment.moveForm( "div-comment-113", "113", "respond", "4" )' aria-label="Reply to JohnnyKnoxville">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi – i have another slightly different goal. My Linux box has an 
eth0 (connected via a default gw to the internet) and a on-demand ppp0 
(gprs) connection. My goal is to programmatically create sockets via 
both interface at the same time. I think i am stuck setting up the 
correct routes for this – do you know how to handle this issue?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-114" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-114">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 7, 2009 at 1:57 pm</li> <li><a href="#comment-114" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=114#respond" onclick='return addComment.moveForm( "div-comment-114", "114", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Johnny,<br>
See my earlier comment as I’ve already addressed this issue:<br>
<a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-10" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-10</a></p>
<p>— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-117" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-117">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">JohnnyKnoxville</span></li>
		<li>Posted July 15, 2009 at 12:56 pm</li> <li><a href="#comment-117" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=117#respond" onclick='return addComment.moveForm( "div-comment-117", "117", "respond", "4" )' aria-label="Reply to JohnnyKnoxville">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for your quick reply. I’m not sure failover routing is the
 correct issue here, as both routes should be up all the time. My app 
decides on various criteria which connection should be used. I had read 
som article, whiches in short says: What goes out on one device, should 
comme in on that again. Is this the right idea? And how can I realize 
that?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-118" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-118">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 15, 2009 at 3:20 pm</li> <li><a href="#comment-118" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=118#respond" onclick='return addComment.moveForm( "div-comment-118", "118", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Johnny,<br>
Okay, thanks for the clarification.  I had assumed when you mentioned 
‘on-demand’, that you somehow wanted to switch from eth0 to ppp0 when 
eth0 failed.  Instead, you want both eth0 and ppp0 alive all the time.</p>
<p>In that case, just replaced ‘eth1’ with ‘ppp0’ in the example and you
 can still use policy routing to accomplish what you’re looking for.</p>
<p>The real challenge, is if ppp0’s network configuration changes 
constantly.  If the IP address, subnet, and route of ppp0 constantly 
changes, then you need to somehow have logic to detect when these 
changes occur and update your policy routes accordingly.</p>
<p>In that case, you’ll probably want to research DHCP notification 
code.  Depending on your Linux distribution, there are scripts which 
execute when your network changes, which you could use to also update 
your corresponding policy routes.</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-122" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-122">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Throstur</span></li>
		<li>Posted August 7, 2009 at 4:13 pm</li> <li><a href="#comment-122" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=122#respond" onclick='return addComment.moveForm( "div-comment-122", "122", "respond", "4" )' aria-label="Reply to Throstur">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article. This is so simple, yet so hard to find the information. Thanks a lot<img scale="0" class="wp-smiley emoji" draggable="false" alt=":-)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-125" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-125">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">DevizioN</span></li>
		<li>Posted September 8, 2009 at 10:29 am</li> <li><a href="#comment-125" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=125#respond" onclick='return addComment.moveForm( "div-comment-125", "125", "respond", "4" )' aria-label="Reply to DevizioN">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hey,</p>
<p>Great article, helped me loads compared to the other sites were they just skimm abit on the top.</p>
<p>Thou, having problem adapting it to my setup. </p>
<p>I currently have 2 nic’s on my server that is acting as router/gateway.</p>
<p>1 of the physical nic’s has 5 virtuell interfaces (g1-5), g1 goes to 
the router itself as it also goes as a webserver. The rest are nated 
straight to nic2(which has no virtuell interfaces). As i have 4 
computer, g2-5 are nated 1:1 towards the inside local ip:s 10.10.1.X.</p>
<p>I have a simple iptables rule to fix the NAT part, and i had it 
working “sortoff” since everything was working except that i could not 
reach the servers/pc’s from the outside, they could only talk from the 
inside-&gt;out (torrents etc works flawlessly thou).</p>
<p>Any hints? If you got a mail or something it would be great to get some advice..</p>
	</div>
	</div>
<ul class="children">
<li id="comment-126" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-126">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted September 8, 2009 at 3:23 pm</li> <li><a href="#comment-126" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=126#respond" onclick='return addComment.moveForm( "div-comment-126", "126", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi DevizioN,</p>
<p>It sounds like you have one-way NAT working and you want 
bi-directional NAT.  From your post, it sounds like g1 goes to the 
router, as well as nic2 goes directly to the router … is that correct?</p>
<p>Regardless, it sounds like setting up multiple default routes 
correctly will NOT fix your NAT problem… I would recommend you try and 
fix your NAT problem first, and then setup the multiple default routes.</p>
<p>To be very specific, with your current NAT configuration, try 
configuring your server with only ONE upstream gateway and fix your NAT 
so that it’s working in both directions (insideout).  </p>
<p>Once you get a single route working, then add your second upstream 
gateway. If your bi-directional NAT breaks and no longer works 
correctly, then let me know and we can troubleshoot further (as 
configuring multiple default routes may help you).</p>
<p>The general approach is: reduce the complexity of your configuration,
 verify each piece works first (e.g., NATing, virtual interfaces), and 
THEN verify the total configuration works.  Otherwise, it can be a 
nightmare to troubleshoot multiple unknown pieces at the same time.</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-127" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-127">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Murgen</span></li>
		<li>Posted September 16, 2009 at 9:51 am</li> <li><a href="#comment-127" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=127#respond" onclick='return addComment.moveForm( "div-comment-127", "127", "respond", "4" )' aria-label="Reply to Murgen">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, if i have 2 or more subnets</p>
<p>example</p>
<p>10.10.70.0/24<br>
10.10.71.0/24</p>
<p>ip rules add and from are with /32 or /24?</p>
<p>example</p>
<p>ip rule add from 10.10.70.38/32 table admin<br>
ip rule add to 10.10.70.38/32 table admin<br>
ip rule add from 10.10.71.38/32 table admin2<br>
ip rule add to 10.10.71.38/32 table admin2</p>
<p>or</p>
<p>ip rule add from 10.10.70.38/24 table admin<br>
ip rule add to 10.10.70.38/24 table admin<br>
ip rule add from 10.10.71.38/24 table admin2<br>
ip rule add to 10.10.71.38/24 table admin2</p>
<p>I don’t hunderstand why you use all 32 bits.</p>
<p>Thanks</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-128" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-128">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">James Miller</span></li>
		<li>Posted October 13, 2009 at 5:39 am</li> <li><a href="#comment-128" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=128#respond" onclick='return addComment.moveForm( "div-comment-128", "128", "respond", "4" )' aria-label="Reply to James Miller">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Excellent Post!</p>
<p>I have followed the various bonding solutions available on Linux 
since I was doing load balancing work in the late 90’s but have never 
found anything that delivers on bonding two links to maximize bandwidth 
utilization.</p>
<p>I have a FIOS and Cable link that I’d been trying with bonding modes 
5,6 on with various 3com 509’s and netgear 100mbit nics, after following
 your references here to Astro Shapes pages (also very informative).  
mii-tool seems to work fine with the nics.. but can’t get them to attach
 correctly for ifenslave</p>
<p>Given I’m interested in maximizing traffic on the links I wonder if 
anyone has rules that will monitor and direct traffic based on load on 
the individual nics?</p>
<p>Thanks</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-129" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-129">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Simon</span></li>
		<li>Posted October 14, 2009 at 7:11 pm</li> <li><a href="#comment-129" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=129#respond" onclick='return addComment.moveForm( "div-comment-129", "129", "respond", "4" )' aria-label="Reply to Simon">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for writing a very useful article and subsequently answering so many questions. Here’s another<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
<p>Supposing you have one or more aliases on the public interface (e.g.,
 eth0:0) would you repeat all of the above steps, substituting eth0:0 
for eth0?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-130" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-130">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted October 14, 2009 at 8:56 pm</li> <li><a href="#comment-130" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=130#respond" onclick='return addComment.moveForm( "div-comment-130", "130", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Yes.  Using eth0:0 should work.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-131" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-131">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Mazzer</span></li>
		<li>Posted October 16, 2009 at 12:28 pm</li> <li><a href="#comment-131" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=131#respond" onclick='return addComment.moveForm( "div-comment-131", "131", "respond", "4" )' aria-label="Reply to Mazzer">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for a great article. This looks like kinda what I need. However, my situation is a bit different (aren’t they all<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16">
 ). Anyway, I am basically, trying to setup openVPN on my Ubuntu 8.10 
server. I got 2 NICs in my server. eth0 and eth1. eth0 is the external 
NIC while eth1 is the internal one (the LAN. eth0 is the default route. 
VPN connects through eth0 and I can ping my server and I can ping eth1, 
however I can’t ping anything behind eth1 (which is my local LAN). From 
the server console itself I can ping my internal LAN. I think the 
problem lies with traffice coming via eth0 and since the default route 
is eth0 it only goes through eth0. So if I ping anything which is behind
 eth1 it is routed via eth0 and not eth1. Is it possible to route all 
VPN traffic meant for eth1 through eth1 even though it’s not the default
 route?</p>
<p>Does this make any sense or am I making you guys as confused as myself?</p>
<p>Thanks for your help in advance.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-132" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-132">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted October 16, 2009 at 4:40 pm</li> <li><a href="#comment-132" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=132#respond" onclick='return addComment.moveForm( "div-comment-132", "132", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Mazzer,</p>
<p>1) As a sanity check, are you able to ping your eth1 network if you 
TURN OFF your VPN?  I just want to make sure that the problem isn’t more
 fundamental.</p>
<p>2) On your server, once you have your VPN setup, you actually have 
THREE different interfaces: eth0, eth1, and (probably something like 
vpn0 — check your ‘ifconfig -a’ for details).  Essentially, you have a 
third ‘virtual’ interface, representing the effective IP address of your
 server, once connected on the *inside* of your VPN network.</p>
<p>Here’s what I need to know:<br>
– The IP address and netmask of your eth1 network.<br>
– The IP address and netmask of your *vpn0* network (see above for what I mean).</p>
<p>Specifically, I believe that perhaps your eth1 network and your vpn0 
network may have conflicting IP addressing, which is causing you to lose
 connectivity to your eth1 network once a VPN is established.  However, I
 need more information in order to accurately say that this is the 
problem.</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-133" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-133">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">prasad</span></li>
		<li>Posted October 16, 2009 at 6:22 pm</li> <li><a href="#comment-133" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=133#respond" onclick='return addComment.moveForm( "div-comment-133", "133", "respond", "4" )' aria-label="Reply to prasad">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I used the same kinda configuring (but created two tables instead
 of one) one per interface. This makes sure i get the response to 
through the right interface.</p>
<p># Assign IP address on the interfaces eth0 and eth1<br>
ip route add 10.1.0.0 dev eth0 src 10.1.0.250<br>
ip route add 10.0.0.0 dev eth1 src 10.0.0.250</p>
<p># IP route and default gateway for eth0 in the table 100<br>
ip route add 10.1.0.0 dev eth0 src 10.1.0.250 table 100<br>
ip route add default via 10.1.0.1 table 100<br>
# IP route and default gateway for eth1 in the table 101<br>
ip route add 10.0.0.0 dev eth1 src 10.0.0.250 table 101<br>
ip route add default via 10.0.0.1 table 101</p>
<p># Assign the rule to corresponding particular table<br>
ip rule add from 10.1.0.250 table 100<br>
ip rule add from 10.0.0.250 table 101<br>
ip route flush cache</p>
<p>Now, i can  ping the box to the corresponding box from behind the<br>
gateway. Everything works fine according to my requirement.</p>
<p>Now if i use the ping utility (from the box) with a destination 
address not in 10.1.X.X or in 10.0.X.X network using both the interfaces
 (or the<br>
ip-address) it works<br>
ping -I eth0 some-address (works)<br>
ping -I eth1 some-address (works)<br>
ping some-address (not working) with “network is unreachable” as the error</p>
<p>Now this force  me to use the default route on the main table which i<br>
thought was not neccessary using below command<br>
ip route add default via 10.1.0.1.</p>
<p>Since with out any interface or ip-address explicity given, ping<br>
should have chosen the source ip-address as either 10.1.0.250 or<br>
10.0.0.250. If so , rule should have hit in routing table 100 or table<br>
101.  But just wondering why it is hiting the main routing table. This<br>
forces me to have a  two gateway programming option for each interface<br>
and another default gateway to select among two. Not sure why..</p>
	</div>
	</div>
<ul class="children">
<li id="comment-134" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-134">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">prasad</span></li>
		<li>Posted October 16, 2009 at 6:24 pm</li> <li><a href="#comment-134" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=134#respond" onclick='return addComment.moveForm( "div-comment-134", "134", "respond", "4" )' aria-label="Reply to prasad">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Also how do we use the same concept in the DHCP enabled network. 
DHCP client running on both the interfaces. DHCP clients always deals 
with the main routing table (instead of the custom created routing 
table).</p>
	</div>
	</div>
<ul class="children">
<li id="comment-144" class="comment byuser comment-author-kindlund bypostauthor even depth-3 highlander-comment">
	<div id="div-comment-144">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 10, 2009 at 3:30 pm</li> <li><a href="#comment-144" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=144#respond" onclick='return addComment.moveForm( "div-comment-144", "144", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Handling DHCP leases is tough.  You’ll need to use a DHCP client 
that supports custom extensions, so that you can call a script (which 
you create) that will setup the appropriate policy routes.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-143" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-143">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 10, 2009 at 3:29 pm</li> <li><a href="#comment-143" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=143#respond" onclick='return addComment.moveForm( "div-comment-143", "143", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>What does your ‘netstat -anr’ and ‘ip rule show’ look like?</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-135" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-135">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Mazzer</span></li>
		<li>Posted October 20, 2009 at 1:35 pm</li> <li><a href="#comment-135" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=135#respond" onclick='return addComment.moveForm( "div-comment-135", "135", "respond", "4" )' aria-label="Reply to Mazzer">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>Thank you for your quick reply. I was away from my computer for a while so couldn’t reply. </p>
<p>As per your questions, I’ll answer the ones I can right now.</p>
<p>1) I can ping eth1.</p>
<p>2) I know what you mean about the 3rd virtual interface. Sorry for 
not providing more information. I do have one and it’s a tun interface 
(tun0). I’m using routing and not bridging. </p>
<p>The IP address of eth1 is 10.10.2.102, netmask is 255.255.255.0 so thats the 10.10.2.0 subnet. </p>
<p>The details about tun0 I’ll get for you when I go home tonight.</p>
<p>I think the problem lies between the virtual Interface and eth1. From
 the VPN server I can ping both eth1 and eth0 and everything behind 
those interface. I can ping everything behind the eth1 subnet (internal 
network) and I can ping everyhting behind the eth0 subnet (the 
internet). When I’m connect via VPN to the server. I can ping both eth0 
and eth1 but can’t ping anything behind eth1. Once connected via VPN, I 
can SSH into the VPN server (through the VPN connection) and one 
connected to the server console. I can ping everything behind eth1. I 
guess thats no surprise as I’m am then doing the pinging from the 
console. So as I said, I think the problem lies with the virtual 
interface having the default route of eth0 and so the pings arte going 
through eth0 even though they meant for eth1. </p>
<p>Phew, I can’t believe I wrote all that down<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16">. Thanks for your help though.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-136" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-136">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Mazzer</span></li>
		<li>Posted October 20, 2009 at 2:33 pm</li> <li><a href="#comment-136" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=136#respond" onclick='return addComment.moveForm( "div-comment-136", "136", "respond", "4" )' aria-label="Reply to Mazzer">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Also Just so you know, I’m using OpenVPN as my VPN server and I’ve setup the redirect gateway option as well.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-138" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-138">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Mazzer</span></li>
		<li>Posted October 21, 2009 at 10:55 am</li> <li><a href="#comment-138" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=138#respond" onclick='return addComment.moveForm( "div-comment-138", "138", "respond", "4" )' aria-label="Reply to Mazzer">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Got the details for the tun0 interface.</p>
<p>IP Address: 10.30.2.6<br>
Subnet Mask: 255.255.255.252<br>
Default Gateway: 10.30.2.5<br>
DHCP Server: 10.30.2.5<br>
DNS Servers: 10.10.2.11</p>
<p>The 10.10.2.0 subnet is the internal eth1 network so looks like the 
VPN server is pushing the DNS server to the client correctly.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-142" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-142">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">madinc</span></li>
		<li>Posted November 10, 2009 at 1:10 pm</li> <li><a href="#comment-142" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=142#respond" onclick='return addComment.moveForm( "div-comment-142", "142", "respond", "4" )' aria-label="Reply to madinc">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Good article.<br>
Forgive my ignorance, but what’s the purpose of the “to” rule, ie</p>
<p>ip rule add to 10.10.70.38/32 table admin</p>
<p>that would be used only from incoming packets, and even in that case 
it doesn’t seem very useful. But I’m sure I’m missing something obvious.</p>
<p>Thank you.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-145" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-145">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 10, 2009 at 3:34 pm</li> <li><a href="#comment-145" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=145#respond" onclick='return addComment.moveForm( "div-comment-145", "145", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>madinc,</p>
<p>The “to” rule is to tell the tcp/ip stack that for all packets where 
the destination is 10.10.70.38/32, then route those packets to the 
“admin” interface.  This is important for STATEFUL flow processing.  
When Linux constructs the appropriate reply (e.g., a TCP ACK), it will 
know which policy route to use, when sending the reply.  Otherwise, 
without this rule, you’ll find that your ACKs will get sent using the 
default route in the main table.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-146" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-146">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">madinc</span></li>
		<li>Posted November 10, 2009 at 5:08 pm</li> <li><a href="#comment-146" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=146#respond" onclick='return addComment.moveForm( "div-comment-146", "146", "respond", "4" )' aria-label="Reply to madinc">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Sorry for being slow to understand, but for ACK reply packets the
 “to” (destination IP) will NOT be 10.10.70.38, but rahter the IP of the
 host the ACK is directed to.<br>
So if you want to use a specific rule to route those packets out, you 
probably want a rule that matches on *from* 10.10.70.38, rather than 
“to”.</p>
<p>I still fail to see how that “to” rule can match anything other than incoming packets.</p>
<p>Thank you!</p>
	</div>
	</div>
<ul class="children">
<li id="comment-147" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-147">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 10, 2009 at 6:13 pm</li> <li><a href="#comment-147" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=147#respond" onclick='return addComment.moveForm( "div-comment-147", "147", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi madinc,</p>
<p>The “to” rule is primarily important when BOTH of your ethernet 
interfaces are on the SAME SUBNET.  If both interfaces are on separate 
subnets with NO possibility of getting overlapping traffic, then the 
“to” rule is less of an issue.</p>
<p>However, when both interfaces are on the same subnet, then the “to” 
rule tells Linux which packets to ignore or listen to if each interface 
is getting duplicate traffic.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-148" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-148">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 10, 2009 at 6:14 pm</li> <li><a href="#comment-148" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Just to clarify, when I mean SAME SUBNET, I mean that both 
ethernet interfaces are connected to the same upstream 
hub/switch/router, where both ethernet interfaces receive copies of all 
network traffic destined to any of the interfaces.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-149" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-149">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">madinc</span></li>
		<li>Posted November 11, 2009 at 9:25 am</li> <li><a href="#comment-149" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=149#respond" onclick='return addComment.moveForm( "div-comment-149", "149", "respond", "4" )' aria-label="Reply to madinc">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>When both ethernet interfaces are on the same subnet, only the 
one whose IP address is the destination IP address of the incoming 
packet will get it.<br>
It’s like having many hosts in a LAN: only the destination host will 
reply to ARP and thus get the packet, despite all other hosts being in 
the same subnet.</p>
<p>Forgive me, but I still don’t see where the “to” rule comes into play<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
<p>Thank you.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-150" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-150">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">madinc</span></li>
		<li>Posted November 11, 2009 at 11:17 am</li> <li><a href="#comment-150" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=150#respond" onclick='return addComment.moveForm( "div-comment-150", "150", "respond", "4" )' aria-label="Reply to madinc">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hm, on second thought…with Linux’s weak host model, both interfaces will reply. So yeah, now I see where the “to” can be useful.</p>
<p>Thank you and sorry for the noise.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-151" class="comment byuser comment-author-kindlund bypostauthor even depth-3 highlander-comment">
	<div id="div-comment-151">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 11, 2009 at 3:39 pm</li> <li><a href="#comment-151" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=151#respond" onclick='return addComment.moveForm( "div-comment-151", "151", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>No problem; glad to help.  In general, when getting real answers,
 I’d recommend actually testing against an actual Linux system, since a 
lot of these nuances could change, depending on which kernel patches 
(from which Linux distributions) are loaded on your test machine.</p>
<p>On numerous occasions, I’ve found that “what should happen” is largely different than “what really happens”.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-152" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-152">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">wcole</span></li>
		<li>Posted November 23, 2009 at 5:15 pm</li> <li><a href="#comment-152" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=152#respond" onclick='return addComment.moveForm( "div-comment-152", "152", "respond", "4" )' aria-label="Reply to wcole">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I tried using the steps that you used to configure Multiple 
Routes and I ran into an error when I ran the command “ip route add 
default vi 10.141.50.50 dev eth2 table ccsadmin”.  The error that I 
received was “error: either “to” is duplicate, or “10.141.50.50” is a 
garbage.  I’m not sure what steps do I need to take to solve this 
problem that I’m having.  I’m running CentOS 4.7 kernel version 2.6.9-78</p>
	</div>
	</div>
<ul class="children">
<li id="comment-153" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-153">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 23, 2009 at 10:17 pm</li> <li><a href="#comment-153" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=153#respond" onclick='return addComment.moveForm( "div-comment-153", "153", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Umm, I think you mis-typed the command:</p>
<p>“ip route add default vi 10.141.50.50 dev eth2 table ccsadmin”</p>
<p>Should be:</p>
<p>“ip route add default via 10.141.50.50 dev eth2 table ccsadmin”</p>
<p>Specifically, the “vi” should be “via”.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-156" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-156">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.utilitycomputing.com.cn/" rel="external nofollow" class="url">Richard Ford</a></span></li>
		<li>Posted December 14, 2009 at 9:58 am</li> <li><a href="#comment-156" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=156#respond" onclick='return addComment.moveForm( "div-comment-156", "156", "respond", "4" )' aria-label="Reply to Richard Ford">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hmmm…</p>
<p>I keep getting:</p>
<p>[root@bjwww001 ~]# ip route add 192.168.20.0/24 dev eth1 src 192.168.20.2 table hkvpn<br>
RTNETLINK answers: Invalid argument</p>
<p>All my ifcfgXX files are correct and have broadcast and network IP’s defined too….</p>
	</div>
	</div>
<ul class="children">
<li id="comment-157" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-157">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 14, 2009 at 2:26 pm</li> <li><a href="#comment-157" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=157#respond" onclick='return addComment.moveForm( "div-comment-157", "157", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Did you enable “policy routing” in the Linux kernel and install 
the iproute2 utilities? (Both were mentioned above in the article.)</p>
	</div>
	</div>
<ul class="children">
<li id="comment-158" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-158">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.utilitycomputing.com.cn/" rel="external nofollow" class="url">Richard Ford</a></span></li>
		<li>Posted December 14, 2009 at 3:11 pm</li> <li><a href="#comment-158" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=158#respond" onclick='return addComment.moveForm( "div-comment-158", "158", "respond", "4" )' aria-label="Reply to Richard Ford">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>iproute yes… policy routing – will have to check.  This is a 
stock CentOS 5.4 64 bit.  WIll I need to recompile the kernel or is 
there a kernel flag I can set in sysctl?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-159" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-159">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 14, 2009 at 3:29 pm</li> <li><a href="#comment-159" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=159#respond" onclick='return addComment.moveForm( "div-comment-159", "159", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Policy routing requires a kernel recompilation, if it’s not 
enabled by default.  There’s no way to dynamically enable/disable it via
 sysctl.</p>
<p>Not sure about CentOS, but many Linux distributions will store a copy of the actual Linux kernel config in /proc/<span class="skimlinks-unlinked">config.gz</span>,
 so you could try inspecting that kernel config (if it exists) to see if
 Policy Routing has been defined.  Otherwise, you’ll have to do a 
recompile.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-160" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-160">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.utilitycomputing.com.cn/" rel="external nofollow" class="url">Richard Ford</a></span></li>
		<li>Posted December 15, 2009 at 4:04 am</li> <li><a href="#comment-160" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>OK.  Yes the .config is included.  Have’t recompiled a kernel for probably 10 years now. Oh well – like riding a bike….</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-161" class="comment even depth-5 highlander-comment">
	<div id="div-comment-161">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.utilitycomputing.com.cn/" rel="external nofollow" class="url">Richard Ford</a></span></li>
		<li>Posted December 15, 2009 at 11:06 am</li> <li><a href="#comment-161" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>This works too for CentOS with no kernel recompile!</p>
<p><a href="http://www.sysadminsjourney.com/content/2009/04/15/doing-simple-source-policy-routing-centos" rel="nofollow">http://www.sysadminsjourney.com/content/2009/04/15/doing-simple-source-policy-routing-centos</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-163" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-163">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://biciperros.org/" rel="external nofollow" class="url">edscott</a></span></li>
		<li>Posted February 4, 2010 at 11:16 pm</li> <li><a href="#comment-163" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=163#respond" onclick='return addComment.moveForm( "div-comment-163", "163", "respond", "4" )' aria-label="Reply to edscott">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Worked great for ssh, but borked my apache server. I don’t know 
why but requests arriving on one device to the apache server will be 
sent out on the other one. And with the ip rule will try to go the wrong
 way. Maybe its an apache bug (or feature?)</p>
	</div>
	</div>
<ul class="children">
<li id="comment-164" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-164">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 5, 2010 at 6:16 am</li> <li><a href="#comment-164" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=164#respond" onclick='return addComment.moveForm( "div-comment-164", "164", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Do you have Apache listening on all interfaces or just one 
interface?  You may need to adjust this setting to get your desired 
effect.</p>
<p><a href="http://httpd.apache.org/docs/2.2/bind.html" rel="nofollow">http://httpd.apache.org/docs/2.2/bind.html</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-166" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-166">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Marcus</span></li>
		<li>Posted February 24, 2010 at 4:09 pm</li> <li><a href="#comment-166" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=166#respond" onclick='return addComment.moveForm( "div-comment-166", "166", "respond", "4" )' aria-label="Reply to Marcus">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Since you were using Gentoo:</p>
<p>How do you setup the IP address in the “admin” routing table during boot? How did your modify your “/etc/conf.d/<span class="skimlinks-unlinked">net.eth0”-file</span>?</p>
<p>The default gateway can be added with “routes_eth0=( “default via 10.10.70.254 table admin” )</p>
<p>The rules can be added in the “postup” section of the 
/etc/conf.d/net; but I simply cannot bring Gentoo to add the IP address 
in the other table. It either adds it in the default table; or throws a 
syntax error.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-167" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-167">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 25, 2010 at 2:50 am</li> <li><a href="#comment-167" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=167#respond" onclick='return addComment.moveForm( "div-comment-167", "167", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Instead of trying to figure out the proper way to add the routing
 table commands to the network startup scripts, just add them to your 
/etc/<span class="skimlinks-unlinked">rc.local</span> script (or 
equivalent).  Essentially, you want to use the same absolute commands as
 listed in the examples (in the article) and write them to a script that
 will run after *all* automatic networking scripts are ran.  On most 
systems, commands written to /etc/<span class="skimlinks-unlinked">rc.local</span> are literally the last commands executed before the system finished bootup and presents a login prompt to the user.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-168" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-168">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 25, 2010 at 10:57 am</li> <li><a href="#comment-168" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=168#respond" onclick='return addComment.moveForm( "div-comment-168", "168", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>That would be “/etc/conf.d/<span class="skimlinks-unlinked">local.start</span>” on a Gentoo system.</p>
<p>While it does work, of course, there is a problem if you restart the interface with an “/etc/init.d/<span class="skimlinks-unlinked">net.eth0</span> restart”, since the routing table will be empty afterwards.</p>
<p>Alas, at least it works now. Thanks for pointing me in the right direction.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-419" class="comment even depth-4 highlander-comment">
	<div id="div-comment-419">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Marcus</span></li>
		<li>Posted July 6, 2011 at 8:38 am</li> <li><a href="#comment-419" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=419#respond" onclick='return addComment.moveForm( "div-comment-419", "419", "respond", "4" )' aria-label="Reply to Marcus">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Replying to my own comment:</p>
<p>Using OpenRC with baselayout2 the /etc/conf.d/<span class="skimlinks-unlinked">net.eth0</span> script would look like this:</p>
<p>config_eth0=”192.168.1.100 netmask 255.255.255.0 broadcast 192.168.1.255″<br>
routes_eth0=”default via 192.168.1.1<br>
        192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.150 table dmz<br>
        default via 192.168.1.1 dev eth0 table dmz”<br>
dns_domain_eth0=”<span class="skimlinks-unlinked">localdomain.local</span>”<br>
dns_servers_eth0=”<span class="skimlinks-unlinked">dns.ip.1</span> <span class="skimlinks-unlinked">dns.ip.2</span>″<br>
metric_eth0=”0″</p>
<p>Modify to your own pleasure.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-169" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-169">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Al Evans</span></li>
		<li>Posted February 28, 2010 at 8:33 pm</li> <li><a href="#comment-169" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=169#respond" onclick='return addComment.moveForm( "div-comment-169", "169", "respond", "4" )' aria-label="Reply to Al Evans">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks so much for this! I had no idea, until I watched it with 
tcpdump, that a packet coming in on one interface would get an 
(attempted) response on another.</p>
<p>The fix you give worked like a charm.</p>
<p>–Al Evans</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-171" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-171">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Andy</span></li>
		<li>Posted March 25, 2010 at 11:27 pm</li> <li><a href="#comment-171" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=171#respond" onclick='return addComment.moveForm( "div-comment-171", "171", "respond", "4" )' aria-label="Reply to Andy">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Wow, this worked great!  Really cool.  Does anybody know if something like this can be done under Windows?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-174" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-174">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://viperpilot.co.za/" rel="external nofollow" class="url">mdewet</a></span></li>
		<li>Posted April 12, 2010 at 10:30 am</li> <li><a href="#comment-174" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=174#respond" onclick='return addComment.moveForm( "div-comment-174", "174", "respond", "4" )' aria-label="Reply to mdewet">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,<br>
Thanks for the tutorial, it helped a lot! One thing, is there a way to 
make the routing tables persistent?  Or will the newly configured tables
 still be there after a system reboot?</p>
<p>Regards,<br>
mdewet</p>
	</div>
	</div>
<ul class="children">
<li id="comment-175" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-175">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted April 12, 2010 at 1:41 pm</li> <li><a href="#comment-175" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=175#respond" onclick='return addComment.moveForm( "div-comment-175", "175", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi mdewet,</p>
<p>The policy routing settings should persist across reboots.  If, for 
whatever reason, they do not, you can usually add these settings to 
/etc/<span class="skimlinks-unlinked">rc.local</span> (or equivalent), so that these settings are applied at the very end of system boot.</p>
<p>— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-185" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-185">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Joel</span></li>
		<li>Posted May 1, 2010 at 3:25 pm</li> <li><a href="#comment-185" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=185#respond" onclick='return addComment.moveForm( "div-comment-185", "185", "respond", "4" )' aria-label="Reply to Joel">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article.  Much appreciated!!!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-189" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-189">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">rodmar</span></li>
		<li>Posted May 7, 2010 at 5:45 pm</li> <li><a href="#comment-189" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=189#respond" onclick='return addComment.moveForm( "div-comment-189", "189", "respond", "4" )' aria-label="Reply to rodmar">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>First of all great post.<br>
I just have one question. Is it possible to do something similar but 
with two interfaces connected to the same network? For instance two 
wireless cards connected to the same access point.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-190" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-190">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 7, 2010 at 9:54 pm</li> <li><a href="#comment-190" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=190#respond" onclick='return addComment.moveForm( "div-comment-190", "190", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi rodmar,</p>
<p>Yes, the same technique can be used on 2 wireless NICs connected to 
the same access point — Linux treats those interfaces the same when 
performing policy routing.</p>
<p>— Darien </p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-194" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-194">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dir</span></li>
		<li>Posted May 13, 2010 at 9:28 am</li> <li><a href="#comment-194" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=194#respond" onclick='return addComment.moveForm( "div-comment-194", "194", "respond", "4" )' aria-label="Reply to dir">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the tutorial. Does this also work with configuring multiple default routes on vlan interfaces?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-195" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-195">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 13, 2010 at 12:39 pm</li> <li><a href="#comment-195" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=195#respond" onclick='return addComment.moveForm( "div-comment-195", "195", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,<br>
Yes, this technique can be applied to vlan interfaces as well, because 
Linux treats those interfaces exactly the same as physical interfaces — 
just substitute eth0/eth1 with the corresponding vlan interfaces you 
want to perform policy routing on.<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-197" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-197">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Fred</span></li>
		<li>Posted May 16, 2010 at 11:59 pm</li> <li><a href="#comment-197" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=197#respond" onclick='return addComment.moveForm( "div-comment-197", "197", "respond", "4" )' aria-label="Reply to Fred">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Bless you, O Darien, for this gem  on a subject which has stumped
 not only me but all who I have hit up for the solution, til now!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-198" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-198">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Fred</span></li>
		<li>Posted May 17, 2010 at 12:00 am</li> <li><a href="#comment-198" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=198#respond" onclick='return addComment.moveForm( "div-comment-198", "198", "respond", "4" )' aria-label="Reply to Fred">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Bless you, O Darien, for this gem  on a subject which has stumped not only me but many who I have hit up for the solution!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-202" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-202">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted May 27, 2010 at 2:31 pm</li> <li><a href="#comment-202" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=202#respond" onclick='return addComment.moveForm( "div-comment-202", "202", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Classful routing hasn’t been used since 1994. The fact that the 
mask is included means it is a classless network. So stop saying ‘class 
C’, just because the Class C default mask was 255.255.255.0. It is 
simply a /24 subnet.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-203" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-203">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 27, 2010 at 3:13 pm</li> <li><a href="#comment-203" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=203#respond" onclick='return addComment.moveForm( "div-comment-203", "203", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Done.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-207" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-207">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Will</span></li>
		<li>Posted June 3, 2010 at 5:21 pm</li> <li><a href="#comment-207" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=207#respond" onclick='return addComment.moveForm( "div-comment-207", "207", "respond", "4" )' aria-label="Reply to Will">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien, Thnak you for this info..</p>
<p>Do i have to remove the gateway in the interface file for this to work???</p>
	</div>
	</div>
<ul class="children">
<li id="comment-208" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-208">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted June 4, 2010 at 4:00 am</li> <li><a href="#comment-208" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=208#respond" onclick='return addComment.moveForm( "div-comment-208", "208", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Will,<br>
No, you don’t need to remove the gateway in the interface file for this 
to work.   Essentially, you want to perform the policy route 
configuration *after* basic networking (including setting the default 
gateway) has been done.  This is why I recommend setting the policy 
route in /etc/<span class="skimlinks-unlinked">rc.local</span>, so that it is the *last* thing initialized, which guarantees the settings will not conflict with another daemon upon boot up.<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-209" class="comment even depth-3 highlander-comment">
	<div id="div-comment-209">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Will</span></li>
		<li>Posted June 4, 2010 at 12:47 pm</li> <li><a href="#comment-209" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=209#respond" onclick='return addComment.moveForm( "div-comment-209", "209", "respond", "4" )' aria-label="Reply to Will">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Can you look at this and see what I’m doing wrong??? I would gladly pay you for your time.<br>
We have 2 NIC cards and when I try to set the eth1 gatway we lose SHH to the server.<br>
ETH0 is for (SSH&lt;WEB&lt;ECT.)<br>
ETH1 is for SIP traffic only<br>
ifconfig –a<br>
eth0      Link encap:Ethernet  HWaddr 00:1c:23:d0:0b:2c<br>
          inet addr:192.168.1.69  Bcast:192.168.1.255  Mask:255.255.255.0<br>
          inet6 addr: fe80::21c:23ff:fed0:b2c/64 Scope:Link<br>
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br>
          RX packets:6215 errors:0 dropped:0 overruns:0 frame:0<br>
          TX packets:59877 errors:0 dropped:0 overruns:0 carrier:0<br>
          collisions:0 txqueuelen:1000<br>
          RX bytes:908397 (887.1 KiB)  TX bytes:13233015 (12.6 MiB)<br>
          Interrupt:16 Memory:f8000000-f8012100 </p>
<p>eth1      Link encap:Ethernet  HWaddr 00:1c:23:d0:0b:2e<br>
          inet addr:192.168.3.70  Bcast:192.168.3.255  Mask:255.255.255.0<br>
          inet6 addr: fe80::21c:23ff:fed0:b2e/64 Scope:Link<br>
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br>
          RX packets:271 errors:0 dropped:0 overruns:0 frame:0<br>
          TX packets:123 errors:0 dropped:0 overruns:0 carrier:0<br>
          collisions:0 txqueuelen:1000<br>
          RX bytes:181558 (177.3 KiB)  TX bytes:13875 (13.5 KiB)<br>
          Interrupt:16 Memory:f4000000-f4012100 </p>
<p>lo        Link encap:Local Loopback<br>
          inet addr:127.0.0.1  Mask:255.0.0.0<br>
          inet6 addr: ::1/128 Scope:Host<br>
          UP LOOPBACK RUNNING  MTU:16436  Metric:1<br>
          RX packets:197 errors:0 dropped:0 overruns:0 frame:0<br>
          TX packets:197 errors:0 dropped:0 overruns:0 carrier:0<br>
          collisions:0 txqueuelen:0<br>
          RX bytes:68135 (66.5 KiB)  TX bytes:68135 (66.5 KiB)</p>
<p>vi interfaces<br>
auto lo<br>
iface lo inet loopback<br>
# The primary network interface[m<br>
auto eth0<br>
iface eth0 inet static<br>
address 192.168.1.69<br>
netmask 255.255.255.0<br>
gateway 192.168.1.10</p>
<p>auto eth1<br>
iface eth1 inet static<br>
address 192.168.3.70<br>
netmask 255.255.255.0<br>
#gateway 192.168.3.11     —-When I try to use this line it locks me out oh SSH</p>
<p>ip rule show<br>
0:            from all lookup local<br>
32759:   from 192.168.3.70 lookup sip<br>
32760:   from all to 192.168.3.70 lookup sip<br>
32763:   from all to 192.168.1.69 lookup admin<br>
32764:   from 192.168.1.69 lookup admin<br>
32766:   from all lookup main<br>
32767:   from all lookup default</p>
<p>ip route show<br>
192.168.3.0/24 dev eth1  proto kernel  scope link  src 192.168.3.70<br>
192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.69<br>
gla</p>
	</div>
	</div>
<ul class="children">
<li id="comment-210" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-210">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted June 4, 2010 at 9:01 pm</li> <li><a href="#comment-210" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=210#respond" onclick='return addComment.moveForm( "div-comment-210", "210", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Will,<br>
Your last post looks like some information was cut off, but I think I have enough information to help you.</p>
<p>1) In /etc/interfaces, do NOT define the gateway for eth1.  You are 
correct that this declaration will cause problems.  So, remove the line:<br>
“gateway 192.168.3.11” completely from /etc/interfaces.</p>
<p>2) It looks like you’re trying to define TWO (2) policy tables: “sip”
 and “admin”.  You do NOT need to do this.  Please remove *both* “sip” 
and “admin” tables, and clear out all the custom “ip rule” and “ip 
route” commands you have defined.</p>
<p>3) Once you’ve down that, reboot your system and verify that there 
are NO custom “ip rule show” and “ip route show” commands listed, and 
that only the eth0 default gateway is showing up in “netstat -anr”.</p>
<p>4) THEN, type the following commands:</p>
<p>echo “1 admin” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 192.168.3.0/24 dev eth1 src 192.168.3.70 table admin<br>
ip route add default via 192.168.3.11 dev eth0 table admin</p>
<p>ip rule add from 192.168.3.70/32 table admin<br>
ip rule add to 192.168.3.70/32 table admin</p>
<p>ip route flush cache</p>
<p>Hope this helps,<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-228" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-228">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Ed</span></li>
		<li>Posted July 5, 2010 at 11:34 am</li> <li><a href="#comment-228" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=228#respond" onclick='return addComment.moveForm( "div-comment-228", "228", "respond", "4" )' aria-label="Reply to Ed">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article – worked like a charm.<br>
Thanks very much!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-238" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-238">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">route66</span></li>
		<li>Posted August 2, 2010 at 3:41 am</li> <li><a href="#comment-238" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=238#respond" onclick='return addComment.moveForm( "div-comment-238", "238", "respond", "4" )' aria-label="Reply to route66">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks very much for the excellent info!</p>
<p>However there was an error for me for the route setting for the 
default gateway, which I tried to set to same as in the 
/etc/network/interfaces file, but from an online IP-calculator I found 
that the gateway should be the first usable host address from the range 
of machines on the sub network. After changing to that IP, it worked 
like a charm.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-257" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-257">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.scheidel21.com/" rel="external nofollow" class="url">Scheidel21</a></span></li>
		<li>Posted September 2, 2010 at 2:08 pm</li> <li><a href="#comment-257" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=257#respond" onclick='return addComment.moveForm( "div-comment-257", "257", "respond", "4" )' aria-label="Reply to Scheidel21">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Many thanks for this I have been trying to consolidate some 
servers and I was combining our Proxy box with our openvpn box for a 
different subnet. I decided to use Untangle for the proxy as it was a 
quick easy set up. However, I knew that I would have to run my own 
instance of openVPN as Untangle only does routed VPNs and I needed a 
bridged VPN. All setup fine, but then when I pinged to the openVPN 
bridged interface through a second router from a PC on my LAN which is 
the one subnet being proxied I was getting no response, because it was 
killing them, I looked for a way to route the traffic back out the same 
interface it came in one for a couple of weeks and even posted questions
 about this at some forums, but your web page here finally provided me 
the information I needed to do it. I hope you don’t mind I have resolved
 the questions I asked on the forums and linked back to your article. 
Many thanks.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-282" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-282">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dave</span></li>
		<li>Posted November 23, 2010 at 11:42 pm</li> <li><a href="#comment-282" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=282#respond" onclick='return addComment.moveForm( "div-comment-282", "282", "respond", "4" )' aria-label="Reply to Dave">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien – thanks this is very helpful!<br>
nobodyfamous and howard refer to same subnet and same gatway with 2 (or 
multiple) NICs. But would anything change in your precription if I want 2
 gateways (10.0.0.1 and 10.0.0.2) with 2 NICS (10.0.0.11 and 10.0.0.22) 
on the same subnet. (This is different from link aggregation).</p>
<p>To stay with your example – what if eth0 has ip 192.168.7.127<br>
and gateway 192.168.7.1</p>
	</div>
	</div>
<ul class="children">
<li id="comment-283" class="comment even depth-2 highlander-comment">
	<div id="div-comment-283">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dave</span></li>
		<li>Posted November 23, 2010 at 11:46 pm</li> <li><a href="#comment-283" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=283#respond" onclick='return addComment.moveForm( "div-comment-283", "283", "respond", "4" )' aria-label="Reply to Dave">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>oops I shouls have said:</p>
<p>To stay with your example – what if eth0 has ip 192.168.7.127<br>
and gateway 192.168.7.2</p>
	</div>
	</div>
<ul class="children">
<li id="comment-284" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-3 highlander-comment">
	<div id="div-comment-284">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 24, 2010 at 1:07 am</li> <li><a href="#comment-284" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=284#respond" onclick='return addComment.moveForm( "div-comment-284", "284", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Dave,<br>
Take a look at the comments posted right after nobodyfamous:<br>
<a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-102" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-102</a></p>
<p>So, let’s assume:<br>
eth0 – 192.168.7.127 netmask 255.255.255.0<br>
eth0’s gateway is: 192.168.7.2<br>
eth1 – 192.168.7.126 netmask 255.255.255.0<br>
eth1’s gateway is: 192.168.7.1</p>
<p>Here are the corresponding commands:<br>
printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 192.168.7.127/32 dev eth0 src 192.168.7.127 table uplink0<br>
ip route add default via 192.168.7.2 dev eth0 table uplink0<br>
ip rule add from 192.168.7.127/32 table uplink0<br>
ip rule add to 192.168.7.127/32 table uplink0</p>
<p>ip route add 192.168.7.126/32 dev eth1 src 192.168.7.126 table uplink1<br>
ip route add default via 192.168.7.1 dev eth1 table uplink1<br>
ip rule add from 192.168.7.126/32 table uplink1<br>
ip rule add to 192.168.7.126/32 table uplink1</p>
	</div>
	</div>
<ul class="children">
<li id="comment-285" class="comment even depth-4 highlander-comment">
	<div id="div-comment-285">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dave</span></li>
		<li>Posted November 24, 2010 at 6:19 pm</li> <li><a href="#comment-285" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=285#respond" onclick='return addComment.moveForm( "div-comment-285", "285", "respond", "4" )' aria-label="Reply to Dave">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I have set it up as stated. It boots fine but I am unable to ping
 10.0.0.211 (eth1) from another machine on the subnet – but I can ping 
10.0.0.201 (eth0). From the machine itself I can ping 10.0.0.211. Here 
is some output:<br>
oft201:~# ip rule<br>
0:      from all lookup local<br>
32766:  from all lookup main<br>
32767:  from all lookup default<br>
oft201:~# vi /etc/<span class="skimlinks-unlinked">rc.local</span><br>
oft201:~# /etc/<span class="skimlinks-unlinked">rc.local</span><br>
oft201:~# ip rule<br>
0:      from all lookup local<br>
32762:  from all to 10.0.0.211 lookup uplink1<br>
32763:  from 10.0.0.211 lookup uplink1<br>
32764:  from all to 10.0.0.201 lookup uplink0<br>
32765:  from 10.0.0.201 lookup uplink0<br>
32766:  from all lookup main<br>
32767:  from all lookup default<br>
oft201:~# netstat -nra<br>
Kernel IP routing table<br>
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface<br>
10.0.0.0        0.0.0.0         255.255.255.0   U         0 0          0 eth1<br>
10.0.0.0        0.0.0.0         255.255.255.0   U         0 0          0 eth0<br>
0.0.0.0         10.0.0.1        0.0.0.0         UG        0 0          0 eth0</p>
<p>What gives? [I am assuming that policy routing must be enabled in the latest stable debian kernel:<br>
Linux oft201 2.6.26-2-686-bigmem #1 SMP Thu Sep 16 20:29:07 UTC 2010 i686 GNU/Linux]</p>
	</div>
	</div>
<ul class="children">
<li id="comment-286" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-286">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 24, 2010 at 6:58 pm</li> <li><a href="#comment-286" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Okay, can you paste the contents of your /etc/<span class="skimlinks-unlinked">rc.local</span> file?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-287" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-287">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 24, 2010 at 7:00 pm</li> <li><a href="#comment-287" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Also, I assume you entered “ip route flush cache” and still ran into problems?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-288" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-288">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dave</span></li>
		<li>Posted November 24, 2010 at 7:03 pm</li> <li><a href="#comment-288" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>I am able to get it to work if the line:<br>
ip route add 192.168.7.127/32 dev eth0 src 192.168.7.127 table uplink0<br>
is changed to<br>
ip route add 192.168.7.0/24 dev eth0 src 192.168.7.127 table uplink0<br>
and the line<br>
ip route add 192.168.7.126/32 dev eth1 src 192.168.7.126 table uplink1<br>
is changed to<br>
ip route add 192.168.7.0/24 dev eth1 src 192.168.7.126 table uplink1</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-289" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-289">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 24, 2010 at 7:05 pm</li> <li><a href="#comment-289" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Okay, glad it’s working for you.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-290" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-290">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dave</span></li>
		<li>Posted November 24, 2010 at 7:05 pm</li> <li><a href="#comment-290" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=290#respond" onclick='return addComment.moveForm( "div-comment-290", "290", "respond", "4" )' aria-label="Reply to Dave">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>My <span class="skimlinks-unlinked">rc.local</span> with what I beleive to be the incorrect lines commented out:<br>
#!/bin/sh -e<br>
#<br>
# <span class="skimlinks-unlinked">rc.local</span><br>
#<br>
# This script is executed at the end of each multiuser runlevel.<br>
# Make sure that the script will “exit 0” on success or any other<br>
# value on error.<br>
#<br>
# In order to enable or disable this script just change the execution<br>
# bits.<br>
#<br>
# By default this script does nothing.</p>
<p>#ip route add 10.0.0.201/32 dev eth0 src 10.0.0.201 table uplink0<br>
ip route add 10.0.0.0/24 dev eth0 src 10.0.0.201 table uplink0<br>
ip route add default via 10.0.0.1 dev eth0 table uplink0<br>
ip rule add from 10.0.0.201/32 table uplink0<br>
ip rule add to 10.0.0.201/32 table uplink0</p>
<p>#ip route add 10.0.0.211/32 dev eth1 src 10.0.0.211 table uplink1<br>
ip route add 10.0.0.0/24 dev eth1 src 10.0.0.211 table uplink1<br>
ip route add default via 10.0.0.2 dev eth1 table uplink1<br>
ip rule add from 10.0.0.211/32 table uplink1<br>
ip rule add to 10.0.0.211/32 table uplink1</p>
<p>exit 0</p>
	</div>
	</div>
<ul class="children">
<li id="comment-292" class="comment even depth-2 highlander-comment">
	<div id="div-comment-292">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dave</span></li>
		<li>Posted December 1, 2010 at 6:58 pm</li> <li><a href="#comment-292" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=292#respond" onclick='return addComment.moveForm( "div-comment-292", "292", "respond", "4" )' aria-label="Reply to Dave">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Turns out that the above settings work but not as expected.<br>
If I run ‘ifdown eth1’ and then try<br>
ping or ssh 10.0.1.211 (the interface associated with eth1) – I can 
still get through (and vice versa). This may be seen as a feature rather
 than a bug – but I am spooked by it because I dont understand it. I 
have abandoned the quest of dual gateway on same subnet. There is no 
compelling reason for having this anyway. I can live with the original 
prescription of Darien – which works as expected. (I used the latest 
debian lenny kernel and did not need to make any special kernel compile 
to get Dariens prescription working). Thanks again.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-317" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-317">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">why</span></li>
		<li>Posted December 21, 2010 at 1:01 pm</li> <li><a href="#comment-317" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=317#respond" onclick='return addComment.moveForm( "div-comment-317", "317", "respond", "4" )' aria-label="Reply to why">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Would have been a great article if it had explained where one wrote the admin routing information:</p>
<p>ip route add 10.10.70.0/24 dev eth0 src 10.10.70.38 table admin<br>
ip route add default via 10.10.70.254 dev eth0 table admin</p>
<p>Which file is this placed into?  I don’t know.  The article does not say.</p>
<p>Therefore, I am back to googgeling once more for another site.  But 
at least I know I should Google for policy routing.   Thus a partial 
thank-you.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-318" class="comment even depth-2 highlander-comment">
	<div id="div-comment-318">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">why</span></li>
		<li>Posted December 21, 2010 at 1:02 pm</li> <li><a href="#comment-318" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=318#respond" onclick='return addComment.moveForm( "div-comment-318", "318", "respond", "4" )' aria-label="Reply to why">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>PS. I am using SLES 11.  Maybe its obvious on gentoo.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-319" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-3 highlander-comment">
	<div id="div-comment-319">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 2:12 pm</li> <li><a href="#comment-319" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=319#respond" onclick='return addComment.moveForm( "div-comment-319", "319", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>why: Read the corresponding comments for your answer.  Specifically, this one:<br>
<a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-43" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-43</a></p>
<p>Better yet, just search the page for “<span class="skimlinks-unlinked">rc.local</span>”.  What you’re asking for is very generic… you just want a way to have this commands auto-executed upon boot up.</p>
<p>If you do a google search for “suse linux <span class="skimlinks-unlinked">rc.local</span>”, you get this as a top hit:<br>
<a href="http://linux.derkeiler.com/Mailing-Lists/SuSE/2003-12/1428.html" rel="nofollow">http://linux.derkeiler.com/Mailing-Lists/SuSE/2003-12/1428.html</a></p>
<p>Which states: /etc/init.d/<span class="skimlinks-unlinked">boot.local</span> is the equivalent file of <span class="skimlinks-unlinked">rc.local</span> in SLES.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-320" class="comment even depth-3 highlander-comment">
	<div id="div-comment-320">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">why</span></li>
		<li>Posted December 21, 2010 at 2:40 pm</li> <li><a href="#comment-320" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=320#respond" onclick='return addComment.moveForm( "div-comment-320", "320", "respond", "4" )' aria-label="Reply to why">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Sorry, I have realised that these lines are actual commands.<br>
ip route add 10.10.70.0/24 dev eth0 src 10.10.70.38 table admin<br>
ip route add default via 10.10.70.254 dev eth0 table admin<br>
Please disregard my initial posts.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-321" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-321">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 21, 2010 at 2:47 pm</li> <li><a href="#comment-321" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=321#respond" onclick='return addComment.moveForm( "div-comment-321", "321", "respond", "4" )' aria-label="Reply to whynot">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,<br>
  I have had a hard time following the post, and am unsure its what I 
have to do.  Would you be able to have a look at this scenario and add 
some helpers for it?  </p>
<p>Both interfaces are on different VLANs (Should not make an once of 
difference).  The default route is the one that goes to the commodity 
Internet, while the 10/8 destinations are for the internal network.</p>
<p>eth0  IP 10.254.60.90/22<br>
default 10.254.60.74 255.255.252.0 eth0<br>
10.0.0.0 10.254.60.51 255.0.0.0 eth0</p>
<p>eth1  IP 10.254.41.13/22<br>
default 10.254.40.74 255.255.252.0 eth1<br>
10.0.0.0 10.254.40.51 255.0.0.0 eth1</p>
	</div>
	</div>
<ul class="children">
<li id="comment-322" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-322">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 3:44 pm</li> <li><a href="#comment-322" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=322#respond" onclick='return addComment.moveForm( "div-comment-322", "322", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I’ll take a look, but why are you defining two different netmasks for each interface?  That makes no sense.</p>
<p>If you’re going to define a full Class-A /8, then you don’t need to 
explicitly define a /22 for the upstream Internet gateway.  The /22 
serves no purpose in this context.</p>
<p>I’ll generate some rules that show you what I mean…</p>
	</div>
	</div>
<ul class="children">
<li id="comment-323" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-3 highlander-comment">
	<div id="div-comment-323">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 3:47 pm</li> <li><a href="#comment-323" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=323#respond" onclick='return addComment.moveForm( "div-comment-323", "323", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I think I see what you’re trying to do… each interface has two _virtual_ IPs assigned to it:</p>
<p>eth0: 10.254.60.90, 10.254.60.51<br>
eth1: 10.254.41.13, 10.254.40.51</p>
<p>I’ll adjust accordingly…</p>
	</div>
	</div>
<ul class="children">
<li id="comment-324" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-324">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 3:49 pm</li> <li><a href="#comment-324" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=324#respond" onclick='return addComment.moveForm( "div-comment-324", "324", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Actually, can you confirm each interface has two virtual IPs?  The way you wrote the initial IP information is confusing…</p>
	</div>
	</div>
<ul class="children">
<li id="comment-329" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-329">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 21, 2010 at 4:08 pm</li> <li><a href="#comment-329" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>These are both IPs plumbs on real NICs, not virtual NIC (not eth0:1 etc), and neither are these bonded in anyway.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-325" class="comment even depth-3 highlander-comment">
	<div id="div-comment-325">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 21, 2010 at 4:00 pm</li> <li><a href="#comment-325" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=325#respond" onclick='return addComment.moveForm( "div-comment-325", "325", "respond", "4" )' aria-label="Reply to whynot">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darie,</p>
<p> Apologies for the confusion.  </p>
<p>The 10/8 reference was only mean to refer to the second route below 
for all traffic to the 10.0.0.0 network, and this understandingly caused
 confusion.  </p>
<p>All networks use /22.  The default route is for all traffic other 
than the 10.0.0.0/22 network, (which is really the public Internet and 
other private nets 192.168.n.n. and 172.16.n.n networks).</p>
<p>The current system has one NIC eth0.  Its routing table as defined is :<br>
 default 10.254.64.74 255.255.252.0 –<br>
 10.0.0.0 10.254.64.51 255.0.0.0 –</p>
<p>I have to plumb a new eth1 onto it on another VLAN and keep the 
traffic separate.  (I had never heard of priority routing until now.)  
The eth1  has to send the default Internet traffic via the router  
10.254.40.74 on eth1, and the rest back to the internal LAN via 
10.254.40.51 on eth1.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-326" class="comment odd alt depth-4 highlander-comment">
	<div id="div-comment-326">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 21, 2010 at 4:01 pm</li> <li><a href="#comment-326" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=326#respond" onclick='return addComment.moveForm( "div-comment-326", "326", "respond", "4" )' aria-label="Reply to whynot">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>^Hi Darie,^Hi Darien,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-328" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-328">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 4:03 pm</li> <li><a href="#comment-328" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=328#respond" onclick='return addComment.moveForm( "div-comment-328", "328", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, ignore my previous post… will provide documentation based on this new information, shortly.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-330" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-330">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 21, 2010 at 4:13 pm</li> <li><a href="#comment-330" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>FYI<br>
These are all routers somewhere on the network:<br>
10.254.64.74<br>
10.254.64.51<br>
10.254.40.74<br>
10.254.40.51</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-331" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-331">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 4:13 pm</li> <li><a href="#comment-331" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=331#respond" onclick='return addComment.moveForm( "div-comment-331", "331", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, the real issue is that you have a single IP address defined
 for each physical interface (eth0 and eth1), and yet you have multiple 
_overlapping_ netmasks defined for the routes in each interface.</p>
<p>For example, eth0:<br>
Class-A /8 – respond directly<br>
/22 – out to gateway</p>
<p>This makes the issue not as easy to solve, because normally you would
 assign the same netmask for each interface — or you could define 
multiple virtual interfaces with different IP addresses and netmask 
combinations.</p>
<p>In any event, I believe the following commands will work without 
having to define any virtual interfaces, but I have never tested this 
scenario, so you’ll have to try it out and see for yourself:</p>
<p>Here are the corresponding commands:<br>
printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “3\tuplink2\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “4\tuplink3\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 10.254.60.51/22 dev eth0 src 10.254.60.51 table uplink0<br>
ip route add default via 10.254.60.74 dev eth0 table uplink0<br>
ip rule add from 10.254.60.51/22 table uplink0<br>
ip rule add to 10.254.60.51/22 table uplink0</p>
<p>ip route add 10.254.60.51/8 dev eth0 src 10.254.60.51 table uplink1<br>
ip rule add from 10.254.60.51/8 table uplink1<br>
ip rule add to 10.254.60.51/8 table uplink1</p>
<p>ip route add 10.254.40.51/22 dev eth1 src 10.254.40.51 table uplink2<br>
ip route add default via 10.254.40.74 dev eth1 table uplink2<br>
ip rule add from 10.254.40.51/22 table uplink2<br>
ip rule add to 10.254.40.51/22 table uplink2</p>
<p>ip route add 10.254.40.51/8 dev eth1 src 10.254.40.51 table uplink3<br>
ip rule add from 10.254.40.51/8 table uplink3<br>
ip rule add to 10.254.40.51/8 table uplink3</p>
	</div>
	</div>
<ul class="children">
<li id="comment-332" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-332">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 21, 2010 at 11:28 am</li> <li><a href="#comment-332" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>For example, eth0:<br>
Class-A /8 – respond directly<br>
/22 – out to gateway</p>
<p>Yes, this is exactly this.  There is a multitude of overlapping netmasks here.   </p>
<p>I shall try all this on a test server, and then report back here.  This’ll be later tomorrow, as its nearly home time here.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-327" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-327">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 21, 2010 at 4:01 pm</li> <li><a href="#comment-327" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=327#respond" onclick='return addComment.moveForm( "div-comment-327", "327", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, here’s the set of rules for this scenario.  I assume that 
each interface actually has _two_ virtual IP addresses.  In this case, 
you would be defining “eth0:0 and eth0:1” as the virtual interfaces for 
eth0 and “eth1:0 and eth1:1” for the virtual interfaces for eth1.  If 
you’re not sure what this means or how to set it up, the SLES 
documentation about virtual interfaces should help.</p>
<p>Regardless, instead of thinking about two interfaces, think about 
this problem in terms of _four_ virtual interfaces.  If you split the 
problem based upon each virtual interface, it’s much easier to solve.  
See below for details.</p>
<p>Assumptions:<br>
eth0:0 – 10.254.60.90 netmask 255.255.252.0<br>
eth0:0’s gateway is: 10.254.60.74</p>
<p>eth0:1 – 10.254.60.51 netmask 255.0.0.0</p>
<p>eth1:0 – 10.254.41.13 netmask 255.255.252.0<br>
eth1:0’s gateway is: 10.254.40.74</p>
<p>eth1:1 – 10.254.40.51 netmask 255.0.0.0</p>
<p>Here are the corresponding commands:<br>
printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “3\tuplink2\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “4\tuplink3\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 10.254.60.90/22 dev eth0:0 src 10.254.60.90 table uplink0<br>
ip route add default via 10.254.60.74 dev eth0:0 table uplink0<br>
ip rule add from 10.254.60.90/22 table uplink0<br>
ip rule add to 10.254.60.90/22 table uplink0</p>
<p>ip route add 10.254.60.51/8 dev eth0:1 src 10.254.60.51 table uplink1<br>
ip rule add from 10.254.60.51/8 table uplink1<br>
ip rule add to 10.254.60.51/8 table uplink1</p>
<p>ip route add 10.254.41.13/22 dev eth1:0 src 10.254.41.13 table uplink2<br>
ip route add default via 10.254.40.74 dev eth1:0 table uplink2<br>
ip rule add from 10.254.41.13/22 table uplink2<br>
ip rule add to 10.254.41.13/22 table uplink2</p>
<p>ip route add 10.254.40.51/8 dev eth1:1 src 10.254.40.51 table uplink3<br>
ip rule add from 10.254.40.51/8 table uplink3<br>
ip rule add to 10.254.40.51/8 table uplink3</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-334" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-334">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">whynot</span></li>
		<li>Posted December 22, 2010 at 11:01 am</li> <li><a href="#comment-334" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=334#respond" onclick='return addComment.moveForm( "div-comment-334", "334", "respond", "4" )' aria-label="Reply to whynot">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Apologies. I;m confused.</p>
<p>Actually, your original thread was so close what I want to do, yet the ip rules you defined only ever mentioned eth0:<br>
  # eth0 – 10.10.70.38 netmask 255.255.255.0<br>
  # eth0’s gateway is: 10.10.70.254<br>
But never mentioned eth1:<br>
  # eth1 – 192.168.7.126 netmask 255.255.255.0<br>
  # eth1’s gateway is: 192.168.7.1</p>
<p>Since the eth1 is not mentioned, then I presume that it has to be 
indirectly decided upon by iproute, but this is where I lost the plot.  
 There are only these entries:<br>
 ip route add 10.10.70.0/24 dev eth0 src 10.10.70.38 table admin<br>
 ip route add default via 10.10.70.254 dev eth0 table admin<br>
 ip rule  add from 10.10.70.38/32 table admin<br>
 ip rule  add to 10.10.70.38/32 table admin<br>
Nor does it say what to add or remove for the 
/etc/sysconfig/network/routes table, which currently has some routing 
information in it</p>
<p>Anyway, cheers for your time.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-416" class="comment even depth-2 highlander-comment">
	<div id="div-comment-416">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted June 8, 2011 at 12:41 am</li> <li><a href="#comment-416" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=416#respond" onclick='return addComment.moveForm( "div-comment-416", "416", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>The default route for anything other than that subnet specified 
in the table is that which is set for the network. In other words: if 
those rules don’t apply to the packets, they head on out eth1 towards 
192.168.7.1 (unless the packets came from the 7.x network, in which case
 they would head on over to the machine that made the request.)</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-348" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-348">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Larry</span></li>
		<li>Posted February 16, 2011 at 7:43 am</li> <li><a href="#comment-348" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=348#respond" onclick='return addComment.moveForm( "div-comment-348", "348", "respond", "4" )' aria-label="Reply to Larry">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This may be an old post, but wonderfully explains how to properly
 set up the routes.  I’m running Ubuntu 10.04.  One note, if it’s not 
clear, I defined a gateway (192.168.1.1) for eth0 as my default in the 
/etc/network/interfaces file.  For eth1, I did not define a gateway, but
 rather set up the route as noted above.  Again, many thanks.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-400" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-400">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Vijay Upreti</span></li>
		<li>Posted April 13, 2011 at 10:02 am</li> <li><a href="#comment-400" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=400#respond" onclick='return addComment.moveForm( "div-comment-400", "400", "respond", "4" )' aria-label="Reply to Vijay Upreti">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Excellent article. It served most of my problem, specially where multiple vlan interfaces setup for different network.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-405" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-405">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">KS</span></li>
		<li>Posted May 3, 2011 at 4:18 am</li> <li><a href="#comment-405" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=405#respond" onclick='return addComment.moveForm( "div-comment-405", "405", "respond", "4" )' aria-label="Reply to KS">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Splendid post!! Thanks =))</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-406" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-406">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Otheus</span></li>
		<li>Posted May 5, 2011 at 7:02 am</li> <li><a href="#comment-406" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=406#respond" onclick='return addComment.moveForm( "div-comment-406", "406", "respond", "4" )' aria-label="Reply to Otheus">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-407" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-407">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.tabbasoum.com/" rel="external nofollow" class="url">Khalil</a></span></li>
		<li>Posted May 10, 2011 at 3:18 pm</li> <li><a href="#comment-407" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=407#respond" onclick='return addComment.moveForm( "div-comment-407", "407", "respond", "4" )' aria-label="Reply to Khalil">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This is really great. Finally got my bridged virtual VBOX server 
environment connected to the internet through a separate nic, leaving my
 primary nic for the physical ubuntu server access only.</p>
<p>This makes my virtual business environment finally completely safe and separate from my physical private environment.</p>
<p>Thanks a lot !</p>
<p>(If someone wants the setup details, leave a reply and I will post them.)</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-413" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-413">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://reddrgns.weebly.com/" rel="external nofollow" class="url">rishi</a></span></li>
		<li>Posted May 26, 2011 at 2:30 pm</li> <li><a href="#comment-413" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=413#respond" onclick='return addComment.moveForm( "div-comment-413", "413", "respond", "4" )' aria-label="Reply to rishi">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p><a href="http://reddragon-linux.blogspot.com/2011/05/linux-internet-gateway-server-setup.html" rel="nofollow">http://reddragon-linux.blogspot.com/2011/05/linux-internet-gateway-server-setup.html</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-421" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-421">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted August 1, 2011 at 5:27 pm</li> <li><a href="#comment-421" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=421#respond" onclick='return addComment.moveForm( "div-comment-421", "421", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Two years later, and this is the best post i found to accomplish 
the job without need to learn all about iptables, routes, rules, etc of a
 linux box (but still is necesary ;)).<br>
Thank you very much. You make my day a happy day<img scale="0" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/1f609.svg" alt="😉" draggable="false" class="emoji"></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-424" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-424">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">RG</span></li>
		<li>Posted August 11, 2011 at 10:26 am</li> <li><a href="#comment-424" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=424#respond" onclick='return addComment.moveForm( "div-comment-424", "424", "respond", "4" )' aria-label="Reply to RG">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you Thank you Thank you,<br>
I’ve been trying to shovel several vlans across as many openvpn tunnels 
on a virtual server without success for what felt like eternity, now in 2
 minutes flat it actually does stuff.  </p>
<p>Thanks again</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-426" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-426">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://apps.einsof-haras.ca/" rel="external nofollow" class="url">Sheck</a></span></li>
		<li>Posted August 17, 2011 at 5:54 pm</li> <li><a href="#comment-426" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=426#respond" onclick='return addComment.moveForm( "div-comment-426", "426", "respond", "4" )' aria-label="Reply to Sheck">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Man, Thank You !!!!!!</p>
<p>I spent days trying to solve this. This worked right away.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-427" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-427">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Andy Baker</span></li>
		<li>Posted August 23, 2011 at 5:22 pm</li> <li><a href="#comment-427" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=427#respond" onclick='return addComment.moveForm( "div-comment-427", "427", "respond", "4" )' aria-label="Reply to Andy Baker">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien,<br>
Thanks to you for great article and thanks to everyone else for some great reading.</p>
<p>Set this up on BackTrack 5 – 32 bit and it worked fine.  Now trying the same thing on BT5 R1 – 64 bit and it’s not playing</p>
<p>I have two distinct networks and never the twain shall meet.</p>
<p>My home network (eth0) is a 192.168.2.0/24 with the gateway as 192.168.2.1 and this connects to the internet<br>
My ‘special’ network (eth1) is a 10.0.0.16/28 with the gateway as 
10.0.0.17 and this connects nowhere due to some of the software sitting 
on the VM’s that live on this network (vm’s are fixed to eth1 only using
 VMWare Virtual Network Editor).  Both nics have static ip’s though it 
did work with DHCP when I had it running pre 64 bit install.</p>
<p>Here is what i’m getting<br>
have added following to <span class="skimlinks-unlinked">rc.local</span><br>
ip route add 192.168.2.0/24 dev oth0 src 192.168.2.30 table admin<br>
ip route add default via 192.168.2.1 dev eth0 table admin<br>
ip rule add from 192.168.2.30/32 table admin<br>
ip rule add to 192.168.2.30/32 table admin<br>
ip route flush cache</p>
<p>ip rule show<br>
0:          from all lookup local<br>
32764:   from all to 192.168.2.30 lookup admin<br>
32765:   from 192.168.2.30 lookup admin<br>
32766:   from all lookup main<br>
32767:   from all lookup default</p>
<p>ip route show<br>
default via 192.168.2.1 dev eth0   metric 100<br>
default via 10.0.0.17 dev eth1   metric 100<br>
10.0.0.16/28 dev eth1   proto kernel    scope link    src 10.0.0.20<br>
192.168.2.0/24 dev eth0   proto kernel   scope link   src 192.168.2.30</p>
<p>netstat -anr<br>
Kernel IP routing table<br>
Destination          Gateway               Genmask              Flags     MSS Window   irtt Iface<br>
0.0.0.0                192.168.2.1           0.0.0.0                  UG              0 0               0 eth0<br>
0.0.0.0                10.0.0.17              0.0.0.0                  UG              0 0               0 eth1<br>
10.0.0.16             0.0.0.0                 255.255.255.240    U                 0 0               0 eth1<br>
192.168.2.0         0.0.0.0                  255.255.255.0       U                 0 0               0 eth0</p>
<p>With eth1 enabled, I can’t access the internet or if I use ‘route del
 default gw 10.0.0.17’ it will let me connect to the internet until next
 time I reboot.  I had it working before and am now baffled as to why 
it’s playing silly buggers.  Have I missed something obvious above or 
can you think of something else I can try?</p>
<p>This system is a training rig and I need to be able to access the 
internet from the main machine whilst using the VM’s on their special 
network.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-428" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-428">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted August 23, 2011 at 9:44 pm</li> <li><a href="#comment-428" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=428#respond" onclick='return addComment.moveForm( "div-comment-428", "428", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Here’s your problem:</p>
<p>“netstat -anr<br>
…<br>
0.0.0.0 192.168.2.1 0.0.0.0 UG 0 0 0 eth0<br>
…”</p>
<p>You’ve _already_ specified a default route in the _admin_ table for 
eth0; as such, you should NOT specify a default route for eth0 in the 
_main_ table.</p>
<p>To correct this, remove the following command [FLAGGED] from your list:<br>
“ip route show<br>
default via 192.168.2.1 dev eth0 metric 100  &lt;— [REMOVE THIS ONE]<br>
default via 10.0.0.17 dev eth1 metric 100<br>
10.0.0.16/28 dev eth1 proto kernel scope link src 10.0.0.20<br>
192.168.2.0/24 dev eth0 proto kernel scope link src 192.168.2.30"</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-431" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-431">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted September 6, 2011 at 12:31 pm</li> <li><a href="#comment-431" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=431#respond" onclick='return addComment.moveForm( "div-comment-431", "431", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks!  This article really helped me.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-433" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-433">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">JuanV</span></li>
		<li>Posted September 17, 2011 at 4:04 pm</li> <li><a href="#comment-433" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=433#respond" onclick='return addComment.moveForm( "div-comment-433", "433", "respond", "4" )' aria-label="Reply to JuanV">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks man ! you saved my life<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"> i was looking this information from a long time ago.</p>
<p>cheers!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-457" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-457">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">sun</span></li>
		<li>Posted October 5, 2011 at 12:13 pm</li> <li><a href="#comment-457" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=457#respond" onclick='return addComment.moveForm( "div-comment-457", "457", "respond", "4" )' aria-label="Reply to sun">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>hi, and thank you for your post! i have a question….</p>
<p>eth0 – ip 10,60,90,45 gw 10,60,90,1<br>
eth1 – ip 10,60,91,45 gw 10,60,91,1<br>
Kernel IP routing table<br>
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>
10.60.90.0      *               255.255.255.0   U     0      0        0 eth0<br>
10.60.91.0      *               255.255.255.0   U     0      0        0 eth1<br>
link-local      *               255.255.0.0     U     0      0        0 eth0<br>
loopback        *               255.0.0.0       U     0      0        0 lo<br>
default         10.60.90.1      0.0.0.0         UG    0      0        0 eth0</p>
<p>if i need that a machine on 69,50,20,xx subnet can connect to 10,60,91,45 i add a new route </p>
<p>69,51,20,0      10,60,91,1      255,255,255,0   UG    0      0        0 eth1</p>
<p>but if i don’t know all the subnets or more easy, how can i do to all
 traffic that goes through an interface is returned by the same 
interface.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-604" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-604">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 15, 2011 at 10:34 am</li> <li><a href="#comment-604" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=604#respond" onclick='return addComment.moveForm( "div-comment-604", "604", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi sun,<br>
Take a look at the comments posted right after nobodyfamous:<br>
<a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-102" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-102</a></p>
<p>So, let’s assume:<br>
eth0 – 10.60.90.45 netmask 255.255.255.0<br>
eth0′s gateway is: 10.60.90.1</p>
<p>eth1 – 10.60.91.45 netmask 255.255.255.0<br>
eth1′s gateway is: 10.60.91.1</p>
<p>Here are the corresponding commands:</p>
<p>printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 10.60.90.0/24 dev eth0 src 10.60.90.45 table uplink0<br>
ip route add default via 10.60.90.1 dev eth0 table uplink0<br>
ip rule add from 10.60.90.45/32 table uplink0<br>
ip rule add to 10.60.90.45/32 table uplink0</p>
<p>ip route add 10.60.91.0/24 dev eth1 src 10.60.91.45 table uplink1<br>
ip route add default via 10.60.91.1 dev eth1 table uplink1<br>
ip rule add from 10.60.91.45/32 table uplink1<br>
ip rule add to 10.60.91.45/32 table uplink1</p>
<p>ip route flush</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-460" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-460">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ben</span></li>
		<li>Posted October 6, 2011 at 2:34 pm</li> <li><a href="#comment-460" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=460#respond" onclick='return addComment.moveForm( "div-comment-460", "460", "respond", "4" )' aria-label="Reply to ben">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>THANK YOU</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-593" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-593">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Marty M.</span></li>
		<li>Posted October 26, 2011 at 4:01 pm</li> <li><a href="#comment-593" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=593#respond" onclick='return addComment.moveForm( "div-comment-593", "593", "respond", "4" )' aria-label="Reply to Marty M.">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you!  Your page made it so simple to fix my routing 
dilemma!  I had two NICs on two separate dmz networks and needed to keep
 traffic on the the same NIC it started on.  And have a default gateway 
for each NIC.  This helped!  Great Work!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-601" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-601">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://may.be/" rel="external nofollow" class="url">Cliff</a></span></li>
		<li>Posted October 28, 2011 at 7:54 pm</li> <li><a href="#comment-601" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=601#respond" onclick='return addComment.moveForm( "div-comment-601", "601", "respond", "4" )' aria-label="Reply to Cliff">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Four years on, this is still the clearest guide to this.  It just works.</p>
<p>Thanks.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-602" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-602">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Birger</span></li>
		<li>Posted November 15, 2011 at 6:37 am</li> <li><a href="#comment-602" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=602#respond" onclick='return addComment.moveForm( "div-comment-602", "602", "respond", "4" )' aria-label="Reply to Birger">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the article.</p>
<p>Unfortunately it does not work in my setup.<br>
How can I make sure my kernel has support for policy routing?<br>
I use Proxmox Virtualization Environment (<a href="http://pve.proxmox.com/" rel="nofollow">http://pve.proxmox.com</a>) with kernel 2.6.32-6-pve.</p>
<p>My setup shows:</p>
<p>vserver3:~# ip rule show<br>
0:      from all lookup local<br>
32764:  from all to 192.44.37.62 lookup vmbr1<br>
32765:  from 192.44.37.62 lookup vmbr1<br>
32766:  from all lookup main<br>
32767:  from all lookup default</p>
<p>vserver3:~# ip route show<br>
192.168.20.0/24 dev vmbr101  proto kernel  scope link  src 192.168.20.1<br>
192.44.37.0/24 dev vmbr1  proto kernel  scope link  src 192.44.37.62<br>
192.168.19.0/24 dev vmbr100  proto kernel  scope link  src 192.168.19.1<br>
153.96.8.0/24 dev vmbr0  proto kernel  scope link  src 153.96.8.76<br>
default via 153.96.8.1 dev vmbr0</p>
<p>vserver3:~# ip route show table vmbr1<br>
192.44.37.0/24 dev vmbr1  scope link  src 192.44.37.62<br>
default via 192.44.37.101 dev vmbr1</p>
<p>I have vmbr100 connected via iptables NAT rules to vmbr0<br>
and vmbr101 via iptables NAT rules to vmbr1.</p>
<p>Connectivity of vmbr0 and vmbr100 works.<br>
Connectivity of vmbr1 and vmbr101 is limited to network 192.44.37.0/24.</p>
<p>Any ideas? Thanks.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-603" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-603">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 15, 2011 at 10:22 am</li> <li><a href="#comment-603" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=603#respond" onclick='return addComment.moveForm( "div-comment-603", "603", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Birger,</p>
<p>“vmbr*” interfaces are not standard network interfaces (<a href="http://pve.proxmox.com/wiki/Vlans" rel="nofollow">http://pve.proxmox.com/wiki/Vlans</a>) — they are bridging interfaces, which is why policy routing does NOT work properly.</p>
<p>In order to use policy routing, you need to assign one or more NICs 
(eth*) interfaces to a bridging interface (vmbr*), and then assign the 
routing to the attached eth* interface, accordingly.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-605" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-605">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.packetmischief.ca/" rel="external nofollow" class="url">Joel Knight</a></span></li>
		<li>Posted November 15, 2011 at 10:13 pm</li> <li><a href="#comment-605" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=605#respond" onclick='return addComment.moveForm( "div-comment-605", "605", "respond", "4" )' aria-label="Reply to Joel Knight">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>With respect to multiple default routes on OpenBSD: the virtual 
tables are primarily meant to create separate logical networks over top 
of a common base network. For instance you could create a private 
network for contractors which would keep them logically separated from 
your employees.</p>
<p>However within a routing table, OpenBSD actually supports equal-cost 
multipath route entries. The kernel will choose a path based on the 
result of a hash and send the packets on their way. It’s really easy to 
setup and does not require the complexity of virtual tables. Details are
 in the OpenBSD FAQ (<a href="http://www.openbsd.org/faq/faq6.html#Multipath" rel="nofollow">http://www.openbsd.org/faq/faq6.html#Multipath</a>).</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-606" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-606">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Birger</span></li>
		<li>Posted November 16, 2011 at 3:10 am</li> <li><a href="#comment-606" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=606#respond" onclick='return addComment.moveForm( "div-comment-606", "606", "respond", "4" )' aria-label="Reply to Birger">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the feedback.</p>
<p>Special Thanks to Darien for the very valuable blog post.</p>
<p>Everything works as expected. We tested the configuration with the 
command “ping -I vmbr1 …”, which gave an error “Destination host 
unreachable”. Now we found that ping is buggy.</p>
<p>“ping -I 192.44.37.62 …” works as expected. “wget -q -O – -bind-address=192.44.37.62 <a href="http://whatismyip.org/" rel="nofollow">http://whatismyip.org</a>” works also.</p>
<p>It does work with bridging interfaces and it does work in combination with NAT.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-607" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-607">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 16, 2011 at 7:32 am</li> <li><a href="#comment-607" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=607#respond" onclick='return addComment.moveForm( "div-comment-607", "607", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, glad to hear it works with bridging interfaces… I wasn’t 100% sure of this, as I had never tested it before.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-611" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-611">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">MyD</span></li>
		<li>Posted December 9, 2011 at 2:31 am</li> <li><a href="#comment-611" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=611#respond" onclick='return addComment.moveForm( "div-comment-611", "611", "respond", "4" )' aria-label="Reply to MyD">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>thx for this. you made my day. if you got 2 nics make sure you add two route tables</p>
<p># echo “1 uplink0” &gt;&gt; /etc/iproute2/rt_tables<br>
# echo “2 uplink1” &gt;&gt; /etc/iproute2/rt_tables</p>
<p># ip route add 192.168.0.0/24 dev eth0 src 192.168.0.101 table uplink0<br>
# ip route add default via 192.168.0.1 dev eth0 table uplink0<br>
# ip rule add from 192.168.0.101/32 table uplink0<br>
# ip rule add to 192.168.0.101/32 table uplink0</p>
<p># ip route add <span class="skimlinks-unlinked">xxx.xxx.xxx.0/24</span> dev eth3 src <span class="skimlinks-unlinked">xxx.xxx.xxx.219</span> table uplink1<br>
# ip route add default via <span class="skimlinks-unlinked">xxx.xxx.xxx.1</span> dev eth3 table uplink1<br>
# ip rule add from <span class="skimlinks-unlinked">xxx.xxx.xxx.219/32</span> table uplink1<br>
# ip rule add to <span class="skimlinks-unlinked">xxx.xxx.xxx.219/32</span> table uplink1<br>
(<span class="skimlinks-unlinked">xxx.xxx.xxx</span>. replace with your settings :P)</p>
<p>to make it permanent under gentoo you can use</p>
<p># nano /etc/local.d/<span class="skimlinks-unlinked">network.start</span> (<a href="http://de.gentoo-wiki.com/wiki/Local.d" rel="nofollow">http://de.gentoo-wiki.com/wiki/Local.d</a>)<br>
(add #!/bin/sh &amp; the ip xxx commandos; check with rc-update show if the local is added to the default level)<br>
# chmod +x /etc/local.d/<span class="skimlinks-unlinked">network.start</span> </p>
<p>have fun and enjoy!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-612" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-612">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Luke</span></li>
		<li>Posted December 13, 2011 at 12:50 am</li> <li><a href="#comment-612" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=612#respond" onclick='return addComment.moveForm( "div-comment-612", "612", "respond", "4" )' aria-label="Reply to Luke">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi. Great post and the comment stream is going strong…</p>
<p>I used your post to set up my system.</p>
<p>I have a gateway box with 2 NICs.<br>
One nic sits on the internal network (eth1; 192.168.0.7), the other nic (eth0; 110.<span class="skimlinks-unlinked">xxx.xxx.173</span>) connected to a 10 MBit pipe used for incoming VPN.<br>
There is an ADSL router (192.168.0.1) sitting on the network as well…<br>
Everyone on the network uses 192.168.0.1 as their gateway.<br>
I want people to be able to set 192.168.0.7 as their gateway if they have special speed needs.<br>
So what happens is that when the user’s (say user 192.168.0.10) gateway 
is set to 192.168.0.7 the traffic still goes via 192.168.0.1… whereas I 
want it to go through 110.<span class="skimlinks-unlinked">xxx.xxx.173</span>…</p>
<p> Host                                  Loss%   Snt   Last   Avg  Best  Wrst StDev<br>
 1. gateway1.e3(192.168.0.7)                         0.0%     4    0.1   0.2   0.1   0.2   0.0<br>
 2. <span class="skimlinks-unlinked">firewall.e3(192.168.0.1</span>)                         0.0%     4    0.4   0.5   0.4   0.5   0.0<br>
 3. ras8.<span class="skimlinks-unlinked">nap.net.au</span>      0.0%     3   30.0 146.9  30.0 263.7 165.2<br>
 4. g3.cor1.<span class="skimlinks-unlinked">adp.net.au</span>        0.0%     3  280.6 229.0 140.8 280.6  76.8<br>
 5. g1.<span class="skimlinks-unlinked">ap.net.au</span>      50.0%     3  155.1 155.1 155.1 155.1   0.0</p>
<p>here are my configs:</p>
<p>/etc/iproute2/rt_tables:</p>
<p>2 gatewayeth1<br>
3 gatewayeth0 </p>
<p>/etc/network/interfaces:<br>
# The primary network interface<br>
auto eth1<br>
iface eth1 inet static<br>
address 192.168.0.7<br>
netmask 255.255.255.0<br>
gateway 192.168.0.1</p>
<p># 10Mbit interface<br>
auto eth0<br>
iface eth0 inet static<br>
address 110.<span class="skimlinks-unlinked">xxx.xxx.174</span><br>
netmask 255.255.255.252<br>
gateway 110.<span class="skimlinks-unlinked">xxx.xxx.173</span></p>
<p>/etc/<span class="skimlinks-unlinked">rc.local</span>:<br>
ip route add 110.<span class="skimlinks-unlinked">xxx.xxx.172/30</span> dev eth0 src 110.<span class="skimlinks-unlinked">xxx.xxx.174</span> table gatewayeth0<br>
ip route add default via 110.<span class="skimlinks-unlinked">xxx.xxx.173</span> dev eth0 table gatewayeth0<br>
ip route add 192.168.0.0/24 dev eth1 src 192.168.0.7 table gatewayeth1<br>
ip route add default via 192.168.0.1 dev eth1 table gatewayeth1</p>
<p>ip rule add from 110.<span class="skimlinks-unlinked">xxx.xxx.174/32</span> table gatewayeth0<br>
ip rule add to 110.<span class="skimlinks-unlinked">xxx.xxx.174/32</span> table gatewayeth0<br>
ip rule add from 192.168.0.7/32 table gatewayeth1<br>
ip rule add to 192.168.0.7/32 table gatewayeth1</p>
<p>iptables rules:<br>
#! /bin/bash</p>
<p>iptables –flush</p>
<p>#NAT TABLE<br>
iptables -t nat –policy PREROUTING ACCEPT<br>
iptables -t nat –policy POSTROUTING ACCEPT<br>
iptables -t nat –policy OUTPUT ACCEPT<br>
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>
iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE</p>
<p>#FILTER TABLE<br>
iptables –policy INPUT DROP<br>
iptables –policy OUTPUT DROP<br>
iptables –policy FORWARD DROP</p>
<p># localhost rules<br>
iptables -A INPUT -i lo -j ACCEPT<br>
iptables -A OUTPUT -o lo -j ACCEPT</p>
<p># in chain for eth0 (outward facing telstra port on network 110.<span class="skimlinks-unlinked">xxx.xxx.172/30</span>)</p>
<p>iptables -X IN_RULES_ETH0<br>
iptables -N IN_RULES_ETH0<br>
iptables -A INPUT -i eth0 -j IN_RULES_ETH0</p>
<p># in chain for eth1 (inward facing internal network 192.168.0.0/24)</p>
<p>iptables -X IN_RULES_ETH1<br>
iptables -N IN_RULES_ETH1<br>
iptables -A INPUT -i eth1 -j IN_RULES_ETH1</p>
<p># out chain</p>
<p>iptables -X OUT_RULES<br>
iptables -N OUT_RULES<br>
iptables -A OUTPUT -j OUT_RULES</p>
<p># forward chain for eth1</p>
<p>iptables -X FORWARD_ETH1<br>
iptables -N FORWARD_ETH1<br>
iptables -A FORWARD -j FORWARD_ETH1</p>
<p># drop stuff for eth0<br>
# IN_RULES_ETH0<br>
iptables -A IN_RULES_ETH0 -s 10.0.0.0/8 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 172.16.0.0/12 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 192.168.0.0/16 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 224.0.0.0/4 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 240.0.0.0/5 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 127.0.0.0/8 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 0.0.0.0/8 -j DROP<br>
iptables -A IN_RULES_ETH0 -d 255.255.255.255 -j DROP<br>
iptables -A IN_RULES_ETH0 -s 169.254.0.0/16  -j DROP</p>
<p># drop stuff for eth1 allow only a few addresses<br>
# IN_RULES_ETH1<br>
iptables -A IN_RULES_ETH1 -m iprange –src-range 192.168.0.2-192.168.0.9 -j DROP<br>
iptables -A IN_RULES_ETH1 -m iprange –src-range 192.168.0.11-192.168.0.26 -j DROP<br>
iptables -A IN_RULES_ETH1 -m iprange –src-range 192.168.0.27-192.168.0.59 -j DROP<br>
iptables -A IN_RULES_ETH1 -m iprange –src-range 192.168.0.61-192.168.0.254 -j DROP<br>
iptables -A IN_RULES_ETH1 -s 169.254.0.0/16 -j DROP</p>
<p># drop stuff out rules<br>
iptables -A OUT_RULES -d 224.0.0.0/4 -j DROP</p>
<p># allow previously established / related connections<br>
iptables -A OUT_RULES -m state –state ESTABLISHED,RELATED -j ACCEPT<br>
iptables -A IN_RULES_ETH0 -m state –state ESTABLISHED,RELATED -j ACCEPT<br>
iptables -A IN_RULES_ETH1 -m state –state ESTABLISHED,RELATED -j ACCEPT</p>
<p># forward all on eth1<br>
iptables -A FORWARD_ETH1 -i eth1 -j ACCEPT<br>
iptables -A FORWARD_ETH1 -o eth1 -j ACCEPT</p>
<p>####################################################################<br>
# out services / ports</p>
<p># ICMP<br>
iptables -A OUT_RULES -p icmp -j ACCEPT<br>
# Port 22 (SSH)<br>
iptables -A OUT_RULES -p tcp –dport 22 -j ACCEPT<br>
# Port 1723 (VPN)<br>
iptables -A OUT_RULES -p tcp –dport 1723 -j ACCEPT</p>
<p># Port 123 (NTP)<br>
iptables -A OUT_RULES -p udp –dport 123 -j ACCEPT<br>
iptables -A OUT_RULES -p tcp –dport 123 -j ACCEPT</p>
<p>iptables -A OUT_RULES -j LOG –log-prefix “BLOCKED OUTPUT ”<br>
iptables -A OUT_RULES -j REJECT</p>
<p>####################################################################<br>
# input services / ports</p>
<p># ICMP<br>
iptables -A IN_RULES_ETH0 -p icmp -j ACCEPT<br>
iptables -A IN_RULES_ETH1 -p icmp -j ACCEPT</p>
<p># Port 22 (SSH)<br>
iptables -A IN_RULES_ETH0 -p tcp –dport 22 -m state –state NEW -j ACCEPT<br>
iptables -A IN_RULES_ETH1 -p tcp –dport 22 -m state –state NEW -j ACCEPT</p>
<p># Port 1723 (VPN)<br>
iptables -A IN_RULES_ETH0 -p tcp -m tcp –dport 1723 -j ACCEPT<br>
iptables -A IN_RULES_ETH0 -p gre -j ACCEPT</p>
<p>######################################################################</p>
<p># Drop MS NetBIOS scanning early (it spams the log)<br>
iptables -A IN_RULES_ETH0 -p tcp –dport 137 -j DROP<br>
iptables -A IN_RULES_ETH1 -p tcp –dport 137 -j DROP<br>
iptables -A IN_RULES_ETH0 -p udp –dport 137 -j DROP<br>
iptables -A IN_RULES_ETH1 -p udp –dport 137 -j DROP<br>
iptables -A IN_RULES_ETH0 -p tcp –dport 138 -j DROP<br>
iptables -A IN_RULES_ETH1 -p udp –dport 138 -j DROP</p>
<p># Log and reject<br>
iptables -A IN_RULES_ETH0 -j LOG –log-prefix “BLOCKED INPUT ”<br>
iptables -A IN_RULES_ETH1 -j LOG –log-prefix “BLOCKED INPUT ”<br>
iptables -A IN_RULES_ETH0 -j REJECT<br>
iptables -A IN_RULES_ETH1 -j REJECT</p>
<p>Thanks.<br>
Hopefully you can help me…</p>
<p>Best<br>
Luke.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-613" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-613">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 13, 2011 at 3:30 am</li> <li><a href="#comment-613" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=613#respond" onclick='return addComment.moveForm( "div-comment-613", "613", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>&gt; Hopefully you can help me…</p>
<p>Luke, I need some additional clarification… I assume you posted this 
information because multiple default routing for you isn’t working 
correctly — is that correct?  If so, can you clarify as to what is and 
is not working correctly? (e.g. which route works properly?)</p>
<p>Also, remove _all_ the firewall rules and just test to make sure 
multiple default routing works from the 192.168.0.7 system, first 
(without any further NAT’ing).  If multiple default routes for that host
 _fail_ to work, then the problem isn’t with your iptables rules — 
however, if multiple default routing _works_ from (just) the host 
without the iptable rules, then you’ve isolated the problem to your 
iptables rules.</p>
<p>The overall idea here, is to reduce the number variables in your configuration, in order to identify the root cause.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-614" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-614">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Luke</span></li>
		<li>Posted December 13, 2011 at 7:14 pm</li> <li><a href="#comment-614" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=614#respond" onclick='return addComment.moveForm( "div-comment-614", "614", "respond", "4" )' aria-label="Reply to Luke">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien. Thanks for your reply.<br>
The problem is that users on the 192.168.0.0 network who set their 
gateway to 192.168.0.7 should have their traffic go straight out through
 the 110.<span class="skimlinks-unlinked">xxx.xxx.173</span> interface, but it goes first to the 192.168.0.1 interface…<br>
I will try what you suggest and get back here…</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-615" class="comment even depth-3 highlander-comment">
	<div id="div-comment-615">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Luke</span></li>
		<li>Posted December 13, 2011 at 7:33 pm</li> <li><a href="#comment-615" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=615#respond" onclick='return addComment.moveForm( "div-comment-615", "615", "respond", "4" )' aria-label="Reply to Luke">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Ive removed the gateway statement from the local NIC for 192.168.0.7 and it seems to have fixed the problem.<br>
I thought that having routes added later (as in /etc/<span class="skimlinks-unlinked">rc.local</span>) would have overridden the default gateway set in /etc/network/interfaces but apparently not…</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-616" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-616">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Luke</span></li>
		<li>Posted December 13, 2011 at 7:35 pm</li> <li><a href="#comment-616" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=616#respond" onclick='return addComment.moveForm( "div-comment-616", "616", "respond", "4" )' aria-label="Reply to Luke">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien. Lastly is there a way I can edit my posts … I seem to 
have mentioned my ip address in my original post, although I thought I 
had edited them all, one still remains, could you replace with xxx… 
thanks</p>
	</div>
	</div>
<ul class="children">
<li id="comment-617" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-617">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 13, 2011 at 9:00 pm</li> <li><a href="#comment-617" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=617#respond" onclick='return addComment.moveForm( "div-comment-617", "617", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, this is fixed..</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-618" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-618">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Luke</span></li>
		<li>Posted December 13, 2011 at 9:15 pm</li> <li><a href="#comment-618" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=618#respond" onclick='return addComment.moveForm( "div-comment-618", "618", "respond", "4" )' aria-label="Reply to Luke">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks. You’re the man!</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-620" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-620">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">athaullah</span></li>
		<li>Posted December 30, 2011 at 7:11 am</li> <li><a href="#comment-620" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=620#respond" onclick='return addComment.moveForm( "div-comment-620", "620", "respond", "4" )' aria-label="Reply to athaullah">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I nee a help, I m delete device from ‘network configuration’ and 
again add it. It may be wrong so I unable to ping eventhough default 
gateway of my router. so plz guide me to configure properly to access 
internet via netgare 150 adsl router. plz replay in mail id : <a href="mailto:paradise_437@yahoo.com">paradise_437@yahoo.com</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-621" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-621">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">paradise</span></li>
		<li>Posted December 30, 2011 at 7:23 am</li> <li><a href="#comment-621" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=621#respond" onclick='return addComment.moveForm( "div-comment-621", "621", "respond", "4" )' aria-label="Reply to paradise">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>anybady online</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-623" class="comment byuser comment-author-deepstop even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-623">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Chris Sullivan</span></li>
		<li>Posted January 3, 2012 at 6:22 pm</li> <li><a href="#comment-623" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=623#respond" onclick='return addComment.moveForm( "div-comment-623", "623", "respond", "4" )' aria-label="Reply to Chris Sullivan">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks Darien, this has moved things forward for me. I hope that someone can help with the 1 (!) remainng problem.</p>
<p>I have eth0 on the 10.10.170 subnet and eth1 on the 10.10.177 subnet.
 There is more than 1 gateway on each subnet, for reasons I won’t go 
into. The suggestion in the initial post, modified for my circumstances,
 allowed me to ssh and ping into either interface. So far, so good. I 
wasn’t able to do that before. Now however, I’m having trouble 
transitting from one subnet to the other. I wanted to use the 
10.10.177.1 gateway, and that is how I set it up. However, a tracert 
tries to send me through the 10.10.177.2 gateway. I’ve searched the 
system and there is no mention of that ip address anywhere to be found.</p>
<p>Here’s the commands I used.</p>
<p>ip route add 10.10.177.0/24 dev eth1 src 10.10.177.20 table voice<br>
ip route add default via 10.10.177.1 dev eth1 table voice<br>
ip rule add from 10.10.177.20/32 table voice<br>
ip rule add to 10.10.177.20/32 table voice</p>
<p>This is under Centos 6</p>
<p>Cheers,<br>
Chris</p>
	</div>
	</div>
<ul class="children">
<li id="comment-624" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-624">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted January 3, 2012 at 11:42 pm</li> <li><a href="#comment-624" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=624#respond" onclick='return addComment.moveForm( "div-comment-624", "624", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Chris,</p>
<p>I’ll need more information about your network setup, including the configuration used to setup eth0.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-625" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-625">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://gravatar.com/sandm3n" rel="external nofollow" class="url">sandm3n</a></span></li>
		<li>Posted January 20, 2012 at 8:08 am</li> <li><a href="#comment-625" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=625#respond" onclick='return addComment.moveForm( "div-comment-625", "625", "respond", "4" )' aria-label="Reply to sandm3n">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, i’ve follow your step, but when i run /etc/init.d/networking restart  , the ip table admin is gone, how to save it?<br>
thanks</p>
	</div>
	</div>
<ul class="children">
<li id="comment-626" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-626">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted January 20, 2012 at 10:18 am</li> <li><a href="#comment-626" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=626#respond" onclick='return addComment.moveForm( "div-comment-626", "626", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>sandm3n: See this earlier comment:<br>
<a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-43" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#comment-43</a></p>
	</div>
	</div>
<ul class="children">
<li id="comment-627" class="comment even depth-3 highlander-comment">
	<div id="div-comment-627">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://gravatar.com/sandm3n" rel="external nofollow" class="url">sandm3n</a></span></li>
		<li>Posted January 20, 2012 at 10:27 am</li> <li><a href="#comment-627" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=627#respond" onclick='return addComment.moveForm( "div-comment-627", "627", "respond", "4" )' aria-label="Reply to sandm3n">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the ansewer, but i still confuse about this (i’m new 
in ubuntu) , i’ve problem about connection, you can see here (please) <a href="http://i41.tinypic.com/nl2as6.jpg" rel="nofollow">http://i41.tinypic.com/nl2as6.jpg</a></p>
<p>in that case, i want computer on lan, can connect through squid proxy
 to the internet, when i setting up without client connect, it can’t 
ping to LAN because of 10.10.7.0 default route (that connect to 
internet)<br>
when i disable that default route, i can successfully ping to lan, But link to internet is off. </p>
<p>How could i make two connection, so i can connect to LAN and the internet, i refer to your site but still not work.</p>
<p>Many thanks</p>
	</div>
	</div>
<ul class="children">
<li id="comment-628" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-628">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted January 20, 2012 at 10:38 am</li> <li><a href="#comment-628" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=628#respond" onclick='return addComment.moveForm( "div-comment-628", "628", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi sandm3n,</p>
<p>The problem is that your Squid proxy is running inside VMware.  I 
assume you are running VMware Workstation.  The problem you are running 
into is specific to VMware’s network configuration.</p>
<p>1) You need to change eth0 to use a vmnet that is _bridged_ with a physical network interface card (NIC).<br>
2) You need to change eth1 to use a vmnet that is _bridged_ with a _different_ physical network interface card (NIC).</p>
<p>Because you are using (host-only) and (NAT) for these interfaces, 
VMware is not letting the policy routing settings work correctly.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-629" class="comment even depth-5 highlander-comment">
	<div id="div-comment-629">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://gravatar.com/sandm3n" rel="external nofollow" class="url">sandm3n</a></span></li>
		<li>Posted January 20, 2012 at 11:14 am</li> <li><a href="#comment-629" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>i will let you know my whole simulated network, see here <a href="http://i40.tinypic.com/2f061hd.jpg" rel="nofollow">http://i40.tinypic.com/2f061hd.jpg</a>
 , using GNS3 virtual box edition with cisco router and inter vlan on 
it, i use Virtual Box as client, you can see cloud on the right that is 
connect to vmware (ubuntu server), client to client between vlan can 
connect .<br>
first question is my topology correct? on the cloud (server) i run Samba file sharing and Squid (not running)<br>
Do i must running samba and squid separately ?<br>
many thanks!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-630" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-630">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted January 20, 2012 at 11:41 am</li> <li><a href="#comment-630" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hi sandm3n,</p>
<p>You have enough complex components that I’d recommend testing the 
multiple default route settings on the Ubuntu server in _isolation_ from
 the rest of your network.  The samba and squid services running on the 
Ubuntu server do not matter.</p>
<p>Specifically, if you have two separate clients connected directly to 
the two interfaces on the Ubuntu server, and you can ping each interface
 separately from each client, then your multiple default route settings 
should be working properly.</p>
<p>Once you have established that this works, you can slowly increase 
the complexity of your network architecture and re-test these basic 
checks at each step (e.g., pinging each interface).  That way, when the 
test fails, you will be able to isolate which component is responsible 
for the problem.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-631" class="comment even depth-5 highlander-comment">
	<div id="div-comment-631">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://gravatar.com/sandm3n" rel="external nofollow" class="url">sandm3n</a></span></li>
		<li>Posted January 20, 2012 at 11:47 am</li> <li><a href="#comment-631" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Thanks for your nice advice, want to test your suggest first, i’ve to learn more about this, sorry if i bothering you Darien.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-632" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-632">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">samy</span></li>
		<li>Posted January 20, 2012 at 5:47 pm</li> <li><a href="#comment-632" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=632#respond" onclick='return addComment.moveForm( "div-comment-632", "632", "respond", "4" )' aria-label="Reply to samy">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great Article…</p>
<p>Thank you</p>
<p>I bookmarked this page</p>
<p>regards<br>
Samy</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-634" class="comment byuser comment-author-justmattb even thread-even depth-1 highlander-comment">
	<div id="div-comment-634">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Matt</span></li>
		<li>Posted March 2, 2012 at 3:34 am</li> <li><a href="#comment-634" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=634#respond" onclick='return addComment.moveForm( "div-comment-634", "634", "respond", "4" )' aria-label="Reply to Matt">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Wow, this absolutely saved my bacon; thanks for posting this. So 
easy to do and works like a champ (once you add everything into <span class="skimlinks-unlinked">rc.local</span> that is!).</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-643" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-643">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Jack D</span></li>
		<li>Posted April 23, 2012 at 2:44 am</li> <li><a href="#comment-643" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=643#respond" onclick='return addComment.moveForm( "div-comment-643", "643", "respond", "4" )' aria-label="Reply to Jack D">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I apologize if the question is stupid, I’m new with linux/ubuntu.<br>
I have a pc (ubuntu-server) with two network cards (eth0 and eth1).<br>
eth1 (ip 192.168.1.40) is connected to the internet (ADSL) via a gateway-router (ip 192.168.1.1).<br>
eth0 (ip 192.168.0.5) is connected to the Internet (another provider DSL) via another gateway-router (ip 192.168.0.1).<br>
I use eth1 for all internet and local connections.<br>
I just want to do a reverse ssh tunnel “ssh -R 9999: localhost: 22 <a href="mailto:xxxxx@123.432.xxx.xxx">xxxxx@123.432.xxx.xxx</a>” that go out to 123.432.<span class="skimlinks-unlinked">xxx.xxx</span> through eth0 so that if I’m connecting (from another PC on the internet)  to port localhost:9999 of 123.432.<span class="skimlinks-unlinked">xxx.xxx</span>
 I am redirected to my pc/ubuntu-server at it’s port 22 using the 
internet line of eth0 which has an upload bandwidth much greater than  
ADSL to which eth1 is connected.<br>
How can I do this?<br>
I must do what we are talking about in this article? Or just a rule of static route? Can you help? thanks infinitely</p>
	</div>
	</div>
<ul class="children">
<li id="comment-647" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-647">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted April 29, 2012 at 2:56 am</li> <li><a href="#comment-647" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=647#respond" onclick='return addComment.moveForm( "div-comment-647", "647", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Jack,</p>
<p>If you want all traffic destined for “123.132.x.x” to go out eth0, 
then you would need to create a static route that forces all 
“123.132.0.0/16” out through eth0, accordingly.</p>
<p>Specifically, the command is:<br>
route add -net 123.132.0.0 netmask 255.255.0.0 dev eth0</p>
	</div>
	</div>
<ul class="children">
<li id="comment-651" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-651">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Jack D</span></li>
		<li>Posted May 1, 2012 at 10:22 pm</li> <li><a href="#comment-651" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=651#respond" onclick='return addComment.moveForm( "div-comment-651", "651", "respond", "4" )' aria-label="Reply to Jack D">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks, it works fine.<br>
I used: </p>
<p>route add -host <span class="skimlinks-unlinked">xxx.xxx.xxx.xxx</span> gw 192.168.0.1 dev eth0</p>
<p>and to make it permanent I added to /etc/network/interfaces:</p>
<p>up route add -host <span class="skimlinks-unlinked">xxx.xxx.xxx.xxx</span> gw 192.168.0.1 dev eth0</p>
<p>where “<span class="skimlinks-unlinked">xxx.xxx.xxx.xxx</span>” is the ip of a ssh server.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-645" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-645">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">VIKAS</span></li>
		<li>Posted April 26, 2012 at 4:21 pm</li> <li><a href="#comment-645" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=645#respond" onclick='return addComment.moveForm( "div-comment-645", "645", "respond", "4" )' aria-label="Reply to VIKAS">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Very Nice info, neatly explained.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-646" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-646">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Tien</span></li>
		<li>Posted April 27, 2012 at 10:16 am</li> <li><a href="#comment-646" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=646#respond" onclick='return addComment.moveForm( "div-comment-646", "646", "respond", "4" )' aria-label="Reply to Tien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Good day Darien,</p>
<p>I nearly have the same situation you described.<br>
I have a strato vserver (2.6.18-028stab091.2) OpenSuSE 11.1:</p>
<p>&gt;ifconfig<br>
venet0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00<br>
inet addr:127.0.0.1 P-t-P:127.0.0.1 Bcast:0.0.0.0 Mask:255.255.255.255<br>
UP BROADCAST POINTOPOINT RUNNING NOARP MTU:1500 Metric:1</p>
<p>venet0:0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00<br>
inet addr:85.214.156.xxx P-t-P:85.214.156.xxx Bcast:0.0.0.0 Mask:255.255.255.255<br>
UP BROADCAST POINTOPOINT RUNNING NOARP MTU:1500 Metric:1</p>
<p>venet0:1 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00<br>
inet addr:81.169.166.xxx P-t-P:81.169.166.xxx Bcast:0.0.0.0 Mask:255.255.255.255<br>
UP BROADCAST POINTOPOINT RUNNING NOARP MTU:1500 Metric:1</p>
<p>&gt;uname -a<br>
Linux hxxxxxxx 2.6.18-028stab091.2 #1 SMP Fri Jun 3 00:02:40 MSD 2011 i686 athlon i386 GNU/Linux</p>
<p>&gt;netstat -rn<br>
Kernel IP routing table<br>
Destination Gateway Genmask Flags MSS Window irtt Iface<br>
127.0.0.0 0.0.0.0 255.0.0.0 U 0 0 0 lo<br>
0.0.0.0 0.0.0.0 0.0.0.0 U 0 0 0 venet0</p>
<p>&gt;route<br>
Kernel IP routing table<br>
Destination Gateway Genmask Flags Metric Ref Use Iface<br>
loopback * 255.0.0.0 U 0 0 0 lo<br>
default * 0.0.0.0 U 0 0 0 venet0</p>
<p>&gt;cat /etc/sysconfig/network/ifcfg-venet0<br>
STARTMODE=onboot<br>
BOOTPROTO=static<br>
BROADCAST=0.0.0.0<br>
NETMASK=255.255.255.255<br>
IPADDR=127.0.0.1<br>
IPADDR_0=85.214.156.xxx<br>
LABEL_0=0<br>
IPADDR_1=81.169.166.xxx<br>
LABEL_1=1</p>
<p>&gt;cat /etc/sysconfig/network/ifroute-venet0<br>
default – – venet0<br>
default :: – venet0</p>
<p>venet0:0 – IP 85.214.156.xxx netmask 255.255.255.255<br>
venet0:0 – gateway is: 0.0.0.0<br>
venet0:1 – IP 81.169.166.xxx netmask 255.255.255.0<br>
venet0:1 – gateway is: 0.0.0.0</p>
<p>My goal is to do exactly like that:<br>
<a href="http://www.linuxquestions.org/questions/linux-networking-3/ssh-tunneling-with-multiple-ips-720679/" rel="nofollow">http://www.linuxquestions.org/questions/linux-networking-3/ssh-tunneling-with-multiple-ips-720679/</a></p>
<p>Case 1) User (A) connects with putty sock5 tunnel to venet0:0 (outgoing traffic has to go back venet0:0)<br>
“C:\Program Files\putty\<span class="skimlinks-unlinked">plink.exe</span>” -ssh -T -D 7777 -load<br>
I configured my firefox for case 1)<br>
-&gt;Options-&gt;Advanced-&gt;Settings..-&gt;Manual proxy configuation-&gt;SOCKS Host: localhost, Port: 7777<br>
Now I can browse through that tunnel with the IP of linux server venet0:0<br>
Test with <a href="http://whatismyipaddress.com/" rel="nofollow">http://whatismyipaddress.com</a> shows 85.214.156.xxx -&gt; OK.</p>
<p>Case 2) User (B) connects with putty sock5 tunnel to 2nd IP (outgoing traffic has to go back venet0:1)<br>
“C:\Program Files\putty\<span class="skimlinks-unlinked">plink.exe</span>” -ssh -T -D 8888 -load<br>
I configured my firefox for case 2)<br>
-&gt;Options-&gt;Advanced-&gt;Settings..-&gt;Manual proxy configuation-&gt;SOCKS Host: localhost, Port: 8888<br>
Now I want to browse through that tunnel with the IP of linux server venet0:1</p>
<p>I tried to setup you wrote above, but the case 2) always show the IP of venet0:0<br>
Hope you and the other can help me.</p>
<p>Thanks and regards,<br>
Tien.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-648" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-648">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted April 29, 2012 at 3:20 am</li> <li><a href="#comment-648" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=648#respond" onclick='return addComment.moveForm( "div-comment-648", "648", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Tien,</p>
<p>Some of the information you provided in your example conflicts.</p>
<p>1) Earlier, you had said:<br>
&gt; venet0:1 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00<br>
&gt; inet addr:81.169.166.xxx P-t-P:81.169.166.xxx Bcast:0.0.0.0 Mask:255.255.255.255<br>
&gt; UP BROADCAST POINTOPOINT RUNNING NOARP MTU:1500 Metric:1</p>
<p>Notice that the netmask for this interface is 255.255.255.255</p>
<p>Then, you said:<br>
&gt; venet0:1 – IP 81.169.166.xxx netmask 255.255.255.0<br>
&gt; venet0:1 – gateway is: 0.0.0.0</p>
<p>In this case, the netmask is 255.255.255.0.</p>
<p>Which is it?  The netmask is either 255.255.255.255 or 255.255.255.0, but not both.</p>
<p>2) Also, both venet0:0 and venet0:1 need valid gateways:<br>
venet0:0 – gateway is: 0.0.0.0<br>
venet0:1 – gateway is: 0.0.0.0</p>
<p>The gateways you specified “0.0.0.0” are not valid, in this case.  
You need specific IP addresses for each gateway on each interface.</p>
<p>3) Therefore, let’s assume you had the following information:<br>
venet0:0 – 85.214.156.2 netmask 255.255.255.0<br>
venet0:0’s gateway is: 85.214.156.1</p>
<p>venet0:1 – 81.169.166.2 netmask 255.255.255.0<br>
venet0:1’s gateway is: 81.169.166.1</p>
<p>Here are the corresponding commands you would run:</p>
<p>printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 85.214.156.0/24 dev eth0 src 85.214.156.2 table uplink0<br>
ip route add default via 85.214.156.1 dev venet0:0 table uplink0<br>
ip rule add from 85.214.156.2/32 table uplink0<br>
ip rule add to 85.214.156.2/32 table uplink0</p>
<p>ip route add 81.169.166.0/24 dev eth1 src 81.169.166.2 table uplink1<br>
ip route add default via 81.169.166.1 dev venet0:1 table uplink1<br>
ip rule add from 81.169.166.2/32 table uplink1<br>
ip rule add to 81.169.166.2/32 table uplink1</p>
<p>ip route flush</p>
	</div>
	</div>
<ul class="children">
<li id="comment-649" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-649">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Tien</span></li>
		<li>Posted April 29, 2012 at 10:14 am</li> <li><a href="#comment-649" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=649#respond" onclick='return addComment.moveForm( "div-comment-649", "649", "respond", "4" )' aria-label="Reply to Tien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,<br>
Many thanks for the feedback.<br>
Yes you’re right, I pasted wrong regarding the netmask.<br>
Here is the right one:</p>
<p>venet0:0 – 85.214.156.2 netmask 255.255.255.255<br>
venet0:0′s gateway is: 0.0.0.0</p>
<p>venet0:1 – 81.169.166.2 netmask 255.255.255.255<br>
venet0:1′s gateway is: 0.0.0.0</p>
<p>I asked the guys from Strato provider (<a href="http://www.strato.de/server/virtual-linux-server/" rel="nofollow">http://www.strato.de/server/virtual-linux-server/</a>) to give me the gateways, they said this is a v-server and has gateway = 0.0.0.0<br>
With the route command I got that:<br>
&gt;route<br>
Kernel IP routing table<br>
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>
loopback        *               255.0.0.0       U     0      0        0 lo<br>
default         *               0.0.0.0         U     0      0        0 venet0</p>
<p>As I can see in your example with eth0 &amp; eth1, I do only have venet0, venet0:0 &amp; venet0:1</p>
	</div>
	</div>
<ul class="children">
<li id="comment-650" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-650">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 1, 2012 at 10:34 am</li> <li><a href="#comment-650" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=650#respond" onclick='return addComment.moveForm( "div-comment-650", "650", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Tien,</p>
<p>I’m skeptical that the real gateway is 0.0.0.0… The best way to know 
for sure, would be to run tcpdump on your two interfaces (venet0:0 and 
venet0:1), and see what the destination IP address is, when you issue a 
traceroute to a server on the internet (e.g., “traceroute <span class="skimlinks-unlinked">yahoo.com</span>”).</p>
<p>So, to be clear, the steps would be:</p>
<p>1) tcpdump -ni venet0:0<br>
2) traceroute <span class="skimlinks-unlinked">yahoo.com</span><br>
3) Look at the destination IP addresses listed in the traceroute output and packet dump</p>
<p>You can repeat these steps for venet0:1, also.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-652" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-652">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted May 14, 2012 at 10:52 pm</li> <li><a href="#comment-652" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hi,Darien<br>
    Very thanks for your article,i have same situation and i need your <span class="skimlinks-unlinked">help.my</span> vps have 2ips,and they all use a NIC venet0,vent0:0 vent0:1<br>
 DEVICE = venet0<br>
 BOOTPROTO = static<br>
 ONBOOT = yes<br>
 IPADDR = 127.0.0.1<br>
 NETMASK = 255.255.255.255<br>
 BROADCAST = 0.0.0.0<br>
 IPV6INIT = “yes”</p>
<p>DEVICE = venet0:0<br>
BOOT = yes<br>
IPADDR=119.<span class="skimlinks-unlinked">XX.XX.206</span><br>
NETMASK = 255.255.255.255</p>
<p>DEVICE = venet0:1<br>
ONBOOT = yes<br>
IPADDR = 119.<span class="skimlinks-unlinked">XX.XX.245</span><br>
NETMASK = 255.255.255.255<br>
how to achive accessing ip1 get ip1,acessing ip2 get ip2? I think i need a correct code similar the following for my case.<br>
—-quote—<br>
printf “1\tuplink0\n” &gt;&gt; /etc/iproute2/rt_tables<br>
printf “2\tuplink1\n” &gt;&gt; /etc/iproute2/rt_tables</p>
<p>ip route add 85.214.156.0/24 dev eth0 src 85.214.156.2 table uplink0<br>
ip route add default via 85.214.156.1 dev venet0:0 table uplink0<br>
ip rule add from 85.214.156.2/32 table uplink0<br>
ip rule add to 85.214.156.2/32 table uplink0</p>
<p>ip route add 81.169.166.0/24 dev eth1 src 81.169.166.2 table uplink1<br>
ip route add default via 81.169.166.1 dev venet0:1 table uplink1<br>
ip rule add from 81.169.166.2/32 table uplink1<br>
ip rule add to 81.169.166.2/32 table uplink1</p>
<p>ip route flush<br>
—–quote—-<br>
pls write a correct codes smilar to the above,thanks very much. i am not
 good at programming and linux so i expect to get a very correct code 
and input in my <span class="skimlinks-unlinked">vps.pls</span> attention to if the “eth0″,”eth1” is correct,because i pass these codes to my providers to help me they told me the eth0 cause <span class="skimlinks-unlinked">error.eth0</span> don’t exist and replace it with venet0:0 cause error :RTNETLINK answers:invalid argument,so looking forwards to your help.</p>
<p>Best Regards<br>
Thomas</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-658" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-658">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 22, 2012 at 8:56 am</li> <li><a href="#comment-658" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hi Thomas, what is the default gateway for each interface in your setup?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-664" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-664">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Martin Kealey</span></li>
		<li>Posted June 11, 2012 at 1:41 am</li> <li><a href="#comment-664" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>vservers are “thin” virtual machines which hand off to the real 
machine to do actual routing, so the “gateway” is meaningless and left 
as 0.0.0.0. If you want policy routing it would have to be done in the 
real machine.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-665" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-665">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted June 11, 2012 at 3:34 am</li> <li><a href="#comment-665" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the clarification, Martin!</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-656" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-656">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Abhay Kumar</span></li>
		<li>Posted May 22, 2012 at 4:16 am</li> <li><a href="#comment-656" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=656#respond" onclick='return addComment.moveForm( "div-comment-656", "656", "respond", "4" )' aria-label="Reply to Abhay Kumar">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I am connected to 2 interfaces simultaneously like eth0 and 
wlan0. And eth0 is the default interface. Now I start downloading 
something on the eth0 interface. In midst of the download if I change 
the default interface to wlan0, the download breaks. I don’t understand 
why this happens. Can you please tell me ??</p>
	</div>
	</div>
<ul class="children">
<li id="comment-657" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-657">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted May 22, 2012 at 8:52 am</li> <li><a href="#comment-657" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=657#respond" onclick='return addComment.moveForm( "div-comment-657", "657", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Abhay, that is because you only have one default route setup.  
During your download, the application probably got temporarily 
disconnected and tried to resume the download after the default gateway 
switched.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-659" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-659">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted May 30, 2012 at 1:01 pm</li> <li><a href="#comment-659" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=659#respond" onclick='return addComment.moveForm( "div-comment-659", "659", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I love you man!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-660" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-660">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Brett</span></li>
		<li>Posted June 3, 2012 at 7:37 am</li> <li><a href="#comment-660" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=660#respond" onclick='return addComment.moveForm( "div-comment-660", "660", "respond", "4" )' aria-label="Reply to Brett">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien, </p>
<p>Awesome post. I have followed your post, and definitely learnt more about routing in linux. Thanks. </p>
<p>Now to my problem. I have a web server with two NIC’s: </p>
<p>eth0 is used as the local network nic: 192.168.250.43/24 (no gateway)<br>
eth1 is used as the public network nic: 41.222.8.146/29 (gateway 41.222.8.145)</p>
<p>eth1 is the default route, and the only device with a specified gateway.</p>
<p>If I ping from an external address, I get replies on the 
external/public IP for roughly 5 min, and then the time-outs start, 
which continue indefinitely. If, however, I ping the public IP’s primary
 DNS, on the webserver itself, I start getting replies again on the 
external PC I am polling connectivity on. </p>
<p>Is this a routing issue on my webserver, or a routing issue on my router, or is it a non-routing issue. </p>
<p>Thanks again for the great post.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-661" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-661">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted June 4, 2012 at 7:44 am</li> <li><a href="#comment-661" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=661#respond" onclick='return addComment.moveForm( "div-comment-661", "661", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>While this isn’t a multi-default route issue, It sounds like you 
have some sort stateful packet inspection (SPI) firewall between your 2 
NIC system and the external system you are pinging from.  The firewall 
could be built into the 2 NIC system — not 100% sure.  Regardless, this 
issue is quite common in those types of setups.  Specifically the 
outbound traffic from the 2 NIC system through the SPI firewall triggers
 the firewall to allow reply traffic for a set period of time (a max 
timeout).  Therefore, you’ll need to check the systems for corresponding
 firewalls.  Disabling them altogether should alleviate this problem. </p>
<p>Regards, </p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-667" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-667">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Patrick</span></li>
		<li>Posted June 21, 2012 at 12:02 pm</li> <li><a href="#comment-667" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=667#respond" onclick='return addComment.moveForm( "div-comment-667", "667", "respond", "4" )' aria-label="Reply to Patrick">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you very much. I was having this issue since yesterday. Your email just save my day and my job too. You are a star.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-668" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-668">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">csaba</span></li>
		<li>Posted June 27, 2012 at 4:44 am</li> <li><a href="#comment-668" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=668#respond" onclick='return addComment.moveForm( "div-comment-668", "668", "respond", "4" )' aria-label="Reply to csaba">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Many thanks to You !!!!!!</p>
<p>I spent days trying to solve this. I even gave up on it but had to 
start again several times. This worked right away and finally I can move
 up with my network upgrade.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-670" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-670">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.facebook.com/john.eck.33" rel="external nofollow" class="url">John Eck</a></span></li>
		<li>Posted July 3, 2012 at 10:33 am</li> <li><a href="#comment-670" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=670#respond" onclick='return addComment.moveForm( "div-comment-670", "670", "respond", "4" )' aria-label="Reply to John Eck">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Exactly what I was looking for, this worked perfectly.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-672" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-672">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://zahidhaseeb.wordpress.com/" rel="external nofollow" class="url">zahidhaseeb</a></span></li>
		<li>Posted July 6, 2012 at 1:03 am</li> <li><a href="#comment-672" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=672#respond" onclick='return addComment.moveForm( "div-comment-672", "672", "respond", "4" )' aria-label="Reply to zahidhaseeb">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Is not that possible that we can add a static route on one ethernet and add a default gateway on one ethernet ?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-674" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-674">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 6, 2012 at 9:07 am</li> <li><a href="#comment-674" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=674#respond" onclick='return addComment.moveForm( "div-comment-674", "674", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Yes, that is possible, but I’m not sure that is what you mean. </p>
<p>Regards, </p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-673" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-673">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://zahidhaseeb.wordpress.com/" rel="external nofollow" class="url">zahidhaseeb</a></span></li>
		<li>Posted July 6, 2012 at 1:04 am</li> <li><a href="#comment-673" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=673#respond" onclick='return addComment.moveForm( "div-comment-673", "673", "respond", "4" )' aria-label="Reply to zahidhaseeb">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>is not that possible that we can add a static route on one ethernet and keep another ethernet on default gateway</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-675" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-675">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">JD</span></li>
		<li>Posted July 7, 2012 at 7:23 am</li> <li><a href="#comment-675" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=675#respond" onclick='return addComment.moveForm( "div-comment-675", "675", "respond", "4" )' aria-label="Reply to JD">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Wow 200 posts (this is 201 for those keeping count) and 5 1/2 years later, amazing article…</p>
<p>2 things.. first let me quote you… “this information is designed 
primarily to preserve my sanity”, hows that working out for you?</p>
<p>And second, Im using Ubuntu 12.04.<br>
&gt; netstat -anr</p>
<p>Kernel IP routing table<br>
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface<br>
0.0.0.0         192.168.1.1     0.0.0.0         UG        0 0          0 control<br>
0.0.0.0         192.168.2.1     0.0.0.0         UG        0 0          0 wlan<br>
192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 control<br>
192.168.2.0     0.0.0.0         255.255.255.0   U         0 0          0 wlan</p>
<p>the was after adding “route add default gw 192.168.1.1” to /etc/<span class="skimlinks-unlinked">rc.local</span><br>
the second line “0.0.0.0         192.168.2.1     0.0.0.0         UG     
   0 0          0 wlan” should not be there, ever.  But when ubuntu 
boots up, the wlan device is the once to get the lease first.  How can I
 set the default gateway in this multi-nic system…  At the same time, 
the machine needs to talk to everything on the 192.168.2.X network as 
well.</p>
<p>Thanks, and again… wow.. really impressive article, I read every post, you are a trove of information.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-676" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-676">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">JD</span></li>
		<li>Posted July 7, 2012 at 7:41 am</li> <li><a href="#comment-676" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=676#respond" onclick='return addComment.moveForm( "div-comment-676", "676", "respond", "4" )' aria-label="Reply to JD">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Never mind. I remembered something you said in one of the comments, tried it, and it works…</p>
<p>I’m not saying what or what comment, because people should really 
read all of it before posting, all the information is there.. really 
amazing.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-677" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-677">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ahmed</span></li>
		<li>Posted July 17, 2012 at 3:15 am</li> <li><a href="#comment-677" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=677#respond" onclick='return addComment.moveForm( "div-comment-677", "677", "respond", "4" )' aria-label="Reply to ahmed">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>i did as per ur article but the problem is not solved<br>
eth0 = 10.0.0.2<br>
eth1= 192.168.5.102<br>
default gateway is 192.168.5.1<br>
gateway for eth0 is 10.0.0.138<br>
when i am pinging it tries to go via 192. which i dont want it should go thru 10…<br>
so i did<br>
ip route add 10.0.0.0/24 dev eth0 src 10.0.0.2 table admin<br>
 ip route add default via 10.0.0.138 dev eth0 table admin </p>
<p>============================</p>
<p> ip rule add from 10.0.0.2/32 table admin</p>
<p>ip rule add to 10.0.0.2/32 table admin</p>
<p>==================================</p>
<p> ip rule show<br>
0:      from all lookup 255<br>
32764:  from all to 10.0.0.2 lookup admin<br>
32765:  from 10.0.0.2 lookup admin<br>
32766:  from all lookup main<br>
32767:  from all lookup default<br>
============================</p>
<p>but still</p>
<p> ping <span class="skimlinks-unlinked">smtp.bizmail.yahoo.com</span><br>
PING <span class="skimlinks-unlinked">smtp.bizmail.yahoo.com</span> (98.139.221.126) 56(84) bytes of data.<br>
From 192.168.5.102 icmp_seq=1 Destination Host Unreachable<br>
From 192.168.5.102 icmp_seq=2 Destination Host Unreachable<br>
From 192.168.5.102 icmp_seq=3 Destination Host Unreachable</p>
<p>it is still going thru 192…</p>
	</div>
	</div>
<ul class="children">
<li id="comment-678" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-678">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 17, 2012 at 9:12 am</li> <li><a href="#comment-678" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=678#respond" onclick='return addComment.moveForm( "div-comment-678", "678", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Ahmed, </p>
<p>Okay, then switch your configuration where eth0 is set by default and use table “admin” to define your eth1 settings. </p>
<p>Regards, </p>
	</div>
	</div>
<ul class="children">
<li id="comment-679" class="comment even depth-3 highlander-comment">
	<div id="div-comment-679">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ahmed</span></li>
		<li>Posted July 18, 2012 at 3:17 am</li> <li><a href="#comment-679" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=679#respond" onclick='return addComment.moveForm( "div-comment-679", "679", "respond", "4" )' aria-label="Reply to ahmed">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>i did the opposite</p>
<p>ip rule show<br>
0:      from all lookup 255<br>
32764:  from all to 192.168.5.102 lookup admin<br>
32765:  from 192.168.5.102 lookup admin<br>
32766:  from all lookup main<br>
32767:  from all lookup default<br>
==============================================<br>
still the problem exist<br>
when i am pinging to outside it is try to go via 192.168.. , i want it to go via eth0 10.0.0. … bcause<br>
dont know  y its not working for me</p>
	</div>
	</div>
<ul class="children">
<li id="comment-680" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-680">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 18, 2012 at 8:26 am</li> <li><a href="#comment-680" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=680#respond" onclick='return addComment.moveForm( "div-comment-680", "680", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Okay, I see another issue.  Your first rule has: </p>
<p>0: from all lookup 255 </p>
<p>And that should be instead: </p>
<p>0: from all lookup local </p>
<p>Perhaps “255” = “local” on your system, but I don’t know that for sure. </p>
<p>Regards, Darien </p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-681" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-681">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Karthik</span></li>
		<li>Posted July 26, 2012 at 3:45 pm</li> <li><a href="#comment-681" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=681#respond" onclick='return addComment.moveForm( "div-comment-681", "681", "respond", "4" )' aria-label="Reply to Karthik">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, This is a great post. thanks again,.<br>
One question – How do you print the routing table the one you created as
 “admin” in the above example? how do I see my connection to the 
particular IP uses the correct gateway?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-682" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-682">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 26, 2012 at 3:50 pm</li> <li><a href="#comment-682" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=682#respond" onclick='return addComment.moveForm( "div-comment-682", "682", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>“ip route show table main” and “ip route show table default” </p>
<p>Regards, </p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-684" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-684">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted August 3, 2012 at 1:14 pm</li> <li><a href="#comment-684" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=684#respond" onclick='return addComment.moveForm( "div-comment-684", "684", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi all,</p>
<p>I am trying to create the following set up</p>
<p>I have following linux networking set up.</p>
<p>Machine A Ip-10.8.11.100 (Source machine)<br>
Machine B ip-10.8.11.1 (acting as a gateway for 10.5.0.0 network )<br>
Machine C ip-10.8.11.2 (acting as a gateway for 192.68.11.0 network )<br>
Machine D ip-10.5.0.1 (Dest machine)<br>
Machine E ip-192.168.11.1 (Dest machine)<br>
Machine F ip-10.8.11.5 (default agteway)</p>
<p>Now I want to add both the destination networks into Machine A so 
that I should able to ping ip address of both the networks from it.</p>
<p>The rules and routes that I ave added on machine A a below :-</p>
<p>$ip rule add from 10.8.11.100 table 2<br>
$ip route add 10.5.0.0/24 via 10.8.11.1 dev eth0 src 10.8.11.100 table 2<br>
$ip route add 192.168.11.1 via 10.8.11.2 dev eth0 src 10.8.11.100 table 2<br>
$ip route add default via 10.8.11.5 table 2<br>
$ip route flush cache</p>
<p>Here the rules on the Machine A</p>
<p>$ip rule show<br>
0: from all lookup local<br>
32763: from 10.8.11.100 lookup 2<br>
32766: from all lookup main<br>
32767: from all lookup default</p>
<p>Here are the routes in table 2 of machine A</p>
<p>$ip route show table 2<br>
192.168.11.0/24 via 10.8.11.2 dev eth0 src 10.8.11.100<br>
10.5.0.0/24 via 10.8.11.1 dev eth0 src 10.8.11.100<br>
default via 10.8.11.5 dev eth0</p>
<p>Now what is happening is when I trying to ping any destination from 
Machine A, I am not getting any ping reply from any of the network and I
 think the packet is also not reaching to destination machine as I am 
not seeing anything in the tcpdump traces at the destination.(Machine D 
&amp; Machine E).</p>
<p>Now when I am adding the same rules to the main table of linux 
everything is working fine . I can able to ping all the static as well 
as default networks from machine A.</p>
<p>I don’t know whts was happening when I am adding the same routes to table 2.</p>
<p>A part from that I am directly using the table index 2 without adding its entry in /etc/iproute2/rt_tables file.<br>
Is it necessary to add the table name into that file.?</p>
<p>I did that as well but looks like it is not working out.<br>
How can we know which routing table currently linux is using.?</p>
<p>Please help me here</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-685" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-685">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Dean Kamali</span></li>
		<li>Posted August 30, 2012 at 2:11 pm</li> <li><a href="#comment-685" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=685#respond" onclick='return addComment.moveForm( "div-comment-685", "685", "respond", "4" )' aria-label="Reply to Dean Kamali">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks alot, worked for me!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-688" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-688">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted September 12, 2012 at 7:49 am</li> <li><a href="#comment-688" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=688#respond" onclick='return addComment.moveForm( "div-comment-688", "688", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Finally found the webpage that sorted my multi nic networking issues.  Excellent post.  Followed it, and it worked a treat.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-691" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-691">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted September 14, 2012 at 10:11 am</li> <li><a href="#comment-691" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=691#respond" onclick='return addComment.moveForm( "div-comment-691", "691", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I am having trouble getting broadcast message to their respective
 networks/interface. All broadcast messages to 255.255.255.255 go out 
the default route in the main table even if I set up default routes in 
other tables and create the rules to use those routes.</p>
<p>Should the advanced routing features handle broadcasting or is the 
kernel/library somehow changing the broadcast message to the default 
route address before getting to the routing library?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-696" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-696">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://twitter.com/sxty1" rel="external nofollow" class="url">I, Geek (@sxty1)</a></span></li>
		<li>Posted November 4, 2012 at 10:35 pm</li> <li><a href="#comment-696" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=696#respond" onclick='return addComment.moveForm( "div-comment-696", "696", "respond", "4" )' aria-label="Reply to I, Geek (@sxty1)">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Wow! Such a great post! It still comes up at the top although it was written so long ago!<br>
I don’t know if you keep up the comments but I am really hoping that you do.<br>
I have a question for you… I am trying to use your guide with multiple 
wifi connections. Is that any different than wired ones? I’m thinking 
that it shouldn’t right?<br>
For example I want all peer 2 peer traffic to go through wlan1. I’ve 
selected the appropriate option in ktorrent for limiting all traffic to 
wlan1 and created a p2p rule table following your guide. Before reading 
your post (and realizing that connections still go out from the default 
route) when I was limiting ktorrent to wlan1, I would see no traffic…0.<br>
Now I created a new table rule like you are doing with admin, however 
when I do ‘netstat -n | grep LISTENING’ established connections are 
still bound to the primary ip address (wlan0) and not wlan1. Is there a 
reason why those new connections are not listening to the additional ip 
address? The weird thing is that now I do see traffic in ktorrent, 
albeit slow, but I do see some. But even regardless of peer to peer 
traffic, not even 1 connection is listed as LISTENING for the secondary 
wlan1 ip? All connecitons are listening on the primary (wlan0) ip. What 
do you make of that?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-697" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-697">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 5, 2012 at 1:43 pm</li> <li><a href="#comment-697" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=697#respond" onclick='return addComment.moveForm( "div-comment-697", "697", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, </p>
<p>Yes, policy routing works on any type of network interface — wired or wireless. </p>
<p>It sounds like some sort of ‘ktorrent’ problem, then.  Specifically, 
if you configured ktorrent to only use wlan1, but it _still_ uses wlan0,
 then it sounds like a but with ktorrent, regardless of policy routing 
settings. </p>
<p>I’d recommend reaching out to the ktorrent support mailing lists and 
find out if this is a known or unknown issue.  If you completely turn 
off policy routing _and_ ktorrent _still_ uses wlan0 (even when you 
explicitly set wlan1), then completely disable wlan0 and see if ktorrent
 still works properly.  If not, then it sounds like ktorrent has a bug 
where it always uses the first registered interface of the system. </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-699" class="comment even depth-3 highlander-comment">
	<div id="div-comment-699">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://twitter.com/sxty1" rel="external nofollow" class="url">I, Geek (@sxty1)</a></span></li>
		<li>Posted November 6, 2012 at 2:57 am</li> <li><a href="#comment-699" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=699#respond" onclick='return addComment.moveForm( "div-comment-699", "699", "respond", "4" )' aria-label="Reply to I, Geek (@sxty1)">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you for the reply,<br>
so you were right, it was a bug with ktorrent. I managed to make it work with Vuse though.<br>
Also I made it work with the following two commands:</p>
<p>ip route add table 2 default via 192.168.1.1<br>
ip rule add from 192.168.1.0/24 table 2</p>
<p>here’s my rules table:<br>
0:      from all lookup local<br>
32765:  from 192.168.1.0/24 lookup 2<br>
32766:  from all lookup main<br>
32767:  from all lookup default </p>
<p>going over your post again I noticed that 32764 is missing. I don’t 
mean to sound stupid but would you mind explaining a bit more why do we 
need 32764 *and* 32765? </p>
<p>thank you!</p>
<p>PS: It’s such a shame that you stopped blogging! Got too busy? You 
have some really nice posts, and judging by the number of comments 
pretty good audience.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-700" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-700">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 6, 2012 at 6:23 am</li> <li><a href="#comment-700" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=700#respond" onclick='return addComment.moveForm( "div-comment-700", "700", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>&gt; so you were right, it was a bug with ktorrent. I managed to make it work with Vuse though. </p>
<p>I figured.<img scale="0" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/1f609.svg" alt="😉" draggable="false" class="emoji"> </p>
<p>&gt; Also I made it work with the following two commands: &gt; &gt; 
ip route add table 2 default via 192.168.1.1 &gt; ip rule add from 
192.168.1.0/24 table 2 &gt; &gt; here’s my rules table: &gt; 0:      
from all lookup local &gt; 32765:  from 192.168.1.0/24 lookup 2 &gt; 
32766:  from all lookup main &gt; 32767:  from all lookup default &gt; 
&gt; going over your post again I noticed that 32764 is missing. I don’t
 mean to sound stupid but would you mind explaining a bit more why do we
 need 32764 *and* 32765? </p>
<p>Sure.  Without 32764, any traffic from the internet going to 
192.168.1.0/24would get directly routed your default interface, instead 
of the secondary interface (e.g., 192.168.1.1).  This only matters if 
your secondary interface is connected to some sort of upstream network 
translation device (NAT) that is able to route your RFC 1819 addressable
 interface out to the internet.  If that’s the case (most likely), then 
you’ll find that any internet-based traffic going to IP 192.168.1.1 will
 likely go through your primary interface, instead of your secondary 
interface. </p>
<p>You can run tcpdump on all interfaces to confirm this, by issuing a 
simple ping out to the internet, where you specify that it should use 
the secondary interface for all outbound traffic. </p>
<p>&gt; PS: It’s such a shame that you stopped blogging! Got too busy? 
You have some really nice posts, and judging by the number of comments 
pretty good audience. </p>
<p>Thanks.  I don’t have much time to blog publicly, currently.  As 
such, I tend to try and stick to topics that aren’t already discussed on
 the internet, elsewhere.  Therefore, if I come across an issue that 
isn’t easily found via standard Google searches, I’ll likely create a 
future blog post about it.<img scale="0" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/1f609.svg" alt="😉" draggable="false" class="emoji"> </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-701" class="comment even depth-5 highlander-comment">
	<div id="div-comment-701">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://twitter.com/sxty1" rel="external nofollow" class="url">I, Geek (@sxty1)</a></span></li>
		<li>Posted November 6, 2012 at 6:51 pm</li> <li><a href="#comment-701" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Ok so, when I do traceroute -i wlan0 and tracertoute -i wlan1 I do see traffic going out from the appropriate routes </p>
<p>So rule 32764 forwards any traffic FROM the internet (meaning coming 
in from other interfaces?) TO the secondary interface gateway? Because 
rule 32765 reads “from 192.168.1.0/24 lookup 2” so I am assuming it is 
taking care of traffic coming in the secondary interface making sure 
that it goes out from 192.168.1.1 right?</p>
<p>And if so, Vuse is working fine without rule 32764, because all 
traffic is generated directly from the secondary interface and also 
arriving into the interface? Is that why so far everything seems to be 
working just with rule 32765 ?</p>
<p>THAT’s what confuses me!</p>
<p>thank you,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-702" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-702">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 6, 2012 at 7:43 pm</li> <li><a href="#comment-702" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>&gt;So rule 32764 forwards any traffic FROM the internet (meaning
 coming in from other interfaces?) TO the secondary interface gateway? </p>
<p>Correct. </p>
<p>&gt; Because rule 32765 reads “from 192.168.1.0/24 lookup 2” so I am 
assuming it is taking care of traffic coming in the secondary interface 
making sure that it goes out from 192.168.1.1 right? </p>
<p>Correct. </p>
<p>&gt; And if so, Vuse is working fine without rule 32764, because all 
traffic is generated directly from the secondary interface and also 
arriving into the interface? Is that why so far everything seems to be 
working just with rule 32765 ? </p>
<p>Pretty much, yes. </p>
<p>&gt; THAT’s what confuses me! </p>
<p>Yup, policy routing is not straight forward, at all. </p>
<p>Regards, Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-703" class="comment even depth-5 highlander-comment">
	<div id="div-comment-703">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://twitter.com/sxty1" rel="external nofollow" class="url">I, Geek (@sxty1)</a></span></li>
		<li>Posted November 6, 2012 at 10:14 pm</li> <li><a href="#comment-703" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>The conversation reached the max limit depth so I’ll reply here..<br>
Thanks again for the last clarification, I got it now!<br>
Oh and please continue blogging good stuff!</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-710" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-710">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://twitter.com/sxty1" rel="external nofollow" class="url">I, Geek (@sxty1)</a></span></li>
		<li>Posted November 13, 2012 at 11:03 pm</li> <li><a href="#comment-710" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=710#respond" onclick='return addComment.moveForm( "div-comment-710", "710", "respond", "4" )' aria-label="Reply to I, Geek (@sxty1)">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi again Darien,<br>
sorry to bother you again, I was just going through the comments section
 in this page checking to see how others might be using policy routing 
for any smart scenarios.<br>
In the last comment made by user “anestis” where he used the -I 
parameter to bind to ping to an interface, I tried it too. I’m having 
the same issue as well. Binding ping works only if I bind it to the IP 
of the secondary interface (i.e. -I 192.168.1.12). If I bind it directly
 to the interface (i.e. -I wlan1) it’s giving me destination host 
unreachable. With the primary interface, it works both ways (either with
 -I ip or -I wlan0). Maybe -I is not a reliable way to test?</p>
<p>Thanks again,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-711" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-711">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 13, 2012 at 11:07 pm</li> <li><a href="#comment-711" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=711#respond" onclick='return addComment.moveForm( "div-comment-711", "711", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Yeah, I think you’re right.  It seems that option is not a reliable way to test policy routing. </p>
<p>Regards, Darien </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-713" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-713">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://twitter.com/sxty1" rel="external nofollow" class="url">I, Geek (@sxty1)</a></span></li>
		<li>Posted November 14, 2012 at 2:12 am</li> <li><a href="#comment-713" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>When I get the change I’ll test it with centos or RHEL too. Maybe
 it’s a debian based distro issue. Thanks again for the reply back.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-704" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-704">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">anestis</span></li>
		<li>Posted November 8, 2012 at 3:16 am</li> <li><a href="#comment-704" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=704#respond" onclick='return addComment.moveForm( "div-comment-704", "704", "respond", "4" )' aria-label="Reply to anestis">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Daren, awesome post!! Googling paid off indeed!<br>
Let me ask you a question though,<br>
I’m having an issue and I don’t  know if it’s my configuration</p>
<p># traceroute -i eth0 8.8.8.8 (goes out eth0 gw)<br>
# traceroute -i eth1 8.8.8.8 (goes out eth1 gw)<br>
# ping -I eth0 8.8.8.8 (works ok)<br>
# ping -I eth1 8.8.8.8 Destination Host Unreachable)<br>
# ping -I 192.168.2.2 (eth1 ip) (works ok)</p>
<p>So for some reason if I use the direct ip of eth1 ping works but if I use the interface, I get Destination Host Unreachable.<br>
Any ideas as to what might be the problem here?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-705" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-705">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">anestis</span></li>
		<li>Posted November 8, 2012 at 3:18 am</li> <li><a href="#comment-705" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=705#respond" onclick='return addComment.moveForm( "div-comment-705", "705", "respond", "4" )' aria-label="Reply to anestis">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>last line I meant # ping -I 192.168.2.2 8.8.8.8<br>
oh and sorry for butchering your name… I meant Darien<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-706" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-706">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 8, 2012 at 8:56 am</li> <li><a href="#comment-706" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=706#respond" onclick='return addComment.moveForm( "div-comment-706", "706", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Please provide full network and routing information for each 
interface, as I don’t have enough information in order to identify the 
core problem. </p>
<p>Regards, Darien </p>
<p>On Nov 8, 2012, at 3:16 AM, “Darien Kindlund’s Blog”</p>
	</div>
	</div>
<ul class="children">
<li id="comment-707" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-707">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">anestis</span></li>
		<li>Posted November 9, 2012 at 12:19 am</li> <li><a href="#comment-707" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=707#respond" onclick='return addComment.moveForm( "div-comment-707", "707", "respond", "4" )' aria-label="Reply to anestis">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Oh I’m sorry I should have added some more details.<br>
So here’s my setup:</p>
<p>eth0: 192.168.1.2 gw0:192.168.1.1<br>
eth1: 192.168.2.2 gw1:192.168.2.1</p>
<p>/etc/iproute2/rt_tables<br>
#added:<br>
1 table1<br>
2 table2</p>
<p>##route1<br>
ip route add default via 192.168.1.1 dev eth0 table table1<br>
ip rule add from 192.168.1.0/24 table1</p>
<p>##route2<br>
ip route add default via 192.168.2.1 dev eth1 table table2<br>
ip rule add from 192.168.2.0/24 table2</p>
<p>so, that’s what I did pretty much and then tried to test with traceroute -i and ping -I<br>
Traceroute seems to work in both instances (going out from the correct gateways).<br>
Ping worked for my default interface (eth0), however for eth1 it only works if I put the actual IP but not with the eth1<br>
ie.<br>
ping -I 192.168.2.2 8.8.8.8 (works)<br>
ping -I eth1 8.8.8.8 destination host unreachable</p>
<p>Isn’t that weird? Do you thing I misconfigured something? Let me know if you need any more details.</p>
<p>Thank you,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-708" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-708">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 9, 2012 at 8:58 am</li> <li><a href="#comment-708" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=708#respond" onclick='return addComment.moveForm( "div-comment-708", "708", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>After issuing the “ip rule” commands, did you issue “ip route 
flush cache” at the end, so that your commands will take immediate 
effect? </p>
<p>Regards, Darien </p>
<p>On Nov 9, 2012, at 12:19 AM, “Darien Kindlund’s Blog”</p>
	</div>
	</div>
<ul class="children">
<li id="comment-709" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-709">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">anestis</span></li>
		<li>Posted November 11, 2012 at 8:38 pm</li> <li><a href="#comment-709" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Sorry for the long delay but I had to wait to get access to that system.<br>
So, I did the simple setup from scratch with the two routes and I tried 
flushing the cache like you suggested but same thing. Any thoughts?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-712" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-712">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 13, 2012 at 11:08 pm</li> <li><a href="#comment-712" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>It looks like using the -I option with ping is not a reliable way
 to test policy routing; see sxty1’s earlier comment for details. </p>
<p>Regards, Darien </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-714" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-714">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted November 19, 2012 at 4:22 am</li> <li><a href="#comment-714" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=714#respond" onclick='return addComment.moveForm( "div-comment-714", "714", "respond", "4" )' aria-label="Reply to Shawn">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>For the 2 local networks 192.168.7.0 and 10.10.70.0 in your 
example, you defined 2 default gateways for them nice enough to access 
the Internet in 2 distinct paths.   That is very good but I need more 
than that.  I also desire the 2 local networks be able to ping each 
other meanwhile.  What’s the trick?  Please teach me.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-715" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-715">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 19, 2012 at 8:48 am</li> <li><a href="#comment-715" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=715#respond" onclick='return addComment.moveForm( "div-comment-715", "715", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I assume you want _all_ the systems on both networks to be able 
to ping each other — not just the two interfaces on your Linux system.  
In that case, you need to look at standard routing guides, which clearly
 explain this.  You don’t need policy routing, specifically. </p>
<p>Here are some useful references on general routing for Linux: <a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=3&amp;ved=0CCAQFjAC&amp;url=http%3A%2F%2Flinux-ip.net%2Fhtml%2Frouting-intro.html&amp;ei=UziqUOTPFqnB0QGm7YG4DQ&amp;usg=AFQjCNG8qeJPOA12XiW69xbSt0WKg7uArQ" rel="nofollow">http://www.google.com/url?sa=t&amp;source=web&amp;cd=3&amp;ved=0CCAQFjAC&amp;url=http%3A%2F%2Flinux-ip.net%2Fhtml%2Frouting-intro.html&amp;ei=UziqUOTPFqnB0QGm7YG4DQ&amp;usg=AFQjCNG8qeJPOA12XiW69xbSt0WKg7uArQ</a> </p>
<p><a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=2&amp;ved=0CBUQFjAB&amp;url=http%3A%2F%2Flartc.org%2Fhowto%2F&amp;ei=UziqUOTPFqnB0QGm7YG4DQ&amp;usg=AFQjCNGcAW7fcd573mwGwbp6fk3ZjXZ5kg" rel="nofollow">http://www.google.com/url?sa=t&amp;source=web&amp;cd=2&amp;ved=0CBUQFjAB&amp;url=http%3A%2F%2Flartc.org%2Fhowto%2F&amp;ei=UziqUOTPFqnB0QGm7YG4DQ&amp;usg=AFQjCNGcAW7fcd573mwGwbp6fk3ZjXZ5kg</a> </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-716" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-716">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted November 23, 2012 at 2:19 am</li> <li><a href="#comment-716" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=716#respond" onclick='return addComment.moveForm( "div-comment-716", "716", "respond", "4" )' aria-label="Reply to Shawn">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Actually I have setup a Ubuntu linux gateway with 2 interfaces.  For instance</p>
<p>auto eth1<br>
iface eth1 inet static<br>
        address 192.168.1.20<br>
        netmask 255.255.255.0<br>
        network 192.168.1.0<br>
        broadcast 192.168.1.255</p>
<p>auto eth2<br>
iface eth2 inet static<br>
        address 10.10.10.20<br>
        netmask 255.255.255.0<br>
        network 10.10.10.0<br>
        broadcast 10.10.10.255</p>
<p>I have enabled the IP forwarding such that PC in 192.168.1.0/24 and 
PC in 10.10.10.0/24 could ping each other though this machine as their 
default gateway.</p>
<p>TWO other routers, A and B, have independing Internet connections 
respectively.  Each one has an LAN interface directly connected to the 2
 LANs.  The LAN port IP of router A is 192.168.1.19.  The LAN port IP 
for router B is 10.10.10.19.  I desire each network go through a 
specified router for Internet access.  For instance; PC in 
192.168.1.0/24 go through router A.  PC in 10.10.10.0/24 go through 
router B.  To do this, I have added 2 tables to the file: 
/etc/iproute2/rt_tables<br>
     100 pma<br>
     200 ma</p>
<p>Then I issued the following commands:</p>
<p>ip rule add from 192.168.1.0/24 table pma<br>
ip rule add from 10.10.10.0/24 table ma<br>
ip route add default via 192.168.1.19 table pma<br>
ip route add default via 10.10.10.19 table ma<br>
ip route flush cache</p>
<p>Now that the 2 networks could have the Internet access independently.
  But they cannot ping each other anymore.  If I reboot this gateway 
without issuing the previous 5 commands.  PC from both networks could 
each other again.  And none of the PC could get Internet access anymore.
  Of course I could add a gateway statement to the network configuration
 file, for instance, the last line of the following stance.<br>
   auto eth1<br>
   iface eth1 inet static<br>
        address 192.168.1.20<br>
        netmask 255.255.255.0<br>
        network 192.168.1.0<br>
        broadcast 192.168.1.255<br>
        gateway 192.168.1.19</p>
<p>But that is not I want since it would become a default gateway to all
 connected networks.  I want each connected network go through different
 path for Internet access, namely router A and router B.  In fact, I 
wish I could dynamically assigned some selected PC from 10.10.10.0/24 go
 through route A in additional to the whole 192.168.1.0/24 network.</p>
<p>This is what I mean I want “more” than that.  Sorry for my fault of 
ambiguous illustration previously.  Again I appreciate your document.  
And I am expecting further teaching from you.  Thank you in advance.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-717" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-717">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 23, 2012 at 9:21 am</li> <li><a href="#comment-717" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=717#respond" onclick='return addComment.moveForm( "div-comment-717", "717", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, </p>
<p>I see what you mean.  I appreciate your detailed description, as that
 really helps me better understand what the possible issues are.  First,
 I agree with you that you do _not_ want to include the gateway 
directive in your individual network configuration files. </p>
<p>Basically, you want: 1) policy routing from this “router” system out 
to the internet, so that each upstream link is used independently -AND- 
2) proper routing between other systems on networks A and B through this
 router, so that they don’t have to go out to the internet to reach each
 other </p>
<p>Assuming your initial IP configuration for eth1 and eth2, as well as 
the default gateways defined for each interface, you indicated your 
tables are setup as such: </p>
<p>/etc/iproute2/rt_tables      100 pma      200 ma </p>
<p>Issue the following commands: </p>
<p>ip rule add from 192.168.1.0/24 table pma ip rule add to 192.168.1.0/24 table pma </p>
<p>ip rule add from 10.10.10.0/24 table ma ip rule add to 10.10.10.0/24 table ma </p>
<p>ip route add 192.168.1.0/24 dev eth0 src 192.168.1.20 table pma ip route add default via 192.168.1.19 dev eth0 table pma </p>
<p>ip route add 10.10.10.0/24 dev eth1 src 10.10.10.20 table ma ip route add default via 10.10.10.19 dev eth1 table ma </p>
<p>ip route flush cache </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-720" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-720">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted November 26, 2012 at 10:47 pm</li> <li><a href="#comment-720" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Thanks for your teaching Darien.  For the following suggested statements:<br>
    ip rule add from 192.168.1.0/24 table pma ip rule add to 192.168.1.0/24 table pma<br>
    ip rule add from 10.10.10.0/24 table ma ip rule add to 10.10.10.0/24 table ma<br>
Could you explain the functions?  Again I would like PC in these 2 
networks 192.168.1.0/24 and 10.10.10.0/24 could ping each other through 
this Linux gateway.  How the 2 statements could fullfill this 
requirement?  </p>
<p>Suppose I would like some selected nodes (e.g. 10.10.10.100 is the PC
 of the General Manager and requires a preference connection to the 
Internet) to reach Internet by going through eth0 with table pma instead
 of the deault path of the subnet the node belongs to.  What statement 
shoud be added?  I understand that there is a PRIORITY paramenter 
setting for ip rule statements.  How could I make use of it?</p>
<p>How to use statement: “ip route add” and “ip route append”  What’s 
the difference?  Could you provide some examples to illustrate the 
difference?</p>
<p>That’s a lot of questions but I’ve found your teaching the most 
comprehensive to me and will help in a more effiective way to complete 
my study on policy routing.  Thank you very much Darien.  Good teaching.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-721" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-721">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 26, 2012 at 10:55 pm</li> <li><a href="#comment-721" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hi Shawn, </p>
<p>Sorry about the confusion.  It looks like wordpress combined multiple
 lines into a single statement.  Here was my original recommendation, 
but this time, I’ve added multiple lines between each command, so that 
it’s clearer to see when one command ends and another begins: </p>
<p>Assuming your initial IP configuration for eth1 and eth2, as well as 
the default gateways defined for each interface, you indicated your 
tables are setup as such: </p>
<p>/etc/iproute2/rt_tables </p>
<p>100 pma </p>
<p>200 ma </p>
<p>Issue the following commands: </p>
<p>ip rule add from 192.168.1.0/24 table pma </p>
<p>ip rule add to 192.168.1.0/24 table pma </p>
<p>ip rule add from 10.10.10.0/24 table ma </p>
<p>ip rule add to 10.10.10.0/24 table ma </p>
<p>ip route add 192.168.1.0/24 dev eth0 src 192.168.1.20 table pma </p>
<p>ip route add default via 192.168.1.19 dev eth0 table pma </p>
<p>ip route add 10.10.10.0/24 dev eth1 src 10.10.10.20 table ma </p>
<p>ip route add default via 10.10.10.19 dev eth1 table ma </p>
<p>ip route flush cache </p>
<p>Hopefully, the extra spaces will help.  I will reply to your other questions separately. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-722" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-722">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 26, 2012 at 11:04 pm</li> <li><a href="#comment-722" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>&gt; Could you explain the functions? </p>
<p>“ip rule add from …” and “ip rule add to …” directives indicate when 
Linux should use the corresponding routing table (e.g., “pma” or “ma”) 
when processing incoming packets.  Only packets matching these “rules” 
will get processed by the corresponding table. </p>
<p>“ip route add …” directives indicate _what_ Linux should do with the 
packets that matched on the corresponding “ip rule …” directives for a 
given routing table. </p>
<p>&gt; Again I would like PC in these 2 networks 192.168.1.0/24 and 
10.10.10.0/24 could ping each other through this Linux gateway.  How the
 2 statements could fullfill this requirement? </p>
<p>The “ip rule …” and “ip route …” statements help the Linux gateway 
route packets through the right interfaces.  I think your confusion was 
due to the fact that wordpress combined the “ip rule” and “ip route” 
statements onto a single line, which is incorrect.  Let me know of this 
is still unclear. </p>
<p>&gt; How to use statement: “ip route add” and “ip route append”  What’s the difference? </p>
<p>Use “ip route add” when you want to add a new routing entry to the TOP of the corresponding routing table. </p>
<p>Use “ip route append” when you want to add a new routing entry to the BOTTOM of the corresponding routing table. </p>
<p>I believe, Linux processes entries in a routing table from TOP to BOTTOM; first match wins. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-723" class="comment even depth-5 highlander-comment">
	<div id="div-comment-723">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted November 27, 2012 at 1:34 am</li> <li><a href="#comment-723" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>How about this: Suppose I would like some selected nodes (e.g. 
10.10.10.100 is the PC of the General Manager and requires a preference 
connection to the Internet) to reach Internet by going through eth0 with
 table pma instead of the deault path of the subnet the node belongs to.
 What statement shoud be added? I understand that there is a PRIORITY 
paramenter setting for ip rule statements. How could I make use of it?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-727" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-727">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 11, 2012 at 9:37 pm</li> <li><a href="#comment-727" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Defining route priorities is documented here: <a href="http://linux.die.net/man/8/ip" rel="nofollow">http://linux.die.net/man/8/ip</a> </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-726" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-726">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">John</span></li>
		<li>Posted December 11, 2012 at 1:50 pm</li> <li><a href="#comment-726" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=726#respond" onclick='return addComment.moveForm( "div-comment-726", "726", "respond", "4" )' aria-label="Reply to John">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This is the closest thing to an answer I have! Thank you<br>
I have a question. What if i Don’t always know the network IP of the second interface?<br>
EG<br>
192.168.0.10 Eth0 Gateway 192.168.0.1 This will always be like this.<br>
but then i have a VPN connection where the network IP might change, but i ALWAYS know it will be on link PPP0<br>
Is there a way to route based soley on the interface or link ?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-728" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-728">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 12, 2012 at 12:37 am</li> <li><a href="#comment-728" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=728#respond" onclick='return addComment.moveForm( "div-comment-728", "728", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>You would have to setup some sort of script to run the policy 
route commands _after_ the VPN is established.  The details of this 
depend on which VPN software you’re using and also which Linux 
distribution you’re running. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-730" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-730">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted December 16, 2012 at 2:50 pm</li> <li><a href="#comment-730" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=730#respond" onclick='return addComment.moveForm( "div-comment-730", "730", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>2 snaps up for this thread</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-732" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-732">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Panoch St.</span></li>
		<li>Posted December 22, 2012 at 10:12 am</li> <li><a href="#comment-732" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=732#respond" onclick='return addComment.moveForm( "div-comment-732", "732", "respond", "4" )' aria-label="Reply to Panoch St.">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hello, Darien</p>
<p>     I’m working on a selective VPN routing on tomato router which is really useful here in China.<br>
Using routing table, getting custom list of host and net to route 
through VPN is working perfectly with one big problem, I will have to 
manually add every single IPs for all the site that I found is block to 
the script and it is very time consuming. I am in the searching for some
 kind of script or technique to make this process somewhat automated.<br>
(I am not routing all connections through VPN since that it would make everything slow.)</p>
<p>&gt;&gt;Here is the part of the script I’m using<br>
VPNGW=$(nvram get pptp_client_gateway)<br>
##### begin batch route #####<br>
# DNS<br>
route add -host 8.8.8.8 gw $VPNGW<br>
route add -host 8.8.4.4 gw $VPNGW<br>
route add -host 209.244.0.3 gw $VPNGW<br>
route add -host 74.207.242.213 gw $VPNGW<br>
# <span class="skimlinks-unlinked">twitter.com</span><br>
route add -net 37.61.54.0/24 gw $VPNGW<br>
route add -net 120.88.53.0/24 gw $VPNGW<br>
route add -net 184.169.84.0/24 gw $VPNGW<br>
route add -net 199.16.156.0/22 gw $VPNGW<br>
route add -net 199.59.148.0/22 gw $VPNGW<br>
route add -net 168.143.161.0/24 gw $VPNGW<br>
# fbcdn<br>
route add -net 125.252.224.0/24 gw $VPNGW<br>
route add -net 60.254.185.0/24 gw $VPNGW<br>
route add -net 96.17.69.0/24 gw $VPNGW<br>
route add -net 60.254.175.0/24 gw $VPNGW<br>
…</p>
<p>&gt;&gt;This is part of my #ip route show<br>
50.112.0.0/16 via 10.9.0.1 dev ppp40<br>
174.129.0.0/16 via 10.9.0.1 dev ppp40<br>
54.242.0.0/15 via 10.9.0.1 dev ppp40<br>
23.22.0.0/15 via 10.9.0.1 dev ppp40<br>
15.240.0.0/15 via 10.9.0.1 dev ppp40<br>
54.234.0.0/15 via 10.9.0.1 dev ppp40<br>
54.236.0.0/15 via 10.9.0.1 dev ppp40<br>
50.16.0.0/14 via 10.9.0.1 dev ppp40<br>
10.9.0.1 dev ppp40  proto kernel  scope link  src 10.9.28.24<br>
<span class="skimlinks-unlinked">XXX.XXX.XXX.XXX</span> via 192.168.1.1 dev vlan3  #XXX is my vpn server<br>
10.0.0.0/24 dev br0  proto kernel  scope link  src 10.0.0.1<br>
192.168.1.0/24 dev vlan3  proto kernel  scope link  src 192.168.1.198<br>
127.0.0.0/8 dev lo  scope link<br>
default via 192.168.1.1 dev vlan3</p>
<p>I have spent about half a month on this already, trying to find some way to automate this.<br>
Please give some advice or help if you have time,<br>
Noch</p>
	</div>
	</div>
<ul class="children">
<li id="comment-733" class="comment even depth-2 highlander-comment">
	<div id="div-comment-733">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Panoch St.</span></li>
		<li>Posted December 22, 2012 at 10:37 am</li> <li><a href="#comment-733" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=733#respond" onclick='return addComment.moveForm( "div-comment-733", "733", "respond", "4" )' aria-label="Reply to Panoch St.">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I’m thinking about something close to Automatic Failover, if 
default route is not responsive then if a request is repeated more than 2
 times, try the next alternate gateway in order. (not switching 
completely from default gateway, but only use alternate gateway with 
some hosts that is blocked on default route)</p>
<p>## Sorry for my English language, I am Thai<img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
	</div>
	</div>
<ul class="children">
<li id="comment-734" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-3 highlander-comment">
	<div id="div-comment-734">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 22, 2012 at 3:01 pm</li> <li><a href="#comment-734" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=734#respond" onclick='return addComment.moveForm( "div-comment-734", "734", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Noch, </p>
<p>What you’re looking for is called “Failover Default Routing”.  This article describes the concept in more detail: <a href="http://www.linuxquestions.org/questions/linux-networking-3/gateway-router-failover-798109/" rel="nofollow">http://www.linuxquestions.org/questions/linux-networking-3/gateway-router-failover-798109/</a> </p>
<p>It looks like there is a “metric” parameter, that may work for you, in that example. </p>
<p>Also, you can check out this resource, as well: <a href="http://lartc.org/howto/lartc.rpdb.multiple-links.html#AEN298" rel="nofollow">http://lartc.org/howto/lartc.rpdb.multiple-links.html#AEN298</a> </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-738" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-738">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://linkedin.com/in/AlanCarwile" rel="external nofollow" class="url">Alan Carwile</a></span></li>
		<li>Posted January 23, 2013 at 3:28 pm</li> <li><a href="#comment-738" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=738#respond" onclick='return addComment.moveForm( "div-comment-738", "738", "respond", "4" )' aria-label="Reply to Alan Carwile">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you.  I’m curious about a mix of IPv4 and IPv6.  With an 
IPv4 address on eth0 and an IPv6 address on eth0, plus an IPv4 address 
on eth1, what should one setup?  Our eth1 interface is generally to a 
private network, but eth0 goes to both IPv4 and IPv6 default gateways.  
Thanks! Alan</p>
	</div>
	</div>
<ul class="children">
<li id="comment-739" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-739">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted January 23, 2013 at 4:23 pm</li> <li><a href="#comment-739" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=739#respond" onclick='return addComment.moveForm( "div-comment-739", "739", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Alan, </p>
<p>To be honest, I’m not sure, as I haven’t used Linux policy routing 
with IPv6 interfaces.  It looks like Linux does support policy routing 
over IPv6: <a href="http://www.policyrouting.org/PolicyRoutingBook/ONLINE/CH09.web.html" rel="nofollow">http://www.policyrouting.org/PolicyRoutingBook/ONLINE/CH09.web.html</a> <a href="http://note-to-self.baker.com/2013/01/03/routing-traffic-control-linux-ipv6-and-iproute2/" rel="nofollow">http://note-to-self.baker.com/2013/01/03/routing-traffic-control-linux-ipv6-and-iproute2/</a> </p>
<p>That said, it looks like there’s a couple of issues with this: <a href="http://itkia.com/ipv6-policy-routing-linux-gotchas/" rel="nofollow">http://itkia.com/ipv6-policy-routing-linux-gotchas/</a> <a href="http://lists.ucc.gu.uwa.edu.au/pipermail/ucc/2010-November/016028.html" rel="nofollow">http://lists.ucc.gu.uwa.edu.au/pipermail/ucc/2010-November/016028.html</a> <a href="http://serverfault.com/questions/203387/ipv6-policy-routing-on-linux" rel="nofollow">http://serverfault.com/questions/203387/ipv6-policy-routing-on-linux</a> </p>
<p>Hope that helps. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-743" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-743">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dev</span></li>
		<li>Posted February 9, 2013 at 10:18 am</li> <li><a href="#comment-743" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=743#respond" onclick='return addComment.moveForm( "div-comment-743", "743", "respond", "4" )' aria-label="Reply to dev">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This is a great tutorial! But how do I get it to work for 8 NIC’s?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-744" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-744">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 9, 2013 at 10:37 am</li> <li><a href="#comment-744" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=744#respond" onclick='return addComment.moveForm( "div-comment-744", "744", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Simply define unique routes for each interface.  As long as there is no overlap, you should be all set. </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-745" class="comment even depth-3 highlander-comment">
	<div id="div-comment-745">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dev</span></li>
		<li>Posted February 9, 2013 at 11:16 am</li> <li><a href="#comment-745" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=745#respond" onclick='return addComment.moveForm( "div-comment-745", "745", "respond", "4" )' aria-label="Reply to dev">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the amazingly fast reply! I’ve got another quick 
question, I’ve noticed that you use static IP’s a lot, is there any way 
to get this working with DHCP?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-746" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-746">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 9, 2013 at 11:24 am</li> <li><a href="#comment-746" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=746#respond" onclick='return addComment.moveForm( "div-comment-746", "746", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>It’s possible, but you would have to customize your DHCP scripts to issue the appropriate policy routes once successful. </p>
<p>Also, you would have to make sure your DHCP servers issue leases on non-overlapping subnets. </p>
<p>Lastly, your DHCP servers need to be on separate, logical networks, 
so that way they don’t see overlapping requests from clients. </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-747" class="comment even depth-5 highlander-comment">
	<div id="div-comment-747">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dev</span></li>
		<li>Posted February 9, 2013 at 7:09 pm</li> <li><a href="#comment-747" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>I’m sorry if my question seems silly (I’m a novice) but would this work if both interfaces were on the same gateway?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-749" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-749">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 11, 2013 at 9:19 am</li> <li><a href="#comment-749" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>As long as the DHCP server assigns a fixed IP address for each interface, then yes. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-748" class="comment even depth-5 highlander-comment">
	<div id="div-comment-748">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">dev</span></li>
		<li>Posted February 9, 2013 at 10:02 pm</li> <li><a href="#comment-748" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hello Darien,</p>
<p>Well, I’ve tried your setup and it works great when I want to send 
data from the client to the server. However, the server (with 8 NIC’s) 
can’t seem to ping the client…would you happen to know whats wrong?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-750" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-5 highlander-comment">
	<div id="div-comment-750">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 11, 2013 at 10:36 am</li> <li><a href="#comment-750" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>I would need a lot more information about your setup, in order to troubleshoot. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-751" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-751">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted February 12, 2013 at 5:38 pm</li> <li><a href="#comment-751" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=751#respond" onclick='return addComment.moveForm( "div-comment-751", "751", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>After struggling most of the day, this post came to the rescue.  I use Ubuntu 12.04 LTS. Thanks Darien!!!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-752" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-752">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.facebook.com/michael.ambrus" rel="external nofollow" class="url">Michael Ambrus</a></span></li>
		<li>Posted February 18, 2013 at 7:42 pm</li> <li><a href="#comment-752" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=752#respond" onclick='return addComment.moveForm( "div-comment-752", "752", "respond", "4" )' aria-label="Reply to Michael Ambrus">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>5 years later and people still sending thanking you notes. And the list is soo long…!</p>
<p>Here’s yet one more: THANK YOU! It saved my day  – or rather night.</p>
<p>I have s set-up with a couple of multi-homed hosts belonging to two 
networks. Each network is connected to the Internet via a separate NAT 
router. For various reasons I want outbound traffic using one of the 
routers, but inbound (port forwarded ssh) traffic from the other. After 
much grief I realised that for inbound traffic to work, it has to go 
back to the same router as it came from (i.e. exactly the case described
 here). Not sure why, as I always thought both source and destination 
were translated: in which case the inside sshd should believe stream 
originate from the router and send responses back to it, but obviously 
this is not so. This really is not my area and a few lines of 
enlightenment would be appreciated (your band-width permitting of 
course).</p>
	</div>
	</div>
<ul class="children">
<li id="comment-753" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-753">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 19, 2013 at 10:56 pm</li> <li><a href="#comment-753" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=753#respond" onclick='return addComment.moveForm( "div-comment-753", "753", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Yeah, sshd doesn’t perform any packet routing by itself — that’s 
the kernel’s job.  Therefore, all packets going in and out of your 
system are handled through the standard routing tables, which is why you
 saw this type of activity.  The persistence you’re describing is 
typical of any sort of “stateful packet inspection” (SPI) feature on a 
firewall or NAT device.  Specifically, once an initial TCP connection is
 established and SPI is enabled, the firewall/NAT will maintain a record
 of the mapping and route all packets pertaining to that flow through to
 the mapped destination, by default.  It’s the same reason why you may 
need to send initial packets out from the trusted side through a 
firewall to the untrusted side — in order to receive equivalent packets 
back through the firewall (from untrusted to trusted side). </p>
<p>Regarding your “stateful route” issue with sshd… yeah, even though 
you think it would make sense to route outbound SSH packets through a 
completely different NAT’d route out, the problem with that approach, is
 that the two NAT devices have _no_ complete view of the TCP flow state,
 which can cause problems when managing the full TCP flow.  In order for
 NAT to work correctly, a single NAT device needs to see both sides of 
the flow; otherwise, you will run into the issues you’ve described.  The
 other aspect to this, is that if you tried to configure asymmetric 
routing through multiple NAT devices for a single ssh session, the 
original SSH client would have no idea why they’re receiving TCP packets
 from a completely different IP address than the original IP address 
that the client sent TCP packets to. </p>
<p>In order to discover these issues, it’s best recommended to run 
tcpdump or wireshark on both the server and client sides, in order to 
witness this asymmetric route issue while you try running TCP connection
 tests — the problem will become much clearer when you have this type of
 visual as a reference point. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-754" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-754">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shahid</span></li>
		<li>Posted February 20, 2013 at 9:16 am</li> <li><a href="#comment-754" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=754#respond" onclick='return addComment.moveForm( "div-comment-754", "754", "respond", "4" )' aria-label="Reply to Shahid">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Dear Sir,</p>
<p>I need the information regarding multiple interface card.</p>
<p>My Scenario is :</p>
<p>Eth0: 172.X.X.106 / 255.255.255.252 GW 172.X.X.105<br>
Eth1: 192.168.1.222 / 255.255.255.0 GW 192.168.1.1</p>
<p>My Requirement is that:</p>
<p>1) Eth0 traffic out/in gateway 172.X.X.105<br>
2) Eth1 traffic in/out gateway 192.168.1.1</p>
<p>Mean that traffic generate from eth0 forward to its own gate way, same as eth1.</p>
<p>I am using the elastix server (centos 5.7) with two sip account, one on eth0 and other eth1. Port number 5060.</p>
<p>I am confused how to do this.</p>
<p>Waiting for your quick response.</p>
<p>I try , which is mention on above, no success.</p>
<p>Regards</p>
<p>Shahid Iqbal</p>
	</div>
	</div>
<ul class="children">
<li id="comment-755" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-755">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted February 20, 2013 at 10:23 am</li> <li><a href="#comment-755" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=755#respond" onclick='return addComment.moveForm( "div-comment-755", "755", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Shahid, </p>
<p>So, let’s assume this is your network: </p>
<p>eth0 – 172.16.0.106 netmask 255.255.255.252 (/30) eth0’s gateway is: 172.16.0.105 </p>
<p>eth1 – 192.168.1.222 netmask 255.255.255.0 (/24) eth1’s gateway is: 192.168.1.1 </p>
<p>Here are the corresponding commands: </p>
<p>printf �1\tuplink0\n� &gt;&gt; /etc/iproute2/rt_tables printf �2\tuplink1\n� &gt;&gt; /etc/iproute2/rt_tables </p>
<p>ip route add 172.16.0.106/30 dev eth0 src 172.16.0.106 table uplink0 
ip route add default via 172.16.0.105 dev eth0 table uplink0 ip rule add
 from 172.16.0.106/30 table uplink0 ip rule add to 172.16.0.106/30 table
 uplink0 </p>
<p>ip route add 192.168.1.0/24 dev eth1 src 192.168.1.222 table uplink1 
ip route add default via 192.168.1.1 dev eth1 table uplink1 ip rule add 
from 192.168.1.0/24 table uplink1 ip rule add to 192.168.1.0/24 table 
uplink1 </p>
<p>ip route flush </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-756" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-756">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shahid</span></li>
		<li>Posted February 20, 2013 at 11:09 am</li> <li><a href="#comment-756" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=756#respond" onclick='return addComment.moveForm( "div-comment-756", "756", "respond", "4" )' aria-label="Reply to Shahid">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I am using elastix server, i put all above mention, which was sent to me, but nothing happen.<br>
Basically using 5060 port to forward traffic to sip ip. but sip registration is failed.(eth0)<br>
I dont know how to manage.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-769" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-769">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted March 8, 2013 at 10:27 am</li> <li><a href="#comment-769" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=769#respond" onclick='return addComment.moveForm( "div-comment-769", "769", "respond", "4" )' aria-label="Reply to Shawn">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I have a Linux box wtih 4 interfaces: eth0 and eth1 serve as 
default gateways of network A and network B respectively.  eth2 and eth3
 serve as gateways to the Internet through 2 different ADSL.  I want the
 incoming traffic from network A to go through eth2 to reach Internet, 
the incoming traffic of network B to go through eth3 to reach Internet. 
 Meanwhile network A and network B could communicate with each other 
through their default gateways, namely eth0 and eth1 respectively.  
Forwarding is enabled in this box.  I have added 2 entries to the 
rt_tables.  I know that I have to add some ip rules and ip routes 
statements.  But how could I manage to have 2 different default gateways
 to route Internet traffic for 2 different networks while enabling the 
inter-network communication between this 2 networks.  Please advise.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-770" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-770">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted March 8, 2013 at 10:45 am</li> <li><a href="#comment-770" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=770#respond" onclick='return addComment.moveForm( "div-comment-770", "770", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Please provide example network subnets for: 1) network A 2) network B 3) eth2 ADSL network 4) eth3 ADSL network </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-771" class="comment even depth-2 highlander-comment">
	<div id="div-comment-771">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted March 9, 2013 at 5:10 am</li> <li><a href="#comment-771" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=771#respond" onclick='return addComment.moveForm( "div-comment-771", "771", "respond", "4" )' aria-label="Reply to Shawn">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Configuration of the Linux Box…</p>
<p>eth0: 192.168.1.20<br>
eth1: 10.10.10.20<br>
eth2: 192.168.6.20 (reach Internet through 192.168.6.1)<br>
eth3: 192.168.0.20 (reach Internet through 192.168.0.1)<br>
LAN A: 192.168.1.0/24 Default Gateway: 192.168.1.20<br>
LAN B: 10.10.10.0/24 Default Gateway: 10.10.10.20</p>
<p>If you copy the following ASCII text and paste it to the Notepad, you could see a better picture.</p>
<p>                                                                     ________<br>
                                           +—————+        /<br>
                                           |    ISP 1      |       /<br>
                                  +——–+    (MA)       +——+<br>
+—————-+                |        | gw 192.168.0.1|     /<br>
| LAN A          |    +———–+–+     +—————+    /<br>
| 192.168.1.0/24 +—-+ eth0    eth3 |                         /<br>
+—————-+    |              |                         |<br>
                      |  Linux Box   |                         |<br>
+—————-+    |              |                         |  Internet cloud<br>
| LAN B          +—-+ eth1    eth2 |                         |<br>
| 10.10.10.0/24  |    +———–+–+     +—————+   |<br>
+—————-+                |        |    ISP 2      |   \<br>
                                  +——–+    (PMA)      +—-+<br>
                                           |gw 192.168.6.1 |     \<br>
                                           +—————+      \<br>
                                                                   \<br>
                                                                    \________</p>
<p>If I issue the following commands, it seems that traffic between LAN A
 and LAN B is not possible as they all go their own gateway as listed in
 the routing tables, ma and pma respectively.  The traffic could 
eventually go to the Internet.  I desire LAN A and LAN B could 
communicate with each other.  Meanwhile LAN A and LAN B could go to the 
Internet through the  assigned gateways.</p>
<p>ip rule add from 192.168.1.0/24 table ma<br>
ip rule add to 192.168.1.0/24 table ma<br>
ip rule add from 10.10.10.0/24 table pma<br>
ip rule add to 10.10.10.0/24 table pma</p>
<p>I understand that I may need to additionally issue the following comands:</p>
<p>ip route add 192.168.1.0/24 dev eth0  table ma<br>
ip route add default via 192.168.0.1 dev eth0 table ma<br>
ip route add 10.10.10.0/24 dev eth1 table pma<br>
ip route add default via 192.168.6.1 dev eth1 table pma</p>
<p>Still don’t work.  Is there a precedence order for “ip rule” and “ip route”?  If so, which one goes first?  Getting confused…</p>
<p>Appreciate you advise in advance.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-772" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-772">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Shawn</span></li>
		<li>Posted March 9, 2013 at 5:14 am</li> <li><a href="#comment-772" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=772#respond" onclick='return addComment.moveForm( "div-comment-772", "772", "respond", "4" )' aria-label="Reply to Shawn">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Oops!  It seems that WordPress doesn’t like the graphic in ASCII text.  Sorry.  I hope you understand anyway.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-778" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-778">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">0xor</span></li>
		<li>Posted April 8, 2013 at 7:10 pm</li> <li><a href="#comment-778" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=778#respond" onclick='return addComment.moveForm( "div-comment-778", "778", "respond", "4" )' aria-label="Reply to 0xor">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>Once again, great post! I always come back to this post about linux pbr<img scale="0" class="wp-smiley emoji" draggable="false" alt=":-)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"><br>
I have a question for you.. when I connect to a vpn my default route is 
overwritten and all my internet traffic goes through the vpn. So first 
question, is this normal behaviour? Why does the vpn client feels the 
need to route ALL traffic through the vpn and not just the traffic 
destined to the vpn’s subnet.<br>
Second question, what is the best way to prevent this behaviour and route only the vpn’s subnet traffic through the vpn?</p>
<p>Here’s what I did but had no success:</p>
<p>–before vpn:<br>
$ ip r<br>
default via 192.168.1.1 dev wlan0  proto static<br>
192.168.1.0/24 dev wlan0  proto kernel  scope link  src 192.168.1.3  metric 2</p>
<p>–after vpn:<br>
$ ip r<br>
default dev ppp0  proto static<br>
10.72.27.161 dev ppp0  proto kernel  scope link  src 10.72.27.166    &lt;—-(*)</p>
<p>so my obvious thought was to delete the default route for the ppp0 
and recreate the old defaut for the wlan0. This worked for the internet 
traffic however, traffic destined for the 10.72.27.0/24 (vpn subnet) is 
still routed via the default route (wlan0) EVEN though the line that I 
have pointed out with the (*) above STILL exists in the routing table. 
Shouldn't that line be routing traffic through the vpn even though the 
default route points to something else?</p>
<p>What am I missing? </p>
<p>thank you!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-784" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-784">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://www.chungsclimbing.com/27896" rel="external nofollow" class="url">Daniella</a></span></li>
		<li>Posted May 8, 2013 at 7:25 pm</li> <li><a href="#comment-784" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=784#respond" onclick='return addComment.moveForm( "div-comment-784", "784", "respond", "4" )' aria-label="Reply to Daniella">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hmm it seems like your website ate my first comment (it was 
extremely long) so I guess I’ll just sum it up what I wrote and say, I’m<br>
thoroughly enjoying your blog. I too am an aspiring blog writer but I’m 
still new to everything. Do you have any tips for rookie blog writers? 
I’d certainly appreciate it.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-785" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-785">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://noticias-crepusculo.blogspot.co.uk/2013/04/divertidas-cuotas-de-rob-en-entrevistas_10.html" rel="external nofollow" class="url">blogspot.co.uk</a></span></li>
		<li>Posted May 10, 2013 at 2:49 am</li> <li><a href="#comment-785" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=785#respond" onclick='return addComment.moveForm( "div-comment-785", "785", "respond", "4" )' aria-label="Reply to blogspot.co.uk">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>You are so cool! I don’t think I have read something like this 
before. So good to discover another person with some original thoughts 
on this subject matter. Seriously.. thank you for starting this up. This
 web site is one thing that is required on the internet, someone with a 
little originality!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-788" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-788">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Pedro</span></li>
		<li>Posted May 31, 2013 at 11:54 am</li> <li><a href="#comment-788" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=788#respond" onclick='return addComment.moveForm( "div-comment-788", "788", "respond", "4" )' aria-label="Reply to Pedro">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien. Your article is great but didn’t help in my problem.</p>
<p>I have 2 machines directly connected to each other (im doing this 
because i have to test one protocol in a controlled environment). Both 
machines (A and B) have two NICS [etho (A)  eth0 (B) and eth1(A)  
eth1(B)].<br>
A:<br>
     eth0 address: 10.1.1.1/24 gateway: 10.1.1.2<br>
     eth1 address: 10.1.2.1/24 gateway: 10.1.2.2<br>
B:<br>
    eth0 address: 10.1.1.2/24 gateway: 10.1.1.1<br>
    eth1 address: 10.1.2.2/24 gateway: 10.1.2.1</p>
<p>I have configured two routing tables (T1 and T2) like i saw here and 
in other websites. But the problem is that ping command shows “Host 
Unreachable” in both ways and command ARP -a shows the message 
“Incomplete”. </p>
<p>Here is my configs in machine A (in B are the same with, of course, corrects IPs):</p>
<p>IP Rule<br>
32762: from all to 10.1.2.1 lookup T2<br>
32763: from all to 10.1.1.1 lookup T1<br>
32764: from 10.1.2.1 lookup T2<br>
32765: from 10.1.1.1 lookup T1</p>
<p>IP route show table T1<br>
default via 10.1.1.2 dev eth0 src 10.1.1.1<br>
10.1.1.0/24 dev eth0 scope link src 10.1.1.1</p>
<p>IP route show table T2<br>
default via 10.1.2.2 dev eth1 src 10.1.2.1<br>
10.1.2.0/24 dev eth1 scope link src 10.1.2.1</p>
<p>I have been following this website <a href="http://lartc.org/howto/lartc.rpdb.multiple-links.html#AEN2970" rel="nofollow">http://lartc.org/howto/lartc.rpdb.multiple-links.html#AEN2970</a> and im doing something wrong. Can u help me in my problem?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-794" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-794">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Jon</span></li>
		<li>Posted August 22, 2013 at 11:12 am</li> <li><a href="#comment-794" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=794#respond" onclick='return addComment.moveForm( "div-comment-794", "794", "respond", "4" )' aria-label="Reply to Jon">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>This webpage finally explained how to make policy routing 
accessible.  Thank you so much.  In about 30 minutes I fixed all of my 
routing woes.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-799" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-799">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">zad</span></li>
		<li>Posted September 20, 2013 at 7:06 am</li> <li><a href="#comment-799" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=799#respond" onclick='return addComment.moveForm( "div-comment-799", "799", "respond", "4" )' aria-label="Reply to zad">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hello Darien.<br>
Thank you very much for this article very clear.<br>
Can you add to your article the corresponding configuration for / etc / network / interfaces file?</p>
<p>because I do not know what to put too.</p>
<p>Take care of yourself</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-800" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-800">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">lee</span></li>
		<li>Posted October 17, 2013 at 11:07 am</li> <li><a href="#comment-800" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=800#respond" onclick='return addComment.moveForm( "div-comment-800", "800", "respond", "4" )' aria-label="Reply to lee">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,<br>
I’ve unexpectedly found myself needing to create multiple default 
routes, I’m using haproxy with keepalived on two servers, so I have:</p>
<p>                 server1                 server2                  floating ip            required gateway<br>
eth0:        192.168.52.251    192.168.52.252     192.168.52.250<br>
eth1:        192.168.51.251    192.168.51.252     192.168.51.250<br>
eth2.11    192.168.100.3      192.168.100.4       192.168.100.5       192.168.100.250<br>
eth2.12    192.168.101.3      192.168.101.4       192.168.101.5       192.168.101.250<br>
eth2.13    192.168.102.3      192.168.102.4       192.168.102.5       192.168.102.250<br>
eth3.5      192.168.50.3        192.168.50.4         192.168.50.5         192.168.50.250</p>
<p>keepalived also includes the rest of the 192.168.100.0/24, 192.168.101.0/24 and 192.168.102.0/24 as virtual_ipadress_excluded.<br>
192.168.51.0/24 and 192.168.52.0/24 outbound traffic is SNAT’d to these virtual_ipaddress_excluded addresses<br>
(this is just test at the moment, the addresses on eth2.11, eth2.12, and eth2.13 will be changed to public ip’s for production)</p>
<p>your instructions show ip rule add being used with the physical ip 
addresses, what would I do in this case? do I create rules using the 
physical addresses, the virtual addresses, or do I need to create rules 
for both physical and virtual addresses?</p>
<p>thanks for any advice you can give.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-801" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-801">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">lee</span></li>
		<li>Posted October 17, 2013 at 11:15 am</li> <li><a href="#comment-801" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=801#respond" onclick='return addComment.moveForm( "div-comment-801", "801", "respond", "4" )' aria-label="Reply to lee">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>damn, formatting makes that hard to read,<br>
server1:<br>
eth0: 192.168.52.251<br>
eth1: 192.168.51.251<br>
eth2.11 192.168.100.3<br>
eth2.12 192.168.101.3<br>
eth2.13 192.168.102.3<br>
eth3.5 192.168.50.3 </p>
<p>server2:<br>
eth0: 192.168.52.252<br>
eth1: 192.168.51.252<br>
eth2.11: 192.168.100.4<br>
eth2.12: 192.168.101.4<br>
eth2.13: 192.168.102.4<br>
eth3.5: 192.168.50.4 </p>
<p>floating ips:<br>
192.168.52.250<br>
192.168.51.250<br>
192.168.100.5<br>
192.168.101.5<br>
192.168.102.5<br>
192.168.50.5</p>
<p>required gateways:<br>
192.168.100.250<br>
192.168.101.250<br>
192.168.102.250<br>
192.168.50.250</p>
<p>hopefully this makes it clearer.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-802" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-802">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted October 17, 2013 at 12:27 pm</li> <li><a href="#comment-802" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=802#respond" onclick='return addComment.moveForm( "div-comment-802", "802", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I believe you will need to treat each interface (physical and 
virtual) that has a unique IP as a separate interface for policy 
routing.  The commands should work on both interface types, I believe.  
You will have to likely experiment to see what works for you.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-813" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-813">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">lee</span></li>
		<li>Posted November 6, 2013 at 10:21 am</li> <li><a href="#comment-813" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=813#respond" onclick='return addComment.moveForm( "div-comment-813", "813", "respond", "4" )' aria-label="Reply to lee">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,</p>
<p>after a bit of experimentation, I’ve found I can get it done in just a few rules.<br>
192.168.50.0/24, 192.168.51.0/24, and 192.168.52.0/24 don’t require anything beyond their default settings<br>
192.168.100.0/24 has the default route.<br>
so it’s just rules for all the VIP’s on 192.168.101.0 and 192.168.102.0 </p>
<p>create two tables in /etc/iproute2/rt_tables :     101   table_101 and 102   table_102</p>
<p>ip route add default via 192.168.101.250 dev eth2.12 table table_101<br>
ip rule add from 192.168.101.0/24 table table_101<br>
ip route add default via 192.168.102.250 dev eth2.13 table table_102<br>
ip rule add from 192.168.102.0/24 table table_102</p>
<p>outbound from any of these addresses now use the correct interface. 
not created inbound rules yet, still working on that, but with what i 
have to test with, from haproxy  to firewall to adsl router, internet 
bound traffic is getting NATted 3 times, so currently working on inbound
 traffic problems upstream from this machine first.</p>
<p>hopefully this helps anyone else who finds themselves needing to create rules for large ranges of ip’s.<br>
I certainly wasn’t looking forward to the possibility of creating tables and rules for every individual ip.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-803" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-803">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://toddjames.io/" rel="external nofollow" class="url">Todd</a></span></li>
		<li>Posted October 22, 2013 at 7:56 pm</li> <li><a href="#comment-803" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=803#respond" onclick='return addComment.moveForm( "div-comment-803", "803", "respond", "4" )' aria-label="Reply to Todd">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hey Darien,</p>
<p>I just wanted to thank you for the post and for keeping up with 
replies to everyone asking questions, even after 5 years! This post was 
exactly what I needed. I used this with my Raspberry Pi to simulate 
hosts for a Cisco lab network (and linked back): <a href="http://toddjames.io/post/64816553890/using-a-raspberry-pi-to-simulate-hosts-on-a-network" rel="nofollow">http://toddjames.io/post/64816553890/using-a-raspberry-pi-to-simulate-hosts-on-a-network</a></p>
<p>Todd</p>
	</div>
	</div>
<ul class="children">
<li id="comment-804" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-804">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">0xor</span></li>
		<li>Posted October 22, 2013 at 9:46 pm</li> <li><a href="#comment-804" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=804#respond" onclick='return addComment.moveForm( "div-comment-804", "804", "respond", "4" )' aria-label="Reply to 0xor">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Nice little project but for what you need it to do gns3 or virtualbox would be much better and more convenient</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-805" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-805">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Jimmy</span></li>
		<li>Posted October 24, 2013 at 8:30 am</li> <li><a href="#comment-805" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=805#respond" onclick='return addComment.moveForm( "div-comment-805", "805", "respond", "4" )' aria-label="Reply to Jimmy">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks!  Found your blog while watching inbound http requests have responses sent out of the wrong interface.</p>
<p>You’re the man.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-806" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-806">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Manojav</span></li>
		<li>Posted October 30, 2013 at 11:16 am</li> <li><a href="#comment-806" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=806#respond" onclick='return addComment.moveForm( "div-comment-806", "806", "respond", "4" )' aria-label="Reply to Manojav">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Great article. I was wondering if you can help me with a peculiar problem I am having.</p>
<p>I have a Tomato Router with internet connection and public dynamic IP, x.x.x.x and 192.168.1.254 private interface.</p>
<p>x.x.x.x (Tomato) 192.168.1.254 </p>
<p>I have port forwarded from (5000) that router using DNAT to a machine
 called Frodo 192.168.1.2. Frodo has a OpenVPN client that connects to 
VPN service so that my torrenting some other activities remain anonymous
 from Frodo. This has VPN address of 10.4.x.x (also dynamic).</p>
<p>192.168.1.2 (Fordo) 10.4.x.x</p>
<p>So prior to the VPN tunnel being brought up. When I get a request 
into Tomato on port 5000 that is forwarded to Frodo and all is well, 
because the default route on Frodo without the VPN running is 
192.168.1.254 (default GW)</p>
<p>Now when the OpenVPN system starts up on Frodo the default route 
changes to 10.4.1.1 since it eats up all trafffic. So now when a 
forwarded request reaches Frodo via the DNAT, it cannot make it back 
since its going back to internet IP:port because the default GW is via 
the VPN and so the forwaded port doesn’t respond to external traffic. </p>
<p>I suspect I having a similar issue to what you suggested. I have 
tried whats on your post but it didn’t do the trick.. any suggestions? </p>
<p>I have two interfaces eth0 and tun0 (VPN) </p>
<p>Thanks!</p>
<p>PS: All ports and IPs appearing in this post  are fictitious. Any resemblance to real ports and ips, is purely coincidental.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-807" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-807">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted October 30, 2013 at 11:23 am</li> <li><a href="#comment-807" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=807#respond" onclick='return addComment.moveForm( "div-comment-807", "807", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Manojav, </p>
<p>Yes, this is a known issue with OpenVPN.  You’re essentially looking 
to setup what’s known as a “split-tunnel VPN”.  If you search Google for
 “openvpn split tunnel”, you will like find additional resources on how 
to accomplish this, such as: <a href="http://swimminginthought.com/routing-traffic-vpn/" rel="nofollow">http://swimminginthought.com/routing-traffic-vpn/</a> </p>
<p>If those search results don’t yield anything useful, then my next 
recommendation would be to contact the OpenVPN support forums to look 
for a possible answer — mention or search for the “split tunnel” 
keywords, as well. </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-808" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-808">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Manojav</span></li>
		<li>Posted October 30, 2013 at 11:54 am</li> <li><a href="#comment-808" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=808#respond" onclick='return addComment.moveForm( "div-comment-808", "808", "respond", "4" )' aria-label="Reply to Manojav">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien,</p>
<p>agreed this is due to default routes the vpn  sets up. but the issue 
is that when i send a request that originates in the 192.168.1.x network
 the response is sent back over that interface, this only occurs for 
DNATed connections that need to traverse my NAT firewall and reach the 
internet through the default network GW 192.168.1.254 rather than the 
VPN default GW.</p>
<p>so OpenVPN folks send me back to ip route folks and ip route folks 
bounce me back to openvpn.. suspect this is something I cannot do..</p>
<p>what i need is to have a default gw as the vpn for all requests 
except for those to or from a certain port.. i tried setting fwmarks as 
well. but i dont know how to debug those packets.. </p>
<p>Thanks</p>
	</div>
	</div>
<ul class="children">
<li id="comment-809" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-809">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted October 30, 2013 at 12:10 pm</li> <li><a href="#comment-809" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=809#respond" onclick='return addComment.moveForm( "div-comment-809", "809", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Got it.  Yeah, the bouncing back and forth between the forums can
 get quite old.  Even though the 192.168.1.x network is internal, you 
could try treating that as an external network within the OpenVPN 
configuration, so that it thinks there is a split tunnel route 
altogether.  Part of the problem, is I think OpenVPN may shim the kernel
 in a way that makes packet debugging a real pain… </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-810" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-810">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Manojav</span></li>
		<li>Posted October 30, 2013 at 1:20 pm</li> <li><a href="#comment-810" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Big D!</p>
<p>Thanks to you I have worked it out.</p>
<p>ip route del table LAN<br>
ip route add 192.168.1.0/24 dev eth0 src 192.168.1.2 table LAN<br>
ip route add default via 192.168.1.252 dev eth0 table LAN</p>
<p>ip rule add from 192.168.1.2/32 table LAN<br>
ip rule add to 192.168.1.2/32 table LAN</p>
<p>ip route add default table LAN via 192.168.1.252<br>
ip rule add fwmark 1 table LAN<br>
ip route flush cache<br>
iptables -t mangle -I PREROUTING -p tcp –sport SRC_PORT_OF_SERVICE -j MARK –set-mark 1</p>
<p>I stuck this in a shell script and called it on route-up on the opevpn connection.</p>
<p>I am not sure what I am doing here.. but seems to work, new 
connections head out to the VPN GW. port forwarded connections also 
work.. do i have some hole open that I am not seeing? </p>
<p>thanks a bunch! (for nothing :-))</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-811" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-811">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="http://whoseeks,finds/" rel="external nofollow" class="url">zad</a></span></li>
		<li>Posted October 30, 2013 at 7:16 pm</li> <li><a href="#comment-811" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=811#respond" onclick='return addComment.moveForm( "div-comment-811", "811", "respond", "4" )' aria-label="Reply to zad">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Une solution permettant d’avoir plusieurs réseaux différents. 
Donc avec plusieurs passerelles. Et ceci sur une seule machine ayant 
pour chaque réseau une carte réseau dédié.<br>
Cette solution fonctionne pour des réseaux public ou comme ici pour un réseau de classe C.<br>
Cette solution peut fonctionner également derrière une architecture VLAN.</p>
<p># The loopback network interface<br>
auto lo<br>
iface lo inet loopback </p>
<p># The network 0 interface<br>
auto eth0<br>
iface eth0 inet static<br>
        address 192.168.0.1<br>
        netmask 255.255.255.0<br>
        broadcast 192.168.0.255<br>
        network 192.168.0.0<br>
        gateway 192.168.0.254<br>
        up /sbin/ip route add default via 192.168.0.254 dev eth0 table network0<br>
        up /sbin/ip rule add from 192.168.0.0/24 table  network0<br>
        post-down /sbin/ip rule del from 192.168.0.0/24 table  network0<br>
        post-down /sbin/ip route del default via 192.168.0.254 dev eth0 table  network0<br>
        # dns-* options are implemented by the resolvconf package, if installed<br>
        ### Z1.Z2.Z3.Z4 U1.U2.U3.U4 : Les IPs de vos serveurs DNS<br>
        dns-nameservers Z1.Z2.Z3.Z4 U1.U2.U3.U4<br>
        dns-domain <span class="skimlinks-unlinked">yourdomain.tld</span><br>
        dns-search <span class="skimlinks-unlinked">yourdomain.tld</span></p>
<p>auto eth0:0<br>
          iface eth0:0 inet static<br>
          address 192.168.0.2<br>
          netmask 255.255.255.0</p>
<p>auto eth0:1<br>
          iface eth0:1 inet static<br>
          address 192.168.0.3<br>
          netmask 255.255.255.0</p>
<p># The network 1 interface<br>
auto eth1<br>
iface eth1 inet static<br>
        address 192.168.1.1<br>
        netmask 255.255.255.0<br>
        broadcast 192.168.1.255<br>
        network 192.168.1.0<br>
        ### gateway 192.168.1.254<br>
        up /sbin/ip route add default via 192.168.1.254 dev eth1 table network1<br>
        up /sbin/ip rule add from 192.168.1.0/24 table  network1<br>
        post-down /sbin/ip rule del from 192.168.1.0/24 table  network1<br>
        post-down /sbin/ip route del default via 192.168.1.254 dev eth1 table  network1<br>
        # dns-* options are implemented by the resolvconf package, if installed<br>
        ### Z1.Z2.Z3.Z4 U1.U2.U3.U4 : Les IPs de vos serveurs DNS<br>
        dns-nameservers Z1.Z2.Z3.Z4 U1.U2.U3.U4<br>
        dns-domain <span class="skimlinks-unlinked">yourdomain.tld</span><br>
        dns-search <span class="skimlinks-unlinked">yourdomain.tld</span></p>
<p>auto eth1:0<br>
          iface eth1:0 inet static<br>
          address 192.168.1.2<br>
          netmask 255.255.255.0</p>
<p>auto eth1:1<br>
          iface eth1:1 inet static<br>
          address 192.168.1.3<br>
          netmask 255.255.255.0</p>
<p># The network 2 interface<br>
auto eth2<br>
iface eth1 inet static<br>
        address 192.168.2.1<br>
        netmask 255.255.255.0<br>
        broadcast 192.168.2.255<br>
        network 192.168.2.0<br>
        ### gateway 192.168.2.254<br>
        up /sbin/ip route add default via 192.168.2.254 dev eth2 table network2<br>
        up /sbin/ip rule add from 192.168.2.0/24 table  network2<br>
        post-down /sbin/ip rule del from 192.168.2.0/24 table  network2<br>
        post-down /sbin/ip route del default via 192.168.2.254 dev eth2 table  network2<br>
        # dns-* options are implemented by the resolvconf package, if installed<br>
        ### Z1.Z2.Z3.Z4 U1.U2.U3.U4 : Les IPs de vos serveurs DNS<br>
        dns-nameservers Z1.Z2.Z3.Z4 U1.U2.U3.U4<br>
        dns-domain <span class="skimlinks-unlinked">yourdomain.tld</span><br>
        dns-search <span class="skimlinks-unlinked">yourdomain.tld</span></p>
<p>auto eth2:0<br>
          iface eth2:0 inet static<br>
          address 192.168.2.2<br>
          netmask 255.255.255.0</p>
<p>auto eth2:1<br>
          iface eth2:1 inet static<br>
          address 192.168.2.3<br>
          netmask 255.255.255.0</p>
<p>Enjoy !<img scale="0" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/1f609.svg" alt="😉" draggable="false" class="emoji"></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-815" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-815">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted November 22, 2013 at 12:36 pm</li> <li><a href="#comment-815" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=815#respond" onclick='return addComment.moveForm( "div-comment-815", "815", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Awesome article! This was the only way my vpn would even start with  two nics  a while back. Thanks!<br>
Here is my goal: Seperate network traffic. I want use my paid vpn 
service provider to encrypt the connection for a single application. The
 rest of my network applications I want to operate outside of my vpn. It
 doesn’t matter to me how I manage this goal: I have two network cards 
available – the default one in my motherboard and I have a spare pci 
NIC. I will install that extra nic if I need to but I’d prefer to 
somehow use virtual interfaces. I want to be able to use port forwarding
 for the rest of my network applications so they can hit the internet so
 i access them remotely I’m using Ubuntu 12.04. I’ve been playing with 
the bind and local options but still haven’t been able to figure this 
out. i’m sure this is similiar to what others have been saying on this 
thread, but I think this is slightly different and more basic. Do 
virtual interfaces work the same way as physical nics?</p>
<p>Thanks Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-816" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-816">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 22, 2013 at 1:38 pm</li> <li><a href="#comment-816" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=816#respond" onclick='return addComment.moveForm( "div-comment-816", "816", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>The virtual NICs should operate the exact same way as the 
physical NICs.  The major challenge, will be understanding all the 
custom IPs that your application uses, which will require custom routes 
for each netmask.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-819" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-819">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted December 1, 2013 at 6:49 pm</li> <li><a href="#comment-819" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=819#respond" onclick='return addComment.moveForm( "div-comment-819", "819", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the advice Darien and for getting back to me so 
quickly. I will answer sooner next time, I was just away for the week. 
So it seems like I shouldn’t use the second NIC and just use virtual 
interfaces. Let’s say for educational sake that<br>
ETH0 = 4.4.4.4<br>
and ETH0:1 = 4.4.4.5</p>
<p>I want to run rtorrent + rutorrent in 4.4.4.5. Everything else is fine at 4.4.4.4. Can you help me configure the routes?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-820" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-820">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 1, 2013 at 7:41 pm</li> <li><a href="#comment-820" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=820#respond" onclick='return addComment.moveForm( "div-comment-820", "820", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>It really depends on the applications.  You need to figure out 
all the TCP/UDP ports that the torrent clients use, in order to develop a
 same routing policy.  My best recommendation, would be to run your 
torrent clients while capturing full PCAPs in order to see what the 
common ports/IPs are, which would be the basis for your defined routes.</p>
<p>I am not intimately familiar with all the protocols used by standard torrent clients.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-826" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-826">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted December 16, 2013 at 10:42 am</li> <li><a href="#comment-826" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hey Darien,</p>
<p>I have another follow up question about my above post. I think I have everything working properly.<br>
I have two interfaces-<br>
So right now everything is working fine with the below routing command in webmin custom commands.<br>
sudo echo “1 admin” &gt;&gt; /etc/iproute2/rt_tables; sudo ip route add 
4.4.4.0/24 dev eth0 src 4.4.4.4 table admin; sudo ip route add default 
via 4.4.4.1 dev eth0 table admin; sudo ip rule add from 4.4.4.4/32 table
 admin; sudo ip rule add to 4.4.4.4/32 table admin; sudo ip route flush 
cache; sudo ip rule show  </p>
<p>Would there be any benefit to creating a table with the commands below for the vpn?<br>
sudo echo “1 vpn” &gt;&gt; /etc/iproute2/rt_tables; sudo ip route add 
4.4.4.0/24 dev eth0:1 src 4.4.5.4 table vpn; sudo ip route add default 
via 4.4.4.1 dev eth0:1 table vpn; sudo ip rule add from 4.4.5.4/32 table
 vpn; sudo ip rule add to 4.4.5.4/32 table vpn; sudo ip route flush 
cache; sudo ip rule show  </p>
<p>Thanks!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-827" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-827">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 16, 2013 at 2:57 pm</li> <li><a href="#comment-827" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>I’d recommend changing the “1 vpn” string to “2 vpn”, because you
 already have “1 admin” defined, and your follow on commands will 
overwrite, rather than append to the routing policy.</p>
<p>Aside from that, the VPN commands you have seem like it would work.  
My recommendation would be to try and see, as I know others were able to
 get it to work on virtual interfaces successfully.</p>
<p>Regards,<br>
— Darien </p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-829" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-829">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted December 16, 2013 at 3:52 pm</li> <li><a href="#comment-829" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Thanks Darien I updated my code for the vpn table- sudo echo “2 
vpn2″ &gt;&gt; /etc/iproute2/rt_tables;  and called the table vpn2</p>
<p>0:	from all lookup local<br>
32762:	from all to 4.4.5.4 lookup vpn2<br>
32763:	from 4.4.5.4 lookup vpn2<br>
32764:	from all to 4.4.4.4 lookup admin<br>
32765:	from 4.4.4.4 lookup admin<br>
32766:	from all lookup main<br>
32767:	from all lookup default ” </p>
<p>This is my output. So these two connections should be totally isolated at this point. </p>
<p>No my question is which becomes the default route for any internet 
connection? I want 4.4.4.4 admin table to be the default route, but I 
always thought lower numbers in linux get the priority.</p>
<p>Thanks Darien this page is awesome!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-830" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-830">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted December 16, 2013 at 4:13 pm</li> <li><a href="#comment-830" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Yes, you’d want to swap the ordering, so that the admin table 
gets lower priority numbering (which means it gets evaluated first).</p>
<p>Aside from that, I’d recommend testing it out, to make sure everything is working, by running tcpdump, accordingly.</p>
<p>Regards,<br>
 — Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-838" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-838">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted January 30, 2014 at 11:37 am</li> <li><a href="#comment-838" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=838#respond" onclick='return addComment.moveForm( "div-comment-838", "838", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien. I use two interfaces in parallel, basically setup as your
 example. Now the problem I am having is that when the primary interface
 (The one with the default gateway in the main routing table) is gone 
(And there is no default gateway route in the main table anymore), I am 
not able to do any dns lookups anymore. (Traceroute still finds the dns 
server though) Are there perhaps other ip rules to add for this case or 
should you fall back to adding the secondary gateway to the main table?</p>
	</div>
	</div>
<ul class="children">
<li id="comment-839" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-839">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted January 30, 2014 at 2:46 pm</li> <li><a href="#comment-839" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=839#respond" onclick='return addComment.moveForm( "div-comment-839", "839", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Basically, policy routing is not going to help you achieve 
failover routing, which is what you’re looking to do. I would recommend 
doing a Google search (terms: “linux failover routing”) to see what 
options are available for Linux fail over routing. It is likely you will
 need to install a custom tool to accomplish this.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-1125" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-1125">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ivo</span></li>
		<li>Posted April 8, 2014 at 1:13 am</li> <li><a href="#comment-1125" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=1125#respond" onclick='return addComment.moveForm( "div-comment-1125", "1125", "respond", "4" )' aria-label="Reply to ivo">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien, this is a fantastic article! I came back to read it 
again, as I am having problems configuring my interfaces with Debian 
Wheezy. I made it work on my previous server, but sadly the motherboard 
died and when trying to replicate I am failing.  One thing I noticed for
 a start, the routing table with one network card looks like this:<br>
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface<br>
0.0.0.0         192.168.0.1     0.0.0.0         UG        0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0<br>
239.0.0.0       0.0.0.0         255.0.0.0       U         0 0          0 eth0</p>
<p>The default route appears first unlike previous time. Does that 
matter? From there on, the ip route add and ip rule add commands do get 
executed, but no change on routing table occurs. Any pointers?<br>
Thanks a lot,</p>
<p>Ivo</p>
	</div>
	</div>
<ul class="children">
<li id="comment-1140" class="comment byuser comment-author-kindlund bypostauthor even depth-4 highlander-comment">
	<div id="div-comment-1140">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted April 9, 2014 at 12:10 am</li> <li><a href="#comment-1140" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=1140#respond" onclick='return addComment.moveForm( "div-comment-1140", "1140", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Ivo, </p>
<p>It sounds like the kernel doesn’t have policy routing compiled in, 
which means you may need to custom compile your kernel with that 
support, accordingly. </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-1320" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-1320">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ivo</span></li>
		<li>Posted April 16, 2014 at 7:39 pm</li> <li><a href="#comment-1320" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Well I checked my /boot/config and policy routing is enabled. I 
do thing is something to do with the way interfaces are configured at 
boot time, but seem unable to find exactly what is wrong. I have  two 
interfaces and use same gateway. My /etc/network/interfaces:<br>
auto eth0<br>
allow-hotplug eth0<br>
iface eth0 inet static<br>
        address 192.168.0.11<br>
        netmask 255.255.255.0<br>
        network 192.168.0.0<br>
        broadcast 192.168.0.255<br>
        gateway 192.168.0.1<br>
        post-up ip route add 192.168.0.0/24 dev eth0 src 192.168.0.11 table uplink0<br>
        post-up ip route add default via 192.168.0.1 dev eth0 table uplink0<br>
        post-up ip rule add from 192.168.0.11/32 table uplink0<br>
        post-up ip rule add to 192.168.0.11/32 table uplink0<br>
auto eth1<br>
allow-hotplug eth1<br>
iface eth1 inet static<br>
        address 192.168.0.21<br>
        netmask 255.255.255.0<br>
        network 192.168.0.0<br>
        broadcast 192.168.0.255<br>
#       gateway 192.168.0.1<br>
        post-up ip route add 192.168.0.0/24 dev eth1 src 192.168.0.21 table uplink1<br>
        post-up ip route add default via 192.168.0.1 dev eth1 table uplink1<br>
        post-up ip rule add from 192.168.0.21/32 table uplink1<br>
        post-up ip rule add to 192.168.0.21/32 table uplink1<br>
#       #dns-* options implemented by resolver<br>
        dns-nameservers 8.8.8.8 8.8.4.4<br>
        dns-search <a style="" href="https://mydomain.com/" class="skimlinks-unlinked" data-skimwords-word="mydomain.com" data-skim-creative="500005" title="">mydomain.com</a><br>
If I enable gateway on eth 1, interface does not get configured. If I 
disable eth0 gateway, the routing table gets configured with routing 
table configured for both interfaces correctly, but no gateway therefore
 unable to reach internet at all. If however I boot with the above 
configuration, the routing table is:</p>
<p>Kernel IP routing table<br>
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface<br>
0.0.0.0         192.168.0.1     0.0.0.0         UG        0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth1<br>
239.0.0.0       0.0.0.0         255.0.0.0       U         0 0          0 eth0</p>
<p>and I am back to the original problem, all output goes through eth0. Any hints?<br>
Thanks a lot for taking your time.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-1132" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-1132">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ChrisB</span></li>
		<li>Posted April 8, 2014 at 3:45 pm</li> <li><a href="#comment-1132" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=1132#respond" onclick='return addComment.moveForm( "div-comment-1132", "1132", "respond", "4" )' aria-label="Reply to ChrisB">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>WOW!!!  This is brilliant!!  This helped me a lot with an 
engineering project that I’ve been on involving a Linux server.  You are
 a life saver!!!  Thank you so much!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-1512" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-1512">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted April 23, 2014 at 4:43 am</li> <li><a href="#comment-1512" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=1512#respond" onclick='return addComment.moveForm( "div-comment-1512", "1512", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>thanks for your help. you save my job. you are boss.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-3342" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-3342">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="https://www.youtube.com/watch?v=grXH-l8wZDU" rel="external nofollow" class="url">serwis kserokopiarek gliwice</a></span></li>
		<li>Posted June 13, 2014 at 5:22 pm</li> <li><a href="#comment-3342" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=3342#respond" onclick='return addComment.moveForm( "div-comment-3342", "3342", "respond", "4" )' aria-label="Reply to serwis kserokopiarek gliwice">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Wyjątkowo interesujący tekst, polecam wszystkim</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-3790" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-3790">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted June 27, 2014 at 12:12 pm</li> <li><a href="#comment-3790" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=3790#respond" onclick='return addComment.moveForm( "div-comment-3790", "3790", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Let me add more info to this excellent article:</p>
<p><a href="https://access.redhat.com/site/solutions/53031" rel="nofollow">https://access.redhat.com/site/solutions/53031</a></p>
<p>That is a alternative to the problem: it allows the traffic to pass through the default route dev.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-4127" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-4127">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Venkata Subramani</span></li>
		<li>Posted July 9, 2014 at 6:11 am</li> <li><a href="#comment-4127" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=4127#respond" onclick='return addComment.moveForm( "div-comment-4127", "4127", "respond", "4" )' aria-label="Reply to Venkata Subramani">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the info and it helped. This info is nicely putup.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-4927" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-4927">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted September 23, 2014 at 4:12 am</li> <li><a href="#comment-4927" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=4927#respond" onclick='return addComment.moveForm( "div-comment-4927", "4927", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>One of the most rewarding nuggets from Google mining I’ve struck in a long time</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5105" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5105">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">hogis</span></li>
		<li>Posted October 2, 2014 at 2:37 pm</li> <li><a href="#comment-5105" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5105#respond" onclick='return addComment.moveForm( "div-comment-5105", "5105", "respond", "4" )' aria-label="Reply to hogis">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Than you for sharing you knowledge! this helped me a lot:)</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5205" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-5205">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Cody</span></li>
		<li>Posted October 13, 2014 at 9:18 am</li> <li><a href="#comment-5205" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5205#respond" onclick='return addComment.moveForm( "div-comment-5205", "5205", "respond", "4" )' aria-label="Reply to Cody">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the writeup! I have some additional information that 
may be of use to some people (and if nothing else maybe you). I  didn’t 
read all comments so if this is here I am sorry for the repeat 
information. But here goes. Basic idea is this: I have a /29 block and I
 also have a dynamic IP (well, dynamic in that it isn’t considered 
static – it only changes when the modem/router the ISP provides is 
different [e.g., replaced] or change at the DSLAM). But while I have two
 NICs on the server, I designate eth1 to my internal network (which 
includes 10.0.0.0/8 and also an IPv6 /125 [which really isn’t internal 
but I filter it to make it act as such]). For my own domains I use one 
of my static IPs. However, I also host a friend’s website (only website,
 not any other service) and I use the dynamic IP for that. This means 
that eth0 has my static IP, its default gateway and also my dynamic IP. 
But until now it used my static IP default gateway. Well I’m here to 
report that indeed this method of yours works on the same NIC. So 
instead of using eth1 and eth0 (or however you have it named) you can 
use eth0 for both, eth1 for both or more generall ethN for both (or if 
you use systemd then it might be something else entirely …). </p>
<p>The other information is for systemd and specifically Red Hat based 
distributions (not sure of others as I only maintain servers that are 
Red Hat based). It may be of value even if with modifications. In order 
to maintain the rules/routes across reboots (rare as they may be) here 
is how to do it. You have:</p>
<p>directory: /etc/sysconfig/network-scripts<br>
files: /etc/sysconfig/network-scripts/ifcfg-ethN (where N is each NIC).<br>
Add the files:<br>
/etc/sysconfig/network-scripts/rule-ethN (e.g. rule-eth0) and 
/etc/sysconfig/network-scripts/route-ethN (e.g., route-eth0). Here is an
 important bit though. IF you have in the ifcfg-ethN file a route for 
the IP in question you must remove it from the  ifcfg-file (after adding
 it to route-ethN). If you don’t it won’t work properly. So what is the 
content of the two files?</p>
<p>For route-ethN you have two ways to do it. I use the older way as it 
is as if you pass each line to the ip command. I’ll use dynroute for the
 default route, dynnet for the network and dynip for the IP. Replace as 
necessary:</p>
<p>dynnet dev eth0 src dynip table dynamic<br>
default via dynroute dev eth0 table dynamic</p>
<p>For rule-ethN you have:<br>
from all to dynip table dynamic<br>
from dynip lookup dynamic</p>
<p>Note: I had a problem initially as ‘from dynip table’ and ‘to dynip 
table’ in the rule-ethN file. This might be however that I  (stupidly) 
used reload on network rather than restarting it.  This seems to not 
have deleted the rules (as I tend to test command line first) and so did
 not work. Then I forgot I had the route for the dynamic IP in the  
ifcfg file. This means when I restarted network (after deleting the 
rules!) the route was not there at all (only static IP route). So 
whether from all to is necessary or not I don’t know. What I do know is 
ip rule showed the above which is why I put that in the file.</p>
<p>Thanks again for the writeup! Hope the above is helpful.</p>
<p>Cheers.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5217" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5217">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">David</span></li>
		<li>Posted October 15, 2014 at 3:56 pm</li> <li><a href="#comment-5217" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5217#respond" onclick='return addComment.moveForm( "div-comment-5217", "5217", "respond", "4" )' aria-label="Reply to David">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I simply want to say thanks as this helped me solve a problem I had.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5321" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-5321">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Collette</span></li>
		<li>Posted November 6, 2014 at 9:03 am</li> <li><a href="#comment-5321" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5321#respond" onclick='return addComment.moveForm( "div-comment-5321", "5321", "respond", "4" )' aria-label="Reply to Collette">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I’m probably overlooking something but I can’t get the routing to
 work the way I want it. What I have is a Linux server with 3 nic’s. 
Eth0 is the local network, eth1 is ISP1 and eth2 is ISP2. </p>
<p>I case you are wondering why there are two ISP’s, well, Provider 1 
does allow that you run your own webserver, mailserver and mysql 
database that can be accessed from the internet. And I can add as many 
port forwarding rules in the modem/router they delivered. But the 
internet speed is much slower then from Provider 2.<br>
Provider 2 however doesn’t allow me to have a webserver and so on and 
did password protect the modem/router. Therefore only outgoing traffic 
is possible, but very fast.</p>
<p>ifconfig on the Linux box shows:</p>
<p>	eth0 192.168.1.150 netmask 255.255.255.0<br>
	eth1 10.0.0.150 netmask 255.255.255.0<br>
	eth2 10.0.1.150 netmask 255.255.255.0</p>
<p>and route -n shows:</p>
<p>	Kernel IP routing table<br>
	Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br>
	0.0.0.0           10.0.1.254      0.0.0.0              UG    0      0        0 eth2<br>
	10.0.0.0           0.0.0.0          255.255.255.0  U       0      0        0 eth1<br>
	10.0.1.0           0.0.0.0          255.255.255.0  U       0      0        0 eth2<br>
	127.0.0.0         0.0.0.0          255.0.0.0          U       0      0        0 lo<br>
	192.168.1.0     0.0.0.0          255.255.255.0  U       0      0        0 eth0</p>
<p>Finally, iptables -t nat -n –list -v shows (only showing the postrouting):</p>
<p>	Chain POSTROUTING (policy ACCEPT 7 packets, 490 bytes)<br>
	 pkts bytes target     prot opt in     out     source               destination<br>
	    1    84 MASQUERADE  all  —  *      eth1    0.0.0.0/0            0.0.0.0/0<br>
	    1    84 MASQUERADE  all  —  *      eth2    0.0.0.0/0            0.0.0.0/0    </p>
<p>Then I did setup the routing and the rules:</p>
<p>	ip route add 10.0.0.0/24 dev eth1 src 10.0.0.150 table RT1<br>
	ip route add default via 10.0.0.138 table RT1<br>
	ip rule add from 10.0.0.150 table RT1</p>
<p>	ip route add 10.0.1.0/24 dev eth2 src 10.0.1.150 table RT2<br>
	ip route add default via 10.0.1.254 table RT2<br>
	ip rule add from 10.0.1.150 table RT2</p>
<p>ip route show:</p>
<p>	default via 10.0.1.254 dev eth2<br>
	10.0.0.0/24 dev eth1  proto kernel  scope link  src 10.0.0.150<br>
	10.0.1.0/24 dev eth2  proto kernel  scope link  src 10.0.1.150<br>
	127.0.0.0/8 dev lo  scope link<br>
	192.168.1.0/24 dev eth0  proto kernel  scope link  src 192.168.1.240 </p>
<p>ip route show table RT1:</p>
<p>	default via 10.0.0.138 dev eth1<br>
	10.0.0.0/24 dev eth1  scope link  src 10.0.0.150 </p>
<p>ip route show table RT2:</p>
<p>	default via 10.0.1.254 dev eth2<br>
	10.0.1.0/24 dev eth2  scope link  src 10.0.1.150 </p>
<p>ip rule show:</p>
<p>	0:	from all lookup local<br>
	32764:	from 10.0.1.150 lookup RT2<br>
	32765:	from 10.0.0.150 lookup RT1<br>
	32766:	from all lookup main<br>
	32767:	from all lookup default </p>
<p>So far everything looks to go the right way. That is, if the 
forwarding in the modem/router from provider 1 goes to 10.0.0.150 the 
answer goes back over eth1.<br>
The webserver that runs on the Linux box can now be found from the internet and still from the local network.</p>
<p>But now the problem. If I want to access a Windows machine with 
remote desktop that Windows machine has ip-address 192.168.1.x. So I 
added a rule in the modem/router from provider 1 to forward port 3389 to
 192.168.1.x and added a static routing. It now shows:</p>
<p>	Network: 192.168.1.0 Mask: 255.255.255.0 GW 10.0.0.150</p>
<p>With tcpdump I can see that there is traffic going from an external 
address to the Windows machine but there isn’t going any answer back to 
the external address. Not on eth1 and not on eth2.</p>
<p>What is needed to be able to access a machine on the internal network from extern over the connection from provider 1??</p>
<p>As I have turned on masquarading I thought that any answer that goes 
over eth1 would look like it came from 10.0.0.150 but tcpdump doesn’t 
show that.</p>
<p>I’m stuck!! Please somebody help!!</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5322" class="comment byuser comment-author-kindlund bypostauthor even depth-3 highlander-comment">
	<div id="div-comment-5322">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 6, 2014 at 9:59 am</li> <li><a href="#comment-5322" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5322#respond" onclick='return addComment.moveForm( "div-comment-5322", "5322", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Collette,</p>
<p>&gt; So I added a rule in the modem/router from provider 1<br>
&gt; to forward port 3389 to 192.168.1.x and added a static routing.<br>
&gt; It now shows:<br>
&gt;<br>
&gt; Network: 192.168.1.0 Mask: 255.255.255.0 GW 10.0.0.150</p>
<p>I think that’s where the problem is.  With this route, you’re 
essentially telling your Linux system to route all traffic destined to 
192.168.1.0/24 *through* the upstream RT1 gateway, which isn’t what you 
want.</p>
<p>Instead, I think you’ll have to write a custom iptables rule 
(ROUTING) to essentially perform the port-forwarding activity that 
you’re trying to accomplish.  Look for examples for port-forwarding in 
iptables on how to accomplish this.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5323" class="comment odd alt depth-4 highlander-comment">
	<div id="div-comment-5323">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Collette</span></li>
		<li>Posted November 6, 2014 at 10:36 am</li> <li><a href="#comment-5323" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5323#respond" onclick='return addComment.moveForm( "div-comment-5323", "5323", "respond", "4" )' aria-label="Reply to Collette">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>I tried to do forwarding on the server like so:</p>
<p>iptables -A PREROUTING -t nat -i eth1 -p tcp –dport 3389 -j DNAT to 192.168.1.x</p>
<p>and removed the forwarding in the modem/router from provider 1. Then I
 added a forwarding for port 3389 to forward it to 10.0.0.150 (eth1 on 
the server). Without that forwarinding nothing comes in on the server.</p>
<p>But the problem seems to be that the answer isn’t coming from 
10.0.0.150 but from 192.168.1.x and therefore it goes over the default 
gw and that is the other provider.</p>
<p>incoming: xxxx -&gt; 192.168.1.x on eth1<br>
outgoing: 192.168.1.x -&gt; xxxx on eht2</p>
<p>greetings,<br>
Collette</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5331" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-5331">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted November 7, 2014 at 8:48 am</li> <li><a href="#comment-5331" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Hi Collette, </p>
<p>I think there’s a way to specify in the PREROUTING directive *which* 
interface the reply traffic should go back out through.  If that’s not 
possible, you may need another iptables directive specified, in order to
 fix this. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5332" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-5332">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Cody</span></li>
		<li>Posted November 7, 2014 at 12:31 pm</li> <li><a href="#comment-5332" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>Here’s how matching of interface works in iptables. In this case I’m explaining outgoing packets.</p>
<p>I no longer use this for the fact that my service changed (and I now 
have a static IP block whereas before I had a single static IP), but 
when I did nat for my local network (specifically: my server was my 
router – so 10.0.0.0/8 was the localnet, my IP was at the time 
64.174.104.17 – and so all internal machines were in the local subnet, 
all out going packets went out as if 64.174.104.17 and incoming would go
 to the machine that is associated.. the server itself had the 64. ip 
bound to its external NIC and sent and received that way… you get the 
idea). I only had two NICs on the server (still only have two NICs but 
point is I don’t have 3 like the one asking for help.. only one ISP and 
so less complicated setup). Regardless, if my masquerade nic was eth0 
(was), then I had the following rule:</p>
<p>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</p>
<p>The -o eth0 matches packets going out eth0 (and -i is not allowed 
with POSTROUTING as -i is for incoming, to explain that more generally).
 I tried following the setup (as yesterday) but I was quite exhausted 
(yesterday and today too) … I’ve not really mapped out Collete’s setup 
and I don’t intend to try (see previous point). But hopefully the 
iptables rule explains the interface part. The layout of my network was 
basically this, at least for the above:</p>
<p>server eth0 -&gt; isp router/modem -&gt; Internet<br>
server eth1 -&gt; 10.0.0.0/8 net attached to switch (that was part of the router/modem that eth0 is also connected to)<br>
client machine eth0 -&gt; attached to switch on isp router/modem. no 
external ip, only one in the 10.0.0.0/8 block. default gw was eth1 of 
server (let’s say 10.0.0.1). Client could not connect (as I filtered) to
 64.174.104.17 (the server public IP) but could the internal NIC. 
Similar,  packets claiming to be from 64.174.104.17 were filtered as the
 server shouldn’t be sending packets to itself with its IP. Therefore 
the only way to connect to (maybe better put: external packets could 
only reach) the internal machines is through the server (obviously there
 was connections and obviously the server is allowed to communicate with
 the internal machines so in a sense they aren’t internal, but you get 
the idea, hopefully). The only requirement was that the client had a way
 to be on the server’s internal network, so that the server could NAT 
for it (as it had no public IP.. I had the modem/router in bridged mode,
 to be specific). The other client was set up the same way.</p>
<p>Hopefully I explained that all correctly and well enough. If not, feel free to respond and I’ll try to elaborate (or fix).</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5365" class="comment even depth-5 highlander-comment">
	<div id="div-comment-5365">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Collette</span></li>
		<li>Posted November 10, 2014 at 5:32 am</li> <li><a href="#comment-5365" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>I found a solution (or maybe, the solution). </p>
<p>I gave the machines on the local lan that must be accessible from the internet an extra ip-address (192.178.1.x).</p>
<p>On Linux boxes this is easy (eth 0:0 192….) and even dhcp can still 
be used for the primary local lan address. But on Windows it only works 
if you use fixed addresses.<br>
The server must have this secondary address as well on eth0. So ifconfig eht0:0 192.178.1.150 </p>
<p>Only 1 Windows machine, the Linux server and 1 other Linux machine 
have addresses on this secondary network. In the router/modem from 
internet provider 1 I can just forward port 3389 to 192.178.1.2 (the 
Windows machine). The answers now come back from 192.178.1.2 but still 
go out over the default gw (provider 2).</p>
<p>To get them out the right way, I added a rule to like so: ip rule add from 192.178.1.0/24 lookup RT1</p>
<p>Now the answer goes out over the connection from provider 1. All the 
machines on the local lan can still find each other over the primary 
network addresses (192.168.1.x). And of course, that Windows machine 
with the 2 ip-addresses will still use the default gw  if I want to 
access the internet from it. Meaning that it will go over the connection
 from provider 2.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-5646" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-5646">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="https://github.com/r0bst3r/Sourceroute/" rel="external nofollow" class="url">Robbie Wilson</a></span></li>
		<li>Posted February 13, 2015 at 4:12 pm</li> <li><a href="#comment-5646" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5646#respond" onclick='return addComment.moveForm( "div-comment-5646", "5646", "respond", "4" )' aria-label="Reply to Robbie Wilson">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Based on this article I wrote a python script to automate running
 these commands.  This script determines the ip address information 
needed and then runs the iproute2 utilities to add the routing rules.  I
 hope this helps someone else out.  It is available at <a href="https://github.com/r0bst3r/Sourceroute/" rel="nofollow">https://github.com/r0bst3r/Sourceroute/</a></p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5690" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5690">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Ashkan</span></li>
		<li>Posted May 13, 2015 at 5:36 pm</li> <li><a href="#comment-5690" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5690#respond" onclick='return addComment.moveForm( "div-comment-5690", "5690", "respond", "4" )' aria-label="Reply to Ashkan">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you very much for your great how-to. It really helped me, without facing any problem!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5704" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-5704">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted June 25, 2015 at 10:16 am</li> <li><a href="#comment-5704" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5704#respond" onclick='return addComment.moveForm( "div-comment-5704", "5704", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for this post!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5709" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5709">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Ron</span></li>
		<li>Posted July 6, 2015 at 8:36 am</li> <li><a href="#comment-5709" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5709#respond" onclick='return addComment.moveForm( "div-comment-5709", "5709", "respond", "4" )' aria-label="Reply to Ron">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,<br>
I have a different requirement. The article clearly tells that the both 
NICs should be tagged with IP addresses. But if i want to change the IP 
address of any of interface using ifconfig command, that change wont be 
reflected in the IP rules. So i will be again need to set new rules for 
that changed interface address. Is there any way to automatically update
 the rules with ifconfig command? Or is there a way to set the rules 
based on device MAC address rather than device IP address?<br>
Thank you</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5712" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-5712">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted July 25, 2015 at 5:14 pm</li> <li><a href="#comment-5712" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5712#respond" onclick='return addComment.moveForm( "div-comment-5712", "5712", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Ron,</p>
<p>Yes, what you are looking for, is to define a “trigger script” that 
fires everytime one of the IPs change on any of the interfaces.  This is
 usually the case if one of the interfaces is getting IP assignments 
from a DHCP server.  As such, I’d recommend reading the man page of 
dhclient, as I believe there is a section that talks about how to define
 such scripts.</p>
<p>Then, whenever the IP address changes, dhclient would call your 
script, which would redefine the rule sets to allow the correct policy 
route.</p>
<p>Regards,<br>
— Darien</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-5715" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-5715">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Adrian</span></li>
		<li>Posted August 13, 2015 at 1:01 pm</li> <li><a href="#comment-5715" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5715#respond" onclick='return addComment.moveForm( "div-comment-5715", "5715", "respond", "4" )' aria-label="Reply to Adrian">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien, thanks for this writeup.  I used your blog a few years 
ago to configure three web hosting dual-nic ubuntu servers during an IP 
transition.  It worked like a charm as they responded to both public ip 
addresses.</p>
<p>I am now thoroughly confused about when a solution like this would be
 necessary otherwise.  Any clarification would be appreciated!</p>
<p>Lets say I have an NFS server on a local network (default gw, eth0) 
and decide to give it a second nic (eth1) on another subnet.  I then 
throw a second nic (eth1) into my pc with the same subnet on the same 
vlan.  If I were to try to ping the NFS via my eth1 to it’s eth1, would 
it try to respond via eth0?  If this erroneous behavior occured, NFS 
would still work because I am directly connecting to it, correct (unlike
 an ICMP which wouldn’t be the same connection, but a generated 
response?)  Or does all of this only matter when there is a third 
variable – access came in from an ip address not in the network (from 
the default gw) ?  What if both eth1 were on the same subnet but with 
different IP addresses, would the NFS server still attempt to respond 
from eth0?  Ugh, thanks in advance!</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5716" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-2 highlander-comment">
	<div id="div-comment-5716">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted August 13, 2015 at 1:27 pm</li> <li><a href="#comment-5716" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5716#respond" onclick='return addComment.moveForm( "div-comment-5716", "5716", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Adrian, </p>
<p>There is some detail missing from your description, so I’m going to 
try to filling the blanks by stating some assumptions. You mentioned 
that you have a PC with two different Ethernet cards, but you don’t 
explicitly state how eth0 is configured on the PC. On the PC, I’m going 
to assume that eth0 is connected to the same exact local network that 
eth1 is connected to. </p>
<p>If this assumption is correct, then you would need to have proper 
policy routing enabled on both the PC and the NFS server, in order to 
avoid the type of overlapping problems that you’re encountering. If you 
have proper policy routing just on the NFS server, then you will still 
run into the issues you’ve described. </p>
<p>Let me know if this makes sense. </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5717" class="comment even depth-3 highlander-comment">
	<div id="div-comment-5717">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="https://github.com/r0bst3r/Sourceroute/" rel="external nofollow" class="url">Robbie Wilson</a></span></li>
		<li>Posted August 13, 2015 at 1:29 pm</li> <li><a href="#comment-5717" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5717#respond" onclick='return addComment.moveForm( "div-comment-5717", "5717", "respond", "4" )' aria-label="Reply to Robbie Wilson">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Not sure if this helps, but I wrote a python script that helps automate the pbr setup in linux. <a href="https://github.com/r0bst3r/Sourceroute" rel="nofollow">https://github.com/r0bst3r/Sourceroute</a></p>
	</div>
	</div>
<ul class="children">
<li id="comment-5718" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-5718">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted August 13, 2015 at 1:32 pm</li> <li><a href="#comment-5718" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5718#respond" onclick='return addComment.moveForm( "div-comment-5718", "5718", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks, Robbie! This script should be very useful to new readers. </p>
<p>Regards,</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5720" class="comment even depth-4 highlander-comment">
	<div id="div-comment-5720">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Adrian</span></li>
		<li>Posted August 13, 2015 at 1:59 pm</li> <li><a href="#comment-5720" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5720#respond" onclick='return addComment.moveForm( "div-comment-5720", "5720", "respond", "4" )' aria-label="Reply to Adrian">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thank you Robbie.  This is excellent!</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5722" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-5722">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="https://github.com/r0bst3r/Sourceroute/" rel="external nofollow" class="url">Robbie Wilson</a></span></li>
		<li>Posted August 13, 2015 at 2:08 pm</li> <li><a href="#comment-5722" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>I am not the worlds best programmer, so if you find any bugs please let me know or reply on the Github page</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-5719" class="comment even depth-3 highlander-comment">
	<div id="div-comment-5719">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Adrian</span></li>
		<li>Posted August 13, 2015 at 1:58 pm</li> <li><a href="#comment-5719" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5719#respond" onclick='return addComment.moveForm( "div-comment-5719", "5719", "respond", "4" )' aria-label="Reply to Adrian">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Darien, my apologies for not providing enough detail.  The setup 
described is only hypothetical.   My confusion lies in understanding 
*when* I would need to use policy based routing.  </p>
<p>server:<br>
eth0: 10.1.1.1 255.255.255.0 gw 10.1.1.254<br>
eth1: 192.168.1.1 255.255.255.0</p>
<p>client:<br>
eth0: 10.1.1.2 – 255.255.255.0<br>
eth1: 192.168.1.2 – 255.255.255.0</p>
<p>server and client eth0 share switch1<br>
server and client eth1 share switch2</p>
<p>Without policy routing, if I ping client(eth1) -&gt; server(eth1) 
would server attempt to respond via eth0 because eth0 has the default 
gw?  Or..  Does the server know to respond via eth1 because the request 
came from an ip on its eth1 local network (my client’s eth1) ?  Is all 
of this only really a problem if it’s coming from ip addresses *not* in 
either of their subnets, ie. that need to be reached via a GW. hence 
routing configuration telling them “which” gateway ? </p>
<p>Thanks for taking the time to reply to my nonsense. <img scale="0" class="wp-smiley emoji" draggable="false" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/simple-smile.svg" style="height: 1em; max-height: 1em;" height="16" width="16"></p>
	</div>
	</div>
<ul class="children">
<li id="comment-5721" class="comment byuser comment-author-kindlund bypostauthor odd alt depth-4 highlander-comment">
	<div id="div-comment-5721">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted August 13, 2015 at 2:07 pm</li> <li><a href="#comment-5721" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5721#respond" onclick='return addComment.moveForm( "div-comment-5721", "5721", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>&gt; Without policy routing, if I ping client(eth1) -&gt; 
server(eth1) &gt; would server attempt to respond via eth0 because eth0 
&gt; has the default gw? </p>
<p>No, it shouldn’t.  This is because you’re trying to reach a resource 
on your local subnet directly, in which case, the gateway never gets 
involved.  That said, to be absolutely sure, you’d need to provide a 
copy of your routing table (e.g., ‘netstat -anr’ output).  This is 
because I need to see how far *down* in the routing rules you have your 
local routes set, compared to the default route going to your gateway.  
Usually, your default gateway route entry is set as the *last* entry 
within your routing table (which is the basis of my original 
assumption). </p>
<p>&gt; Is all of this only really a problem if it’s coming from ip &gt;
 addresses *not* in either of their subnets, ie. that need &gt; to be 
reached via a GW. hence routing configuration telling &gt; them “which” 
gateway ? </p>
<p>Yes, precisely.  It’s only a problem when you have two distinct 
Ethernet interfaces that both need to be publicly, Internet routable 
*beyond* the local subnet (which requires working with at least one 
upstream gateway). </p>
<p>Regards,</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5723" class="comment even depth-5 highlander-comment">
	<div id="div-comment-5723">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Adrian</span></li>
		<li>Posted August 13, 2015 at 2:16 pm</li> <li><a href="#comment-5723" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<blockquote><p> It’s only a problem when you have two distinct 
Ethernet interfaces that both need to be publicly, Internet routable 
*beyond* the local subnet (which requires working with at least one 
upstream gateway).</p></blockquote>
<p>Thank you!  That is exactly what I was after.  I owe you a beer.</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5724" class="comment odd alt depth-5 highlander-comment">
	<div id="div-comment-5724">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted August 18, 2015 at 2:35 pm</li> <li><a href="#comment-5724" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>&gt; This is because I need to see how far *down* in the routing 
rules you have your local routes set, compared to the default route 
going to your gateway. Usually, your default gateway route entry is set 
as the *last* entry within your routing table (which is the basis of my 
original assumption).<br>
This seems to be my problem, my default route always appears on top, 
gets evaluated first and traffic goes out the wrong interface.  How does
 default gateway get added to the bottom of the ruleset rather than the 
top?</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5725" class="comment byuser comment-author-kindlund bypostauthor even depth-5 highlander-comment">
	<div id="div-comment-5725">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted August 18, 2015 at 3:04 pm</li> <li><a href="#comment-5725" title="Permalink to this comment">Permalink</a></li> <li> </li>
	</ul>
	<div class="comment-content">
				<p>&gt; How does default gateway get added to the &gt; bottom of the ruleset rather than the top? </p>
<p>You can delete your default route using the ‘route’ command, and then
 re-add it using the ‘route’ command.  That operation will move your new
 route rule to the bottom of the ruleset, accordingly. </p>
<p>Regards, Darien </p>
<p>On Tue, Aug 18, 2015 at 2:35 PM, Darien Kindlund's Blog  wrote: </p>
<p>&gt;</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-5726" class="comment odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5726">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">noone</span></li>
		<li>Posted August 18, 2015 at 4:39 pm</li> <li><a href="#comment-5726" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5726#respond" onclick='return addComment.moveForm( "div-comment-5726", "5726", "respond", "4" )' aria-label="Reply to noone">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi Darien,</p>
<p>I have two nics, eth0 and eth1. eth0 is only ever used locally, I run
 an IDS and captures all traffic hitting my DSL port. eth1 is used for 
everything else. One common gateway and following configuration:<br>
# ip addr<br>
4: eth0:  mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>
    link/ether 60:a4:4c:65:cb:c8 brd ff:ff:ff:ff:ff:ff<br>
    inet 192.168.0.88/24 brd 192.168.0.255 scope global eth0<br>
       valid_lft forever preferred_lft forever<br>
5: eth1:  mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>
    link/ether 68:05:ca:1b:60:ae brd ff:ff:ff:ff:ff:ff<br>
    inet 192.168.0.11/24 brd 192.168.0.255 scope global eth1<br>
       valid_lft forever preferred_lft forever<br>
# netstat -anr<br>
Kernel IP routing table<br>
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface<br>
0.0.0.0         192.168.0.1     0.0.0.0         UG        0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth1</p>
<p>With this configuration, locally accessing ssh using eth1 (configured
 as listener) I occasionally get traffic coming out of eth0 and sessions
 hangs. I used tcpdump and checked ssh sessions going out of wrong 
interface sometimes. This is local traffic, and the above Gateway 
configuration should not affect local traffic. Nonetheless I did try 
configuring policy routing, assuming I will instruct the kernel to send 
eth1 traffic through eth1 interface and eth0 to eth0 interface. I 
entered the following commands, after creating two tables, bro and 
services:</p>
<p>sudo  ip route add 192.168.0.0/24 dev eth1 src 192.168.0.11 table services<br>
sudo  ip route add default via 192.168.0.11 dev eth1 table services<br>
sudo  ip rule add from 192.168.0.11/32 table services<br>
sudo  ip rule add to 192.168.0.11/32 table services</p>
<p>sudo  ip route add 192.168.0.0/24 dev eth0 src 192.168.0.88 table bro<br>
sudo  ip route add default via 192.168.0.88 dev eth0 table bro<br>
sudo  ip rule add from 192.168.0.88/32 table bro<br>
sudo  ip rule add to 192.168.0.88/32 table bro</p>
<p>I flush the routing cache, but  netstat reports no change:</p>
<p>0.0.0.0         192.168.0.1     0.0.0.0         UG        0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth0<br>
192.168.0.0     0.0.0.0         255.255.255.0   U         0 0          0 eth1</p>
<p># ip rule show</p>
<p>0:      from all lookup local<br>
32762:  from all to 192.168.0.88 lookup bro<br>
32763:  from 192.168.0.88 lookup bro<br>
32764:  from all to 192.168.0.11 lookup services<br>
32765:  from 192.168.0.11 lookup services<br>
32766:  from all lookup main<br>
32767:  from all lookup default</p>
<p>Policy routing is enabled in the kernel. Why I am unable to modify 
routing table? Assuming I will enable port forwarding on my router I 
will not be able to access ssh from internet if this behaviour 
continues.<br>
Thanks.</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5727" class="comment byuser comment-author-kindlund bypostauthor even depth-2 highlander-comment">
	<div id="div-comment-5727">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Darien</span></li>
		<li>Posted August 18, 2015 at 11:18 pm</li> <li><a href="#comment-5727" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5727#respond" onclick='return addComment.moveForm( "div-comment-5727", "5727", "respond", "4" )' aria-label="Reply to Darien">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>&gt; Why I am unable to modify routing table? </p>
<p>Policy routing is an *overlay* on top of the normal routing table 
that Linux provides.  Just because you enabled policy routing, does not 
mean that the output of ‘netstat -anr’ will change, at all. </p>
<p>Try looking at it another way.  Think of the ‘ip rule show’ output as
 the *first layer* of routing logic that the kernel uses (this is a 
rough approximation).  If you re-read my original article, I state: “The
 gist is that your normal main routing table appears as entry 32766 in 
this list. (This would be the normal route table you’d see when you type
 netstat -anr.)” </p>
<p>So in your example: </p>
<p># ip rule show </p>
<p>0: from all lookup local 32762: from all to 192.168.0.88 lookup bro 
32763: from 192.168.0.88 lookup bro 32764: from all to 192.168.0.11 
lookup services 32765: from 192.168.0.11 lookup services 32766: from all
 lookup main [&lt;– this is where your 'netstat -anr' table is defined] 
32767: from all lookup default That is why your changes to policy 
routing don't affect 'netstat -anr' output; it's because 'netstat -anr' 
is a small subset of the total routing table that Linux actually uses. </p>
<p>Lastly, as to why policy routing isn't working in your scenario, it's
 because both interfaces are sharing the same Class-C subnet.  
Essentially, all packets are getting evaluated (and matched) in the same
 order, which means that because both rules are trying to match on 
192.168.0.0/24, they'll always match and route to eth1.  In order to fix
 this, I think you'll need to specify the /32 address directly for each,
 so that each declaration is distinct. </p>
<p>So use: sudo ip route add 192.168.0.11/ 32 dev eth1 src 192.168.0.11 table services </p>
<p>And: sudo ip route add 192.168.0.88/ 32 dev eth0 src 192.168.0.88 table bro </p>
<p>… accordingly.  Let me know if that works. </p>
<p>Regards, Darien </p>
<p>On Tue, Aug 18, 2015 at 4:40 PM, Darien Kindlund's Blog  wrote: </p>
<p>&gt;</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5728" class="comment odd alt depth-3 highlander-comment">
	<div id="div-comment-5728">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted August 20, 2015 at 2:07 pm</li> <li><a href="#comment-5728" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5728#respond" onclick='return addComment.moveForm( "div-comment-5728", "5728", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Thanks for the reply Darien,</p>
<p>You are correct about the netstat command, I completely forgot it 
actually reads the main table, not the additional ones I added. I 
discovered were my issues come from as I also lost external 
connectivity.<br>
I made a silly mistake, the line<br>
sudo ip route add default via 192.168.0.11 dev eth1 table services<br>
should actually be<br>
sudo ip route add default via 192.168.0.1 dev eth1 table services<br>
as gateway is located at 192.168.0.1 not .11 which is the interface on eth1!<br>
I also changed the /24 prefix as you suggested to /32 and I could see 
with tcpdump that traffic is fine, no more ssh traffic going to wrong 
interface.<br>
A s a side note, suppose eth0 has an ip 192.168.0.88. Then ping -I eth0 
google .com command gives destination host unreachable answer. Whereas 
ping -I 192.168.0.88 <span class="skimlinks-unlinked">google.com</span> works just fine. </p>
<p>Thanks again for the great article,<br>
I owe you a beer.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-5734" class="comment even thread-even depth-1 highlander-comment">
	<div id="div-comment-5734">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ramakanth</span></li>
		<li>Posted October 3, 2015 at 7:13 am</li> <li><a href="#comment-5734" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5734#respond" onclick='return addComment.moveForm( "div-comment-5734", "5734", "respond", "4" )' aria-label="Reply to ramakanth">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi,</p>
<p>     I want to connect to network through two interfaces using 
ethernet and usb. but only either of one interface is ping is succesful 
i.e., the interface which is set as default gateway. </p>
<p>on Secondary interface ping is responding with destination host not reachable.</p>
<p>$  ping -I eth0 <a href="http://www.google.co.in/" rel="nofollow">http://www.google.co.in</a><br>
(192.168.200.100) icmp_seq=1 Destination Host Unreachable<br>
 (192.168.200.100) icmp_seq=2 Destination Host Unreachable<br>
(192.168.200.100) icmp_seq=3 Destination Host Unreachable</p>
<p>Please help</p>
	</div>
	</div>
<ul class="children">
<li id="comment-5735" class="comment odd alt depth-2 highlander-comment">
	<div id="div-comment-5735">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">ramakanth</span></li>
		<li>Posted October 3, 2015 at 7:32 am</li> <li><a href="#comment-5735" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5735#respond" onclick='return addComment.moveForm( "div-comment-5735", "5735", "respond", "4" )' aria-label="Reply to ramakanth">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>Hi, </p>
<p>Thanks to Anonymous (posted on August 20, 2015 at 2:07 pm)  I tested ot based on his reply. its woking fine. </p>
<p>Thanks for the wonder post and answer.</p>
	</div>
	</div>
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
<li id="comment-5761" class="comment even thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5761">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn"><a href="https://www.facebook.com/app_scoped_user_id/908328209283397/" rel="external nofollow" class="url">Dong Hoon Shin</a></span></li>
		<li>Posted January 18, 2016 at 9:45 pm</li> <li><a href="#comment-5761" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5761#respond" onclick='return addComment.moveForm( "div-comment-5761", "5761", "respond", "4" )' aria-label="Reply to Dong Hoon Shin">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>thanks a lot!! you really saved my life!!!</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5779" class="comment odd alt thread-even depth-1 highlander-comment">
	<div id="div-comment-5779">
	<ul class="comment-meta">
		<li class="comment-author vcard">
		<div class="comment-avatar"></div>
		<span class="fn">Anonymous</span></li>
		<li>Posted April 21, 2016 at 11:30 am</li> <li><a href="#comment-5779" title="Permalink to this comment">Permalink</a></li> <li> <a rel="nofollow" class="comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/?replytocom=5779#respond" onclick='return addComment.moveForm( "div-comment-5779", "5779", "respond", "4" )' aria-label="Reply to ">Reply</a></li>
	</ul>
	<div class="comment-content">
				<p>I just wanted to let you know that this article really helped me 
out.  I was trying to set up a network monitoring system based on a 
Linux OS for my capstone class in the networking program I am in, and 
was having absolutely no luck getting my server to communicate on two 
separate VLANs via two NICs.  The steps in your article here helped me 
understand the problem and actually route data correctly to the correct 
NIC based on the traffic type.  Thank you so much for this extremely 
helpful, extremely well-written article!</p>
	</div>
	</div>
</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"></div>
		<div class="alignright"></div>
	</div>
	<br>

	
	
	<h3 class="comment-header" id="numpingbacks">38 Trackbacks/Pingbacks</h3>
	<ol id="pingbacks" class="commentlist">
		<li id="comment-81" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-81">
	<div class="comment-meta">
		By <a href="http://fogger.servut.us/blog/archives/1084" rel="external nofollow" class="url">Core » Tunkkausmaanantai o/</a> on 11 May 2009 at 8:18 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Tästä ohjeesta soveltaen väänsin sitten <span class="skimlinks-unlinked">iproute.sh</span> nimisen scriptin joka sisältää seuraavaa. #!/bin/sh […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-137" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-137">
	<div class="comment-meta">
		By <a href="http://donghaima.wordpress.com/2009/10/21/links-for-2009-10-20/" rel="external nofollow" class="url">links for 2009-10-20 « Donghai Ma</a> on 21 Oct 2009 at 4:05 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Configuring Multiple Default Routes in Linux « Darien Kindlund’s
 Blog (tags: linux network networking routing gateway howto IP iptables 
policy) […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-140" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-140">
	<div class="comment-meta">
		By <a href="http://forums.opensuse.org/network-internet/424354-need-some-help-configuring-two-nics-internal-external.html#post2057383" rel="external nofollow" class="url">need some help configuring two nics (internal/external) - openSUSE Forums</a> on 29 Oct 2009 at 11:31 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…]  […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-179" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-179">
	<div class="comment-meta">
		By <a href="http://www.webhostingtalk.nl/unix-linux-bsd/160011-vps-2-ip-ranges-op-2-controllers-promiscuous-mode.html#post1138901" rel="external nofollow" class="url">VPS 2 ip-ranges op 2 controllers (promiscuous mode) - webhostingtalk.nl</a> on 26 Apr 2010 at 7:51 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] met enige goede wil (en beetje kennis of wil om man pages te lezen) kun je hier iets mee: <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/  Daarmee kun je de ene gateway aan de ene stateful table knopen, en de andere aan de 2e […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-192" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-192">
	<div class="comment-meta">
		By <a href="http://andrewwills.net/2010/creating-multiple-default-routes-in-linux/" rel="external nofollow" class="url">AndrewWills.net » Blog Archive » Creating multiple default routes in Linux</a> on 12 May 2010 at 4:17 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] the method from this website, we create a policy 
route.&nbsp;&nbsp;I am using Ubuntu 10.04 Server 64bit&nbsp;in this 
example which has […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-193" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-193">
	<div class="comment-meta">
		By <a href="http://mich3l.de/?p=345" rel="external nofollow" class="url">Michel's » Blog Archive » Mehr als eine “default route” ?</a> on 12 May 2010 at 8:55 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Lösung für dieses Problem findet mann in iproute2. In seinem 
Artikel Configuring Multiple Default Routes in Linux erkärt Darian 
Kindlund sehr gut, wie man mehrere default routs konfiguriert. Tags: […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-218" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-218">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/how-do-i-setup-multi-path-route-iptables-814123/#post4003510" rel="external nofollow" class="url">How do I setup Multi-Path route iptables</a> on 14 Jun 2010 at 8:28 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Take a look at this site, it has an explanation and some information on how to do this with iproute2 (required).  <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-256" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-256">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/iptables-and-routing-on-an-untangle-box-need-some-advice-traffic-not-being-returned-827463/#post4086003" rel="external nofollow" class="url">IPtables&amp;routing on an Untangle box, need some advice, traffic not being returned</a> on 02 Sep 2010 at 1:57 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] site for reference, but the one that explained exactly what I wanted to do and helped me most was <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ Many thanks to this […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-270" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-270">
	<div class="comment-meta">
		By <a href="http://evsworld.ed-it.net.au/2010/10/configuring-multiple-default-routes-in-linux-%c2%ab-darien-kindlund%e2%80%99s-blog/" rel="external nofollow" class="url">Configuring Multiple Default Routes in Linux « Darien Kindlund’s Blog « Rambles of Ev</a> on 07 Oct 2010 at 6:22 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Configuring Multiple Default Routes in Linux « Darien Kindlund’s Blog. […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-340" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-340">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/isolation-on-a-non-router-server-with-multiple-ethernet-855874/#post4223485" rel="external nofollow" class="url">Isolation on a non-router server with multiple ethernet?</a> on 13 Jan 2011 at 5:15 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] think I have found the answer at this link.  I will be trying 
this out on my server and will post again here the results.  […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-420" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-420">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/slackware-14/vlan-interface-with-vconfig-how-to-make-it-persistent-890598/#post4410483" rel="external nofollow" class="url">vlan interface with vconfig - how to make it persistent?</a> on 10 Jul 2011 at 6:23 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Basically I followed this webpage to set it up :  <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-423" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-423">
	<div class="comment-meta">
		By <a href="http://adminsgoodies.com/ubuntu-10-04-two-interfaces-on-a-same-subnet-with-a-same-gateway/" rel="external nofollow" class="url">Ubuntu 10.04: Two interfaces on a same subnet with a same gateway - Admins Goodies</a> on 09 Aug 2011 at 1:50 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] <a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/</a> […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-425" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-425">
	<div class="comment-meta">
		By <a href="http://adminsgoodies.com/get-linux-to-change-default-route-if-one-path-goes-down/" rel="external nofollow" class="url">Get linux to change default route if one path goes down? - Admins Goodies</a> on 14 Aug 2011 at 2:22 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] This blog entry explains how to setup multiple routes for Linux in some detail. […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-430" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-430">
	<div class="comment-meta">
		By <a href="http://stevejenkins.com/blog/2011/09/how-to-set-up-two-nics-on-different-subnets-with-static-routes-and-separate-default-gateways-that-remain-after-a-reboot/" rel="external nofollow" class="url">How
 to set up two NICs on different subnets with static routes and separate
 default gateways that remain after a reboot – Steve Jenkins' Blog</a> on 04 Sep 2011 at 11:50 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] eventually found a solution by combining two excellent blog 
posts (this one and this one) as well as some trial and error in 
figuring out how to make the changes persist on a […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-455" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-455">
	<div class="comment-meta">
		By <a href="http://paolobertasi.wordpress.com/2011/10/05/configuring-multiple-default-routes-in-linux/" rel="external nofollow" class="url">Configuring Multiple Default Routes in Linux « PaoloBertasi</a> on 05 Oct 2011 at 8:21 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] guide here  0.000000 0.000000 Like this:LikeBe the first to like this post.      Comments RSS […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-619" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-619">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/2-nics-2-seperate-networks-traffic-routing-907957/#post4558525" rel="external nofollow" class="url">2 NIC's 2 seperate networks, traffic routing</a> on 26 Dec 2011 at 8:01 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] it's a bit complicated! You might want to start at <a href="http://lartc.org/howto/" rel="nofollow">http://lartc.org/howto/</a>   Also, I found this blog entry which might give a simpler introduction to the […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-633" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-633">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/dual-homed-centos-930676/#post4609138" rel="external nofollow" class="url">dual homed centos</a> on 22 Feb 2012 at 7:56 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] has two gateway lines, including one for eth1, which I don't have) The same person suggested I do <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/  But then today, it seems to be working and I didn't change anything since last night. Why might it […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-635" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-635">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-newbie-8/routing-2-ips-932575/#post4618816" rel="external nofollow" class="url">Routing 2 IPs</a> on 05 Mar 2012 at 6:49 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Originally Posted by kopper27   looks like I have to use 
iproute2 just don't know how any guidance   thanks     try this link <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-636" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-636">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/problem-assigning-two-default-routes-on-separate-routing-tables-in-debian-936957/#post4639113" rel="external nofollow" class="url">problem assigning two default routes on separate routing tables in Debian</a> on 28 Mar 2012 at 6:10 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] and default routes for each interface:  <a href="http://www.debian-administration.org/" rel="nofollow">http://www.debian-administration.org</a>…Policy_routing <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/  However, when ppp0 is up, "ping -I ppp0 8.8.8.8" from the firewall gets a response, but […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-637" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-637">
	<div class="comment-meta">
		By <a href="http://www.adminscode.com/problem-assigning-two-default-routes-on-separate-routing-tables-in-debian.html" rel="external nofollow" class="url">problem assigning two default routes on separate routing tables in Debian | Coders &amp; Admins</a> on 28 Mar 2012 at 7:34 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] <a href="http://www.debian-administration.org...policy_routing/" rel="nofollow">http://www.debian-administration.org…Policy_routing</a> <a href="https://kindlund.wordpress.com/2007/1%E2%80%A6utes-in-linux/" rel="nofollow">https://kindlund.wordpress.com/2007/1…utes-in-linux/</a> […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-638" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-638">
	<div class="comment-meta">
		By <a href="http://kezhong.wordpress.com/2012/04/01/setup-multiple-routes-on-fedora-16/" rel="external nofollow" class="url">Setup Multiple Routes on Fedora 16 « Kezhong's Weblog</a> on 01 Apr 2012 at 2:05 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] searched the solution, found Configuring Multiple Default Routes in Linux, followed the steps, and […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-642" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-642">
	<div class="comment-meta">
		By <a href="http://adminsgoodies.com/routing-table-with-two-nic-adapters-in-libvirtkvm/" rel="external nofollow" class="url">Routing table with two NIC adapters in libvirt/KVM - Admins Goodies</a> on 10 Apr 2012 at 10:34 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] <a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/</a> Answered by lzap […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-644" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-644">
	<div class="comment-meta">
		By <a href="http://pipefish.me/remote-pentest-setup-multiple-default-gateways/" rel="external nofollow" class="url">Remote Pentest Setup – Multiple Default Gateways | pipefish</a> on 25 Apr 2012 at 2:43 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] pulled most of this technique from this site. &nbsp;Works like a champ for my&nbsp;purposes!      Post a […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-662" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-662">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-newbie-8/add-simple-script-to-service-network-restart-948584/#post4695894" rel="external nofollow" class="url">Add simple script to "service network restart"</a> on 05 Jun 2012 at 7:15 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] with the old 'route' command, but it is doable with 'ip' by creating multiple route tables..   <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ <a href="http://www.generationip.com/document" rel="nofollow">http://www.generationip.com/document</a>…teway-on-linux  To answer your question about running a […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-669" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-669">
	<div class="comment-meta">
		By <a href="http://installprocess.wordpress.com/2012/06/30/multiple-gateways-on-linux/" rel="external nofollow" class="url">Multiple gateways on Linux « Install Process</a> on 30 Jun 2012 at 5:24 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] here Share this:TwitterFacebookLike this:LikeBe the first to like this.    Posted by baxteragu Filed in […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-683" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-683">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/multiple-default-gw-4175419316/#post4741242" rel="external nofollow" class="url">Multiple "default" gw</a> on 30 Jul 2012 at 8:18 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Hi  Take a look over here […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-719" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-719">
	<div class="comment-meta">
		By <a href="http://6files.wordpress.com/2012/11/26/networking-with-linux-source-routing/" rel="external nofollow" class="url">Networking with Linux; source routing | 6files</a> on 26 Nov 2012 at 4:38 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] <a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/</a> […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-737" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-737">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/openvpn-struggles-4175445099/#post4872606" rel="external nofollow" class="url">OpenVPN struggles</a> on 17 Jan 2013 at 10:23 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] a look at this <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ it's upper level stuff but I think it may be the key to getting it to work the way you want. It was […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-796" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-796">
	<div class="comment-meta">
		By <a href="http://www.jjeasy.com/policy-routing-with-openvpn/" rel="external nofollow" class="url">Policy Routing with Openvpn? - Just just easy answers</a> on 06 Sep 2013 at 1:33 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] <a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/</a> […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-797" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-797">
	<div class="comment-meta">
		By <a href="http://www.jjeasy.com/linuxubuntu-two-nic-one-gateway-one-public-facing-one-internal-facing/" rel="external nofollow" class="url">Linux/ubuntu two nic one gateway, one public facing, one internal facing - Just just easy answers</a> on 07 Sep 2013 at 1:53 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Here is the answer […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-812" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-812">
	<div class="comment-meta">
		By <a href="https://www.linuxquestions.org/questions/linux-networking-3/help-i-cant-get-the-static-route-configured-properly-on-this-second-nic-4175482942/#post5056052" rel="external nofollow" class="url">HELP!! I cant get the static route configured properly on this second NIC!</a> on 31 Oct 2013 at 3:18 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] I've managed are strictly for backup networks or failover), so 
can't vouch for the instructions in this blog post, but they may […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-814" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-814">
	<div class="comment-meta">
		By <a href="http://bizzard2000.wordpress.com/2013/11/08/a-server-with-2-ip-address-in-different-subnet/" rel="external nofollow" class="url">A server with 2 ip address in different subnet | Bizzard's Blog</a> on 07 Nov 2013 at 10:27 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] <a href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/" rel="nofollow">https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/</a> […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-824" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-824">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/1-server-2-nics-2-networks-4175487417/#post5078402" rel="external nofollow" class="url">1 server, 2 nics, 2 networks</a> on 10 Dec 2013 at 9:24 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] need 2 default gateways and 2 routing tables I did a little more Googling and found this article:  <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/  The server is online and accessible correctly on both […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-1023" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-1023">
	<div class="comment-meta">
		By <a href="http://www.linuxquestions.org/questions/linux-networking-3/problem-in-adding-static-routes-in-centos-6-5-a-4175499934/#post5144657" rel="external nofollow" class="url">problem in adding static routes in centos 6.5</a> on 01 Apr 2014 at 9:11 am			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] In the normal network stack you get one route to any 
destination. Regardless of which NIC receives a ping, for example, the 
reply will go out through the default gateway. To do advanced 
policy-based routing have a look at this:  <a href="https://kindlund.wordpress.com/2007/1" rel="nofollow">https://kindlund.wordpress.com/2007/1</a>…utes-in-linux/ […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5637" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-5637">
	<div class="comment-meta">
		By <a href="http://sevennet.org/2015/01/27/how-to-how-broken-is-routing-strategy-that-causes-a-martian-packet-so-far-only-during-tracepath-computers-dev-answer/" rel="external nofollow" class="url">How-to:
 How broken is routing strategy that causes a martian packet (so far 
only) during tracepath? #computers #dev #answer | SevenNet</a> on 26 Jan 2015 at 6:18 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] I believe I’ve achieved a table that routes packets from and to 
eth1/192.168.3.x through 192.168.3.1, and packets from and to 
eth0/192.168.1.x through 192.168.1.1 (helpful source). […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5666" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5666">
	<div class="comment-meta">
		By <a href="https://www.majimak.com/blog/2015/03/15/%ed%95%9c-%ec%84%9c%eb%b2%84%ec%97%90-%eb%91%90%ea%b0%9c%ec%9d%98-%eb%9e%9c%ec%b9%b4%eb%93%9c-%ec%84%a4%ec%a0%95/" rel="external nofollow" class="url">한 서버에 두개의 랜카드 설정 | Nuclear Physics</a> on 15 Mar 2015 at 1:42 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] Configuring Multiple Default Routes in Linux […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5667" class="pingback even thread-even depth-1 highlander-comment">
	<div id="div-comment-5667">
	<div class="comment-meta">
		By <a href="http://bashusr.com/wordpress/?p=132" rel="external nofollow" class="url">bashusr » Blog Archive » Snippets – Multiple Networks, Multiple Gateways, Multiple Routes</a> on 18 Mar 2015 at 12:32 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] More reading… […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
<li id="comment-5736" class="pingback odd alt thread-odd thread-alt depth-1 highlander-comment">
	<div id="div-comment-5736">
	<div class="comment-meta">
		By <a href="http://pipefish.me/2012/04/05/remote-pentest-setup-multiple-default-gateways/" rel="external nofollow" class="url">Remote Pentest Setup – Multiple Default Gateways | Pipefish</a> on 05 Oct 2015 at 2:31 pm			</div>
	<div class="trackback-content">
	<div class="comment-mod"></div>
	<p>[…] pulled most of this technique from this site. &nbsp;Works like a champ for […]</p>
	</div>
	</div>
</li><!-- #comment-## -->
	</ol>

	
	
	
					<div id="respond" class="comment-respond js">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/#respond" style="display:none;">Cancel reply</a></small></h3>				<form action="https://kindlund.wordpress.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
					<input id="highlander_comment_nonce" name="highlander_comment_nonce" value="39eabfcb12" type="hidden"><input name="_wp_http_referer" value="/2007/11/19/configuring-multiple-default-routes-in-linux/" type="hidden">
<input name="hc_post_as" id="hc_post_as" value="guest" type="hidden">

<div class="comment-form-field comment-textarea">
	
	<div id="comment-form-comment"><textarea class="autosizejs " tabindex="-1" style="position: absolute; top: -999px; left: 0px; right: auto; bottom: auto; border: 0px none; padding: 0px; box-sizing: content-box; word-wrap: break-word; height: 0px ! important; min-height: 0px ! important; overflow: hidden; transition: none 0s ease 0s ; font-family: Arial,Helvetica,Tahoma,Verdana,sans-serif; font-size: 14px; font-weight: 400; font-style: normal; letter-spacing: 0px; text-transform: none; text-decoration: none; word-spacing: 0px; text-indent: 0px; line-height: 15.3333px; width: 758.667px;">Enter your comment here...</textarea><textarea style="height: 35px; overflow: hidden; word-wrap: break-word; resize: none;" placeholder="Enter your comment here..." id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div style="display: none;" id="comment-form-identity">

	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" title="Guest">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" title="WordPress.com">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" title="Twitter">
					<span></span>
				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" title="Facebook">
					<span></span>
				</a>
			</li>
			<li>
			<iframe id="googleplus-sign-in" name="googleplus-sign-in" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a_002.html" scrolling="no" allowtransparency="true" seamless="seamless" frameborder="0" height="24" width="24"></iframe>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="" alt="Gravatar" class="no-grav" width="25">
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email"></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name</label>
					<div class="comment-form-input"><input id="author" name="author" type="text"></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="text"></div>
				</div>
			</div>
	
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="" alt="WordPress.com Logo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" type="hidden">
				<input name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" type="hidden">
				<input name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" type="hidden">
				<p class="comment-form-posting-as pa-wordpress"><strong></strong> You are commenting using your <span class="skimlinks-unlinked">WordPress.com</span> account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'wordpress'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="" alt="Twitter picture" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" type="hidden">
				<input name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" type="hidden">
				<input name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" type="hidden">
				<p class="comment-form-posting-as pa-twitter"><strong></strong> You are commenting using your Twitter account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'twitter'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="" alt="Facebook photo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" type="hidden">
				<input name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" type="hidden">
				<input name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" type="hidden">
				<p class="comment-form-posting-as pa-facebook"><strong></strong> You are commenting using your Facebook account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'facebook'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="" alt="Google+ photo" class="no-grav" width="25">
			</div>

				<div class="comment-form-fields">
				<input name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" type="hidden">
				<input name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" type="hidden">
				<input name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" type="hidden">
				<p class="comment-form-posting-as pa-googleplus"><strong></strong> You are commenting using your Google+ account. <span class="comment-form-log-out">(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout(%20'googleplus'%20);">Log&nbsp;Out</a>&nbsp;/&nbsp;<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)</span></p>
			</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function(){
	var input = document.createElement( 'input' ),
	    comment = jQuery( '#comment' );

	if ( 'placeholder' in input ) {
		comment.attr( 'placeholder', jQuery( '.comment-textarea label' ).remove().text() );
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	jQuery( '#comment-form-identity' ).hide();
	jQuery( '#comment-form-subscribe' ).hide();
	jQuery( '#commentform .form-submit' ).hide();

	comment.css( { 'height':'10px' } ).one( 'focus', function() {
		var timer = setInterval( HighlanderComments.resizeCallback, 10 )
		jQuery( this ).animate( { 'height': HighlanderComments.initialHeight } ).delay( 100 ).queue( function(n) { clearInterval( timer ); HighlanderComments.resizeCallback(); n(); } );
		jQuery( '#comment-form-identity' ).slideDown();
		jQuery( '#comment-form-subscribe' ).slideDown();
		jQuery( '#commentform .form-submit' ).slideDown();
	});
}
jQuery(document).ready( highlander_expando_javascript );
</script>

<div style="display: none;" id="comment-form-subscribe">
	<p class="comment-subscription-form"><input name="subscribe" id="subscribe" value="subscribe" style="width: auto;" type="checkbox"> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p></div>

<style type="text/css">
#respond .comment-form-avatar { display: none !important; }
#respond .comment-form-fields { margin-left: 0 !important; }
</style>




<p style="display: none;" class="form-submit"><input name="submit" id="comment-submit" class="submit" value="Post Comment" type="submit"> <input name="comment_post_ID" value="4" id="comment_post_ID" type="hidden">
<input name="comment_parent" id="comment_parent" value="0" type="hidden">
</p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" value="428dbc78b0" type="hidden"></p>
<input name="genseq" value="1466080449" type="hidden">
<p style="display: none;"></p>				<input id="ak_js" name="ak_js" value="1466080453063" type="hidden"></form>
					</div><!-- #respond -->
		<div style="clear: both"></div>
</div>

			
		</div><!-- #content .hfeed -->
	</div><!-- #container -->

<div id="sidebar" class="clearfix">
	<div id="innerbar">
		<div id="primary" class="sidebar">
			<ul>
								<li class="home-link">
					<h3><a href="https://kindlund.wordpress.com/" title="Darien Kindlund's Blog">« Home</a></h3>
				</li>
						<li class="pagenav"><h3>Pages</h3><ul><li class="page_item page-item-2"><a href="https://kindlund.wordpress.com/about/">About</a></li>
</ul></li>
				<li class="category-links">
					<h3>Categories</h3>
					<ul>
						<li class="categories">Categories<ul>	<li class="cat-item cat-item-2748912"><a href="https://kindlund.wordpress.com/category/honeyclient/">Honeyclient</a>
</li>
	<li class="cat-item cat-item-610"><a href="https://kindlund.wordpress.com/category/linux/">Linux</a>
</li>
	<li class="cat-item cat-item-40559"><a href="https://kindlund.wordpress.com/category/virtualization/" title="Virtualization">Virtualization</a>
</li>
</ul></li>					</ul>
				</li>
				<li class="archive-links">
					<h3>Archives</h3>
					<ul>
							<li><a href="https://kindlund.wordpress.com/2009/07/">July 2009</a></li>
	<li><a href="https://kindlund.wordpress.com/2008/11/">November 2008</a></li>
	<li><a href="https://kindlund.wordpress.com/2008/07/">July 2008</a></li>
	<li><a href="https://kindlund.wordpress.com/2007/11/">November 2007</a></li>
					</ul>
				</li>
					</ul>
		</div><!-- #primary .sidebar -->

		<div id="secondary" class="sidebar">
			<ul>
						<li class="blog-search">
					<h3><label for="s">Search</label></h3>
					<form id="searchform" method="get" action="https://kindlund.wordpress.com">
						<div>
							<input id="s" name="s" size="10" type="text">
							<input id="searchsubmit" name="searchsubmit" value="Find »" type="submit">
						</div>
					</form>
				</li>

				<li id="linkcat-1356" class="linkcat"><h3>Blogroll</h3>
	<ul class="xoxo blogroll">
<li><a href="http://www.mcs.vuw.ac.nz/%7Ecseifert/blog/index.php" rel="contact colleague" title="Capture Project Lead">Christian Seifert</a></li>
<li><a href="http://ddanchev.blogspot.com/">Dancho Danchev</a></li>
<li><a href="http://www.honeyclient.org/">MITRE Honeyclient Project</a></li>
<li><a href="http://www.omeganz.net/" rel="contact colleague" title="Capture Project Member">Ramon Steenson</a></li>
<li><a href="http://www.honeyblog.org/" rel="contact" title="German Honeynet Project Founder">Thorsten Holz</a></li>

	</ul>
</li>

				<li class="feed-links">
					<h3>RSS Feeds</h3>
					<ul>
						<li><a href="https://kindlund.wordpress.com/feed/" title="Darien Kindlund's Blog RSS 2.0 Feed" rel="alternate" type="application/rss+xml">All posts</a></li>
						<li><a href="https://kindlund.wordpress.com/comments/feed/" title="Darien Kindlund's Blog Comments RSS 2.0 Feed" rel="alternate" type="application/rss+xml">All comments</a></li>
					</ul>
				</li>
				<li class="meta-links">
					<h3>Meta</h3>
					<ul>
						<li><a href="https://wordpress.com/start?ref=wplogin">Register</a></li>						<li><a href="https://kindlund.wordpress.com/wp-login.php">Log in</a></li>
											</ul>
				</li>
					</ul>
		</div><!-- #secondary .sidebar -->
	</div>
</div>	<div id="footer">
		<a href="https://wordpress.com/?ref=footer_blog">Blog at WordPress.com.</a> <a href="https://wordpress.com/themes/chaostheory/" title="Learn more about this theme">The ChaosTheory Theme</a>.	</div><!-- #footer -->

</div><!-- #wrapper -->

<!-- wpcom_wp_footer -->
	<div style="display:none">
	</div>
<script type="text/javascript">
/* <![CDATA[ */
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/kindlund.wordpress.com\/public.api\/connect\/?action=request","logoutURL":"https:\/\/kindlund.wordpress.com\/wp-login.php?action=logout&_wpnonce=9979b63e32","homeURL":"https:\/\/kindlund.wordpress.com\/","postID":"4","gravDefault":"mystery","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"","userIsLoggedIn":"","isJetpack":"0","text_direction":"ltr"};
/* ]]> */
</script>
<script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a_003"></script>

	<div style="bottom: -253px;" id="bit" class="loggedout-follow-normal">
		<a class="bsub" href="javascript:void(0)"><span id="bsub-text">Follow</span></a>
		<div id="bitsubscribe">

					<h3><label for="loggedout-follow-field">Follow “Darien Kindlund's Blog”</label></h3>

			<form action="https://subscribe.wordpress.com" method="post" accept-charset="utf-8" id="loggedout-follow">
			<p>Get every new post delivered to your Inbox.</p>

			<p id="loggedout-follow-error" style="display: none;"></p>

			
			<p><input name="email" placeholder="Enter your email address" id="loggedout-follow-field" type="email"></p>

			<input name="action" value="subscribe" type="hidden">
			<input name="blog_id" value="2127116" type="hidden">
			<input name="source" value="https://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/" type="hidden">
			<input name="sub-type" value="loggedout-follow" type="hidden">

			<input id="_wpnonce" name="_wpnonce" value="daaf02eba8" type="hidden"><input name="_wp_http_referer" value="/2007/11/19/configuring-multiple-default-routes-in-linux/" type="hidden">
			<p id="bsub-subscribe-button"><input value="Sign me up" type="submit"></p>
			</form>
					<div id="bsub-credit"><a href="https://wordpress.com/?ref=lof">Build a website with WordPress.com</a></div>
		</div><!-- #bitsubscribe -->
	</div><!-- #bit -->
<script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/form.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var JetpackEmojiSettings = {"base_url":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/emoji\/twemoji\/"};
/* ]]> */
</script>
<script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/a_002"></script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>	<script type="text/javascript">
	var skimlinks_pub_id = "725X584219"
	var skimlinks_sitename = "kindlund.wordpress.com";
	</script>
	<script type="text/javascript" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/725X1342.js"></script>		<iframe src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/master.html" scrolling="no" id="likes-master" name="likes-master" style="display:none;"></iframe>
		<div id="likes-other-gravatars"><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
		<script>
			var _comscore = _comscore || [];
			_comscore.push({
				c1: "2",
				c2: "7518284"
			});
			(function() {
				var s = document.createElement("script"),
					el = document.getElementsByTagName("script")[0];
				s.async = true;
				s.src = (document.location.protocol == "https:" ? "https://sb" : "http://b") + ".scorecardresearch.com/beacon.js";
				el.parentNode.insertBefore(s, el);
			})();
		</script>
		<noscript>
			<p class="robots-nocontent"><img src="https://sb.scorecardresearch.com/p?c1=2&c2=7518284&c3=&c4=&c5=&c6=&c15=&cv=2.0&cj=1" alt="" style="display:none;" width="1" height="1" /></p>
		</noscript><script src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/w.js" type="text/javascript" async="" defer="defer"></script>
<script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'2127116','blog_tz':'-4','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'2127116','v':'wpcom','tz':'-4','user_id':'0','post':'4','subd':'kindlund'}]);
_stq.push(['extra', {'crypt':'UE5XaGUuOTlwaD85flAmcm1mcmZsaDhkV11YdWFnNncxc1tjZG9XVXhRdzR6dTIuSnFPfDl6PzFuXVtEcTlGQkE3RktNTj0uRG5kbVFIZ0EmSC5ZRXRlOFpbWkpUJUdDRDAwbExkVS5DP25Jcz16M1F2eGcsemZ+d3d2SUtfajR2YWxqZTZUY1JwOVtZUU5pX3g5VTAwQ35teWc3LXxHSGx2LVZEfmV2ZWdKJlo5eHlNZjEuL2Q3cGNCeCw0aWpufngsQ0RIVTEsenhbckYyNWg5eVR1b3VYL01DP3NqW2ZnUT0mW1htYjlCUi98cldKfC5YRzlCbGJTbz9zXTZwXWtGUjNRTCVVdA=='}]);
_stq.push([ 'clickTrackerInit', '2127116', '4' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:0px;width:0px;overflow:hidden" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>

<img scale="0" id="wpstats" alt=":)" src="Configuring%20Multiple%20Default%20Routes%20in%20Linux%20%7C%20Darien%20Kindlund%27s%20Blog_files/g.gif"></body></html>